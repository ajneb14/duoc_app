"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6340],{9583:(ff,no,ue)=>{ue.d(no,{fS:()=>Au,Ix:()=>en,H6:()=>up,T1:()=>Re,Wq:()=>Nn,uY:()=>tn,W6:()=>k,Ci:()=>Vs,YQ:()=>fi,NJ:()=>kn,Dc:()=>ge,GA:()=>ad,cm:()=>Kt,K$:()=>G,FA:()=>le,lo:()=>ee,bI:()=>Mi,qG:()=>bf,qi:()=>Ce,c8:()=>Lh,gS:()=>Qp,C3:()=>c_,hq:()=>u_,me:()=>dp,rJ:()=>ip,Cs:()=>sp,vN:()=>Kh,kd:()=>jp,CL:()=>o_,LA:()=>gp,H9:()=>zh,ol:()=>lp,Q5:()=>hp,Os:()=>mp,FD:()=>Dp,rf:()=>Cp,Ws:()=>Ae,z6:()=>Tr,x7:()=>Op,nY:()=>Lp,_e:()=>Bp,GG:()=>qp,kU:()=>Up,Rr:()=>Gp,aU:()=>cp,GV:()=>l_,AB:()=>Vp,$1:()=>Sp,po:()=>pp,St:()=>_p,aQ:()=>$p,FC:()=>Wp,My:()=>Pp,P:()=>wp,B:()=>hu,yx:()=>op,c4:()=>s_,O5:()=>a_,BN:()=>Kp,He:()=>Vr,lN:()=>Mp,HM:()=>xp,EO:()=>bp,mZ:()=>zp,iB:()=>fp,_M:()=>Rp});var Et,cn,C=ue(467),Mt=ue(7852),me=ue(1362),Ie=ue(8041),re=ue(1076),ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ni={};(function(){var r;function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function i(v,_,E){E||(E=0);var A=Array(16);if("string"==typeof _)for(var w=0;16>w;++w)A[w]=_.charCodeAt(E++)|_.charCodeAt(E++)<<8|_.charCodeAt(E++)<<16|_.charCodeAt(E++)<<24;else for(w=0;16>w;++w)A[w]=_[E++]|_[E++]<<8|_[E++]<<16|_[E++]<<24;var S=v.g[3],T=(_=v.g[0])+(S^(E=v.g[1])&((w=v.g[2])^S))+A[0]+3614090360&4294967295;T=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=(E=(w=(S=(_=E+(T<<7&4294967295|T>>>25))+((T=S+(w^_&(E^w))+A[1]+3905402710&4294967295)<<12&4294967295|T>>>20))+((T=w+(E^S&(_^E))+A[2]+606105819&4294967295)<<17&4294967295|T>>>15))+((T=E+(_^w&(S^_))+A[3]+3250441966&4294967295)<<22&4294967295|T>>>10))+((T=_+(S^E&(w^S))+A[4]+4118548399&4294967295)<<7&4294967295|T>>>25))+((T=S+(w^_&(E^w))+A[5]+1200080426&4294967295)<<12&4294967295|T>>>20))+((T=w+(E^S&(_^E))+A[6]+2821735955&4294967295)<<17&4294967295|T>>>15))+((T=E+(_^w&(S^_))+A[7]+4249261313&4294967295)<<22&4294967295|T>>>10))+((T=_+(S^E&(w^S))+A[8]+1770035416&4294967295)<<7&4294967295|T>>>25))+((T=S+(w^_&(E^w))+A[9]+2336552879&4294967295)<<12&4294967295|T>>>20))+((T=w+(E^S&(_^E))+A[10]+4294925233&4294967295)<<17&4294967295|T>>>15))+((T=E+(_^w&(S^_))+A[11]+2304563134&4294967295)<<22&4294967295|T>>>10))+((T=_+(S^E&(w^S))+A[12]+1804603682&4294967295)<<7&4294967295|T>>>25))+((T=S+(w^_&(E^w))+A[13]+4254626195&4294967295)<<12&4294967295|T>>>20))+((T=w+(E^S&(_^E))+A[14]+2792965006&4294967295)<<17&4294967295|T>>>15))+((T=E+(_^w&(S^_))+A[15]+1236535329&4294967295)<<22&4294967295|T>>>10))+((T=_+(w^S&(E^w))+A[1]+4129170786&4294967295)<<5&4294967295|T>>>27))+((T=S+(E^w&(_^E))+A[6]+3225465664&4294967295)<<9&4294967295|T>>>23))+((T=w+(_^E&(S^_))+A[11]+643717713&4294967295)<<14&4294967295|T>>>18))+((T=E+(S^_&(w^S))+A[0]+3921069994&4294967295)<<20&4294967295|T>>>12))+((T=_+(w^S&(E^w))+A[5]+3593408605&4294967295)<<5&4294967295|T>>>27))+((T=S+(E^w&(_^E))+A[10]+38016083&4294967295)<<9&4294967295|T>>>23))+((T=w+(_^E&(S^_))+A[15]+3634488961&4294967295)<<14&4294967295|T>>>18))+((T=E+(S^_&(w^S))+A[4]+3889429448&4294967295)<<20&4294967295|T>>>12))+((T=_+(w^S&(E^w))+A[9]+568446438&4294967295)<<5&4294967295|T>>>27))+((T=S+(E^w&(_^E))+A[14]+3275163606&4294967295)<<9&4294967295|T>>>23))+((T=w+(_^E&(S^_))+A[3]+4107603335&4294967295)<<14&4294967295|T>>>18))+((T=E+(S^_&(w^S))+A[8]+1163531501&4294967295)<<20&4294967295|T>>>12))+((T=_+(w^S&(E^w))+A[13]+2850285829&4294967295)<<5&4294967295|T>>>27))+((T=S+(E^w&(_^E))+A[2]+4243563512&4294967295)<<9&4294967295|T>>>23))+((T=w+(_^E&(S^_))+A[7]+1735328473&4294967295)<<14&4294967295|T>>>18))+((T=E+(S^_&(w^S))+A[12]+2368359562&4294967295)<<20&4294967295|T>>>12))+((T=_+(E^w^S)+A[5]+4294588738&4294967295)<<4&4294967295|T>>>28))+((T=S+(_^E^w)+A[8]+2272392833&4294967295)<<11&4294967295|T>>>21))+((T=w+(S^_^E)+A[11]+1839030562&4294967295)<<16&4294967295|T>>>16))+((T=E+(w^S^_)+A[14]+4259657740&4294967295)<<23&4294967295|T>>>9))+((T=_+(E^w^S)+A[1]+2763975236&4294967295)<<4&4294967295|T>>>28))+((T=S+(_^E^w)+A[4]+1272893353&4294967295)<<11&4294967295|T>>>21))+((T=w+(S^_^E)+A[7]+4139469664&4294967295)<<16&4294967295|T>>>16))+((T=E+(w^S^_)+A[10]+3200236656&4294967295)<<23&4294967295|T>>>9))+((T=_+(E^w^S)+A[13]+681279174&4294967295)<<4&4294967295|T>>>28))+((T=S+(_^E^w)+A[0]+3936430074&4294967295)<<11&4294967295|T>>>21))+((T=w+(S^_^E)+A[3]+3572445317&4294967295)<<16&4294967295|T>>>16))+((T=E+(w^S^_)+A[6]+76029189&4294967295)<<23&4294967295|T>>>9))+((T=_+(E^w^S)+A[9]+3654602809&4294967295)<<4&4294967295|T>>>28))+((T=S+(_^E^w)+A[12]+3873151461&4294967295)<<11&4294967295|T>>>21))+((T=w+(S^_^E)+A[15]+530742520&4294967295)<<16&4294967295|T>>>16))+((T=E+(w^S^_)+A[2]+3299628645&4294967295)<<23&4294967295|T>>>9))+((T=_+(w^(E|~S))+A[0]+4096336452&4294967295)<<6&4294967295|T>>>26))+((T=S+(E^(_|~w))+A[7]+1126891415&4294967295)<<10&4294967295|T>>>22))+((T=w+(_^(S|~E))+A[14]+2878612391&4294967295)<<15&4294967295|T>>>17))+((T=E+(S^(w|~_))+A[5]+4237533241&4294967295)<<21&4294967295|T>>>11))+((T=_+(w^(E|~S))+A[12]+1700485571&4294967295)<<6&4294967295|T>>>26))+((T=S+(E^(_|~w))+A[3]+2399980690&4294967295)<<10&4294967295|T>>>22))+((T=w+(_^(S|~E))+A[10]+4293915773&4294967295)<<15&4294967295|T>>>17))+((T=E+(S^(w|~_))+A[1]+2240044497&4294967295)<<21&4294967295|T>>>11))+((T=_+(w^(E|~S))+A[8]+1873313359&4294967295)<<6&4294967295|T>>>26))+((T=S+(E^(_|~w))+A[15]+4264355552&4294967295)<<10&4294967295|T>>>22))+((T=w+(_^(S|~E))+A[6]+2734768916&4294967295)<<15&4294967295|T>>>17))+((T=E+(S^(w|~_))+A[13]+1309151649&4294967295)<<21&4294967295|T>>>11))+((S=(_=E+((T=_+(w^(E|~S))+A[4]+4149444226&4294967295)<<6&4294967295|T>>>26))+((T=S+(E^(_|~w))+A[11]+3174756917&4294967295)<<10&4294967295|T>>>22))^((w=S+((T=w+(_^(S|~E))+A[2]+718787259&4294967295)<<15&4294967295|T>>>17))|~_))+A[9]+3951481745&4294967295,v.g[0]=v.g[0]+_&4294967295,v.g[1]=v.g[1]+(w+(T<<21&4294967295|T>>>11))&4294967295,v.g[2]=v.g[2]+w&4294967295,v.g[3]=v.g[3]+S&4294967295}function a(v,_){this.h=_;for(var E=[],A=!0,w=v.length-1;0<=w;w--){var S=0|v[w];A&&S==_||(E[w]=S,A=!1)}this.g=E}(function e(v,_){function E(){}E.prototype=_.prototype,v.D=_.prototype,v.prototype=new E,v.prototype.constructor=v,v.C=function(A,w,S){for(var T=Array(arguments.length-2),Nt=2;Nt<arguments.length;Nt++)T[Nt-2]=arguments[Nt];return _.prototype[w].apply(A,T)}})(n,function t(){this.blockSize=-1}),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},n.prototype.u=function(v,_){void 0===_&&(_=v.length);for(var E=_-this.blockSize,A=this.B,w=this.h,S=0;S<_;){if(0==w)for(;S<=E;)i(this,v,S),S+=this.blockSize;if("string"==typeof v){for(;S<_;)if(A[w++]=v.charCodeAt(S++),w==this.blockSize){i(this,A),w=0;break}}else for(;S<_;)if(A[w++]=v[S++],w==this.blockSize){i(this,A),w=0;break}}this.h=w,this.o+=_},n.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var _=1;_<v.length-8;++_)v[_]=0;var E=8*this.o;for(_=v.length-8;_<v.length;++_)v[_]=255&E,E/=256;for(this.u(v),v=Array(16),_=E=0;4>_;++_)for(var A=0;32>A;A+=8)v[E++]=this.g[_]>>>A&255;return v};var u={};function c(v){return-128<=v&&128>v?function s(v,_){var E=u;return Object.prototype.hasOwnProperty.call(E,v)?E[v]:E[v]=_(v)}(v,function(_){return new a([0|_],0>_?-1:0)}):new a([0|v],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return p;if(0>v)return M(h(-v));for(var _=[],E=1,A=0;v>=E;A++)_[A]=v/E|0,E*=4294967296;return new a(_,0)}var p=c(0),y=c(1),V=c(16777216);function N(v){if(0!=v.h)return!1;for(var _=0;_<v.g.length;_++)if(0!=v.g[_])return!1;return!0}function L(v){return-1==v.h}function M(v){for(var _=v.g.length,E=[],A=0;A<_;A++)E[A]=~v.g[A];return new a(E,~v.h).add(y)}function Q(v,_){return v.add(M(_))}function H(v,_){for(;(65535&v[_])!=v[_];)v[_+1]+=v[_]>>>16,v[_]&=65535,_++}function W(v,_){this.g=v,this.h=_}function Y(v,_){if(N(_))throw Error("division by zero");if(N(v))return new W(p,p);if(L(v))return _=Y(M(v),_),new W(M(_.g),M(_.h));if(L(_))return _=Y(v,M(_)),new W(M(_.g),_.h);if(30<v.g.length){if(L(v)||L(_))throw Error("slowDivide_ only works with positive integers.");for(var E=y,A=_;0>=A.l(v);)E=oe(E),A=oe(A);var w=Z(E,1),S=Z(A,1);for(A=Z(A,2),E=Z(E,2);!N(A);){var T=S.add(A);0>=T.l(v)&&(w=w.add(E),S=T),A=Z(A,1),E=Z(E,1)}return _=Q(v,w.j(_)),new W(w,_)}for(w=p;0<=v.l(_);){for(E=Math.max(1,Math.floor(v.m()/_.m())),A=48>=(A=Math.ceil(Math.log(E)/Math.LN2))?1:Math.pow(2,A-48),T=(S=h(E)).j(_);L(T)||0<T.l(v);)T=(S=h(E-=A)).j(_);N(S)&&(S=y),w=w.add(S),v=Q(v,T)}return new W(w,v)}function oe(v){for(var _=v.g.length+1,E=[],A=0;A<_;A++)E[A]=v.i(A)<<1|v.i(A-1)>>>31;return new a(E,v.h)}function Z(v,_){var E=_>>5;_%=32;for(var A=v.g.length-E,w=[],S=0;S<A;S++)w[S]=0<_?v.i(S+E)>>>_|v.i(S+E+1)<<32-_:v.i(S+E);return new a(w,v.h)}(r=a.prototype).m=function(){if(L(this))return-M(this).m();for(var v=0,_=1,E=0;E<this.g.length;E++){var A=this.i(E);v+=(0<=A?A:4294967296+A)*_,_*=4294967296}return v},r.toString=function(v){if(2>(v=v||10)||36<v)throw Error("radix out of range: "+v);if(N(this))return"0";if(L(this))return"-"+M(this).toString(v);for(var _=h(Math.pow(v,6)),E=this,A="";;){var w=Y(E,_).g,S=((0<(E=Q(E,w.j(_))).g.length?E.g[0]:E.h)>>>0).toString(v);if(N(E=w))return S+A;for(;6>S.length;)S="0"+S;A=S+A}},r.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h},r.l=function(v){return L(v=Q(this,v))?-1:N(v)?0:1},r.abs=function(){return L(this)?M(this):this},r.add=function(v){for(var _=Math.max(this.g.length,v.g.length),E=[],A=0,w=0;w<=_;w++){var S=A+(65535&this.i(w))+(65535&v.i(w)),T=(S>>>16)+(this.i(w)>>>16)+(v.i(w)>>>16);A=T>>>16,E[w]=(T&=65535)<<16|(S&=65535)}return new a(E,-2147483648&E[E.length-1]?-1:0)},r.j=function(v){if(N(this)||N(v))return p;if(L(this))return L(v)?M(this).j(M(v)):M(M(this).j(v));if(L(v))return M(this.j(M(v)));if(0>this.l(V)&&0>v.l(V))return h(this.m()*v.m());for(var _=this.g.length+v.g.length,E=[],A=0;A<2*_;A++)E[A]=0;for(A=0;A<this.g.length;A++)for(var w=0;w<v.g.length;w++){var S=this.i(A)>>>16,T=65535&this.i(A),Nt=v.i(w)>>>16,mi=65535&v.i(w);E[2*A+2*w]+=T*mi,H(E,2*A+2*w),E[2*A+2*w+1]+=S*mi,H(E,2*A+2*w+1),E[2*A+2*w+1]+=T*Nt,H(E,2*A+2*w+1),E[2*A+2*w+2]+=S*Nt,H(E,2*A+2*w+2)}for(A=0;A<_;A++)E[A]=E[2*A+1]<<16|E[2*A];for(A=_;A<2*_;A++)E[A]=0;return new a(E,0)},r.A=function(v){return Y(this,v).h},r.and=function(v){for(var _=Math.max(this.g.length,v.g.length),E=[],A=0;A<_;A++)E[A]=this.i(A)&v.i(A);return new a(E,this.h&v.h)},r.or=function(v){for(var _=Math.max(this.g.length,v.g.length),E=[],A=0;A<_;A++)E[A]=this.i(A)|v.i(A);return new a(E,this.h|v.h)},r.xor=function(v){for(var _=Math.max(this.g.length,v.g.length),E=[],A=0;A<_;A++)E[A]=this.i(A)^v.i(A);return new a(E,this.h^v.h)},n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,cn=Ni.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=h,a.fromString=function f(v,_){if(0==v.length)throw Error("number format error: empty string");if(2>(_=_||10)||36<_)throw Error("radix out of range: "+_);if("-"==v.charAt(0))return M(f(v.substring(1),_));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var E=h(Math.pow(_,8)),A=p,w=0;w<v.length;w+=8){var S=Math.min(8,v.length-w),T=parseInt(v.substring(w,w+S),_);8>S?(S=h(Math.pow(_,S)),A=A.j(S).add(h(T))):A=(A=A.j(E)).add(h(T))}return A},Et=Ni.Integer=a}).apply(typeof ct<"u"?ct:typeof self<"u"?self:typeof window<"u"?window:{});var ki,vt,it,Ot,Rr,Pr,io,Fi,ln=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rt={};(function(){var r,e="function"==typeof Object.defineProperties?Object.defineProperty:function(o,l,d){return o==Array.prototype||o==Object.prototype||(o[l]=d.value),o},n=function t(o){o=["object"==typeof globalThis&&globalThis,o,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof ln&&ln];for(var l=0;l<o.length;++l){var d=o[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}(this);!function i(o,l){if(l)e:{var d=n;o=o.split(".");for(var g=0;g<o.length-1;g++){var P=o[g];if(!(P in d))break e;d=d[P]}(l=l(g=d[o=o[o.length-1]]))!=g&&null!=l&&e(d,o,{configurable:!0,writable:!0,value:l})}}("Array.prototype.values",function(o){return o||function(){return function s(o,l){o instanceof String&&(o+="");var d=0,g=!1,P={next:function(){if(!g&&d<o.length){var x=d++;return{value:l(x,o[x]),done:!1}}return g=!0,{done:!0,value:void 0}}};return P[Symbol.iterator]=function(){return P},P}(this,function(l,d){return d})}});var a=a||{},u=this||self;function c(o){var l=typeof o;return"array"==(l="object"!=l?l:o?Array.isArray(o)?"array":l:"null")||"object"==l&&"number"==typeof o.length}function h(o){var l=typeof o;return"object"==l&&null!=o||"function"==l}function f(o,l,d){return o.call.apply(o.bind,arguments)}function p(o,l,d){if(!o)throw Error();if(2<arguments.length){var g=Array.prototype.slice.call(arguments,2);return function(){var P=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(P,g),o.apply(l,P)}}return function(){return o.apply(l,arguments)}}function y(o,l,d){return(y=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?f:p).apply(null,arguments)}function V(o,l){var d=Array.prototype.slice.call(arguments,1);return function(){var g=d.slice();return g.push.apply(g,arguments),o.apply(this,g)}}function N(o,l){function d(){}d.prototype=l.prototype,o.aa=l.prototype,o.prototype=new d,o.prototype.constructor=o,o.Qb=function(g,P,x){for(var K=Array(arguments.length-2),fe=2;fe<arguments.length;fe++)K[fe-2]=arguments[fe];return l.prototype[P].apply(g,K)}}function L(o){const l=o.length;if(0<l){const d=Array(l);for(let g=0;g<l;g++)d[g]=o[g];return d}return[]}function M(o,l){for(let d=1;d<arguments.length;d++){const g=arguments[d];if(c(g)){const P=o.length||0,x=g.length||0;o.length=P+x;for(let K=0;K<x;K++)o[P+K]=g[K]}else o.push(g)}}function H(o){return/^[\s\xa0]*$/.test(o)}function W(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function Y(o){return Y[" "](o),o}Y[" "]=function(){};var oe=!(-1==W().indexOf("Gecko")||-1!=W().toLowerCase().indexOf("webkit")&&-1==W().indexOf("Edge")||-1!=W().indexOf("Trident")||-1!=W().indexOf("MSIE")||-1!=W().indexOf("Edge"));function Z(o,l,d){for(const g in o)l.call(d,o[g],g,o)}function _(o){const l={};for(const d in o)l[d]=o[d];return l}const E="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function A(o,l){let d,g;for(let P=1;P<arguments.length;P++){for(d in g=arguments[P],g)o[d]=g[d];for(let x=0;x<E.length;x++)d=E[x],Object.prototype.hasOwnProperty.call(g,d)&&(o[d]=g[d])}}function w(o){var l=1;o=o.split(":");const d=[];for(;0<l&&o.length;)d.push(o.shift()),l--;return o.length&&d.push(o.join(":")),d}function S(o){u.setTimeout(()=>{throw o},0)}function T(){var o=Pu;let l=null;return o.g&&(l=o.g,o.g=o.g.next,o.g||(o.h=null),l.next=null),l}var mi=new class Q{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}(()=>new d_,o=>o.reset());class d_{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let gi,pi=!1,Pu=new class Nt{constructor(){this.h=this.g=null}add(l,d){const g=mi.get();g.set(l,d),this.h?this.h.next=g:this.g=g,this.h=g}},hd=()=>{const o=u.Promise.resolve(void 0);gi=()=>{o.then(f_)}};var f_=()=>{for(var o;o=T();){try{o.h.call(o.g)}catch(d){S(d)}var l=mi;l.j(o),100>l.h&&(l.h++,o.next=l.g,l.g=o)}pi=!1};function sn(){this.s=this.s,this.C=this.C}function $e(o,l){this.type=o,this.g=this.target=l,this.defaultPrevented=!1}sn.prototype.s=!1,sn.prototype.ma=function(){this.s||(this.s=!0,this.N())},sn.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},$e.prototype.h=function(){this.defaultPrevented=!0};var m_=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,l=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return o}();function _i(o,l){if($e.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var d=this.type=o.type,g=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=l,l=o.relatedTarget){if(oe){e:{try{Y(l.nodeName);var P=!0;break e}catch{}P=!1}P||(l=null)}}else"mouseover"==d?l=o.fromElement:"mouseout"==d&&(l=o.toElement);this.relatedTarget=l,g?(this.clientX=void 0!==g.clientX?g.clientX:g.pageX,this.clientY=void 0!==g.clientY?g.clientY:g.pageY,this.screenX=g.screenX||0,this.screenY=g.screenY||0):(this.clientX=void 0!==o.clientX?o.clientX:o.pageX,this.clientY=void 0!==o.clientY?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType="string"==typeof o.pointerType?o.pointerType:g_[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&_i.aa.h.call(this)}}N(_i,$e);var g_={2:"touch",3:"pen",4:"mouse"};_i.prototype.h=function(){_i.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var yi="closure_listenable_"+(1e6*Math.random()|0),p_=0;function __(o,l,d,g,P){this.listener=o,this.proxy=null,this.src=l,this.type=d,this.capture=!!g,this.ha=P,this.key=++p_,this.da=this.fa=!1}function Bs(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function qs(o){this.src=o,this.g={},this.h=0}function Vu(o,l){var d=l.type;if(d in o.g){var x,g=o.g[d],P=Array.prototype.indexOf.call(g,l,void 0);(x=0<=P)&&Array.prototype.splice.call(g,P,1),x&&(Bs(l),0==o.g[d].length&&(delete o.g[d],o.h--))}}function Su(o,l,d,g){for(var P=0;P<o.length;++P){var x=o[P];if(!x.da&&x.listener==l&&x.capture==!!d&&x.ha==g)return P}return-1}qs.prototype.add=function(o,l,d,g,P){var x=o.toString();(o=this.g[x])||(o=this.g[x]=[],this.h++);var K=Su(o,l,g,P);return-1<K?(l=o[K],d||(l.fa=!1)):((l=new __(l,this.src,x,!!g,P)).fa=d,o.push(l)),l};var bu="closure_lm_"+(1e6*Math.random()|0),xu={};function dd(o,l,d,g,P){if(g&&g.once)return md(o,l,d,g,P);if(Array.isArray(l)){for(var x=0;x<l.length;x++)dd(o,l[x],d,g,P);return null}return d=ku(d),o&&o[yi]?o.K(l,d,h(g)?!!g.capture:!!g,P):fd(o,l,d,!1,g,P)}function fd(o,l,d,g,P,x){if(!l)throw Error("Invalid event type");var K=h(P)?!!P.capture:!!P,fe=Du(o);if(fe||(o[bu]=fe=new qs(o)),(d=fe.add(l,d,g,K,x)).proxy)return d;if(g=function y_(){const l=I_;return function o(d){return l.call(o.src,o.listener,d)}}(),d.proxy=g,g.src=o,g.listener=d,o.addEventListener)m_||(P=K),void 0===P&&(P=!1),o.addEventListener(l.toString(),g,P);else if(o.attachEvent)o.attachEvent(pd(l.toString()),g);else{if(!o.addListener||!o.removeListener)throw Error("addEventListener and attachEvent are unavailable.");o.addListener(g)}return d}function md(o,l,d,g,P){if(Array.isArray(l)){for(var x=0;x<l.length;x++)md(o,l[x],d,g,P);return null}return d=ku(d),o&&o[yi]?o.L(l,d,h(g)?!!g.capture:!!g,P):fd(o,l,d,!0,g,P)}function gd(o,l,d,g,P){if(Array.isArray(l))for(var x=0;x<l.length;x++)gd(o,l[x],d,g,P);else g=h(g)?!!g.capture:!!g,d=ku(d),o&&o[yi]?(o=o.i,(l=String(l).toString())in o.g&&-1<(d=Su(x=o.g[l],d,g,P))&&(Bs(x[d]),Array.prototype.splice.call(x,d,1),0==x.length&&(delete o.g[l],o.h--))):o&&(o=Du(o))&&(l=o.g[l.toString()],o=-1,l&&(o=Su(l,d,g,P)),(d=-1<o?l[o]:null)&&Cu(d))}function Cu(o){if("number"!=typeof o&&o&&!o.da){var l=o.src;if(l&&l[yi])Vu(l.i,o);else{var d=o.type,g=o.proxy;l.removeEventListener?l.removeEventListener(d,g,o.capture):l.detachEvent?l.detachEvent(pd(d),g):l.addListener&&l.removeListener&&l.removeListener(g),(d=Du(l))?(Vu(d,o),0==d.h&&(d.src=null,l[bu]=null)):Bs(o)}}}function pd(o){return o in xu?xu[o]:xu[o]="on"+o}function I_(o,l){if(o.da)o=!0;else{l=new _i(l,this);var d=o.listener,g=o.ha||o.src;o.fa&&Cu(o),o=d.call(g,l)}return o}function Du(o){return(o=o[bu])instanceof qs?o:null}var Nu="__closure_events_fn_"+(1e9*Math.random()>>>0);function ku(o){return"function"==typeof o?o:(o[Nu]||(o[Nu]=function(l){return o.handleEvent(l)}),o[Nu])}function We(){sn.call(this),this.i=new qs(this),this.M=this,this.F=null}function Xe(o,l){var d,g=o.F;if(g)for(d=[];g;g=g.F)d.push(g);if(o=o.M,g=l.type||l,"string"==typeof l)l=new $e(l,o);else if(l instanceof $e)l.target=l.target||o;else{var P=l;A(l=new $e(g,o),P)}if(P=!0,d)for(var x=d.length-1;0<=x;x--){var K=l.g=d[x];P=Us(K,g,!0,l)&&P}if(P=Us(K=l.g=o,g,!0,l)&&P,P=Us(K,g,!1,l)&&P,d)for(x=0;x<d.length;x++)P=Us(K=l.g=d[x],g,!1,l)&&P}function Us(o,l,d,g){if(!(l=o.i.g[String(l)]))return!0;l=l.concat();for(var P=!0,x=0;x<l.length;++x){var K=l[x];if(K&&!K.da&&K.capture==d){var fe=K.listener,Ke=K.ha||K.src;K.fa&&Vu(o.i,K),P=!1!==fe.call(Ke,g)&&P}}return P&&!g.defaultPrevented}function _d(o,l,d){if("function"==typeof o)d&&(o=y(o,d));else{if(!o||"function"!=typeof o.handleEvent)throw Error("Invalid listener argument");o=y(o.handleEvent,o)}return 2147483647<Number(l)?-1:u.setTimeout(o,l||0)}function yd(o){o.g=_d(()=>{o.g=null,o.i&&(o.i=!1,yd(o))},o.l);const l=o.h;o.h=null,o.m.apply(null,l)}N(We,sn),We.prototype[yi]=!0,We.prototype.removeEventListener=function(o,l,d,g){gd(this,o,l,d,g)},We.prototype.N=function(){if(We.aa.N.call(this),this.i){var l,o=this.i;for(l in o.g){for(var d=o.g[l],g=0;g<d.length;g++)Bs(d[g]);delete o.g[l],o.h--}}this.F=null},We.prototype.K=function(o,l,d,g){return this.i.add(String(o),l,!1,d,g)},We.prototype.L=function(o,l,d,g){return this.i.add(String(o),l,!0,d,g)};class T_ extends sn{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:yd(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ii(o){sn.call(this),this.h=o,this.g={}}N(Ii,sn);var Id=[];function Td(o){Z(o.g,function(l,d){this.g.hasOwnProperty(d)&&Cu(l)},o),o.g={}}Ii.prototype.N=function(){Ii.aa.N.call(this),Td(this)},Ii.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Fu=u.JSON.stringify,E_=u.JSON.parse,v_=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Mu(){}function vd(){}Mu.prototype.h=null;var Ti={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Ou(){$e.call(this,"d")}function Lu(){$e.call(this,"c")}N(Ou,$e),N(Lu,$e);var Fn={},Ad=null;function Gs(){return Ad=Ad||new We}function wd(o){$e.call(this,Fn.La,o)}function Ei(o){const l=Gs();Xe(l,new wd(l))}function Rd(o,l){$e.call(this,Fn.STAT_EVENT,o),this.stat=l}function Ze(o){const l=Gs();Xe(l,new Rd(l,o))}function Pd(o,l){$e.call(this,Fn.Ma,o),this.size=l}function vi(o,l){if("function"!=typeof o)throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},l)}function Ai(){this.g=!0}function Er(o,l,d,g){o.info(function(){return"XMLHTTP TEXT ("+l+"): "+function P_(o,l){if(!o.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d)for(o=0;o<d.length;o++)if(Array.isArray(d[o])){var g=d[o];if(!(2>g.length)){var P=g[1];if(Array.isArray(P)&&!(1>P.length)){var x=P[0];if("noop"!=x&&"stop"!=x&&"close"!=x)for(var K=1;K<P.length;K++)P[K]=""}}}return Fu(d)}catch{return l}}(o,d)+(g?" "+g:"")})}Fn.La="serverreachability",N(wd,$e),Fn.STAT_EVENT="statevent",N(Rd,$e),Fn.Ma="timingevent",N(Pd,$e),Ai.prototype.xa=function(){this.g=!1},Ai.prototype.info=function(){};var Bu,Ks={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Vd={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function zs(){}function on(o,l,d,g){this.j=o,this.i=l,this.l=d,this.R=g||1,this.U=new Ii(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Sd}function Sd(){this.i=null,this.g="",this.h=!1}N(zs,Mu),zs.prototype.g=function(){return new XMLHttpRequest},zs.prototype.i=function(){return{}},Bu=new zs;var bd={},qu={};function Uu(o,l,d){o.L=1,o.v=Ws(kt(l)),o.m=d,o.P=!0,xd(o,null)}function xd(o,l){o.F=Date.now(),js(o),o.A=kt(o.v);var d=o.A,g=o.R;Array.isArray(g)||(g=[String(g)]),zd(d.i,"t",g),o.C=0,d=o.j.J,o.h=new Sd,o.g=cf(o.j,d?l:null,!o.m),0<o.O&&(o.M=new T_(y(o.Y,o,o.g),o.O)),l=o.U,d=o.g,g=o.ca;var P="readystatechange";Array.isArray(P)||(P&&(Id[0]=P.toString()),P=Id);for(var x=0;x<P.length;x++){var K=dd(d,P[x],g||l.handleEvent,!1,l.h||l);if(!K)break;l.g[K.key]=K}l=o.H?_(o.H):{},o.m?(o.u||(o.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,l)):(o.u="GET",o.g.ea(o.A,o.u,null,l)),Ei(),function A_(o,l,d,g,P,x){o.info(function(){if(o.g)if(x)for(var K="",fe=x.split("&"),Ke=0;Ke<fe.length;Ke++){var ae=fe[Ke].split("=");if(1<ae.length){var He=ae[0];ae=ae[1];var Je=He.split("_");K=2<=Je.length&&"type"==Je[1]?K+(He+"=")+ae+"&":K+(He+"=redacted&")}}else K=null;else K=x;return"XMLHTTP REQ ("+g+") [attempt "+P+"]: "+l+"\n"+d+"\n"+K})}(o.i,o.u,o.A,o.l,o.R,o.m)}function Cd(o){return!!o.g&&"GET"==o.u&&2!=o.L&&o.j.Ca}function V_(o,l){var d=o.C,g=l.indexOf("\n",d);return-1==g?qu:(d=Number(l.substring(d,g)),isNaN(d)?bd:(g+=1)+d>l.length?qu:(l=l.slice(g,g+d),o.C=g+d,l))}function js(o){o.S=Date.now()+o.I,Dd(o,o.I)}function Dd(o,l){if(null!=o.B)throw Error("WatchDog timer not null");o.B=vi(y(o.ba,o),l)}function Gu(o){o.B&&(u.clearTimeout(o.B),o.B=null)}function wi(o){0==o.j.G||o.J||sf(o.j,o)}function Mn(o){Gu(o);var l=o.M;l&&"function"==typeof l.ma&&l.ma(),o.M=null,Td(o.U),o.g&&(l=o.g,o.g=null,l.abort(),l.ma())}function Ku(o,l){try{var d=o.j;if(0!=d.G&&(d.g==o||zu(d.h,o)))if(!o.K&&zu(d.h,o)&&3==d.G){try{var g=d.Da.g.parse(l)}catch{g=null}if(Array.isArray(g)&&3==g.length){var P=g;if(0==P[0]){e:if(!d.u){if(d.g){if(!(d.g.F+3e3<o.F))break e;Zs(d),Ys(d)}Wu(d),Ze(18)}}else d.za=P[1],0<d.za-d.T&&37500>P[2]&&d.F&&0==d.v&&!d.C&&(d.C=vi(y(d.Za,d),6e3));if(1>=Fd(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else Ln(d,11)}else if((o.K||d.g==o)&&Zs(d),!H(l))for(P=d.Da.g.parse(l),l=0;l<P.length;l++){let ae=P[l];if(d.T=ae[0],ae=ae[1],2==d.G)if("c"==ae[0]){d.K=ae[1],d.ia=ae[2];const He=ae[3];null!=He&&(d.la=He,d.j.info("VER="+d.la));const Je=ae[4];null!=Je&&(d.Aa=Je,d.j.info("SVER="+d.Aa));const wr=ae[5];null!=wr&&"number"==typeof wr&&0<wr&&(d.L=g=1.5*wr,d.j.info("backChannelRequestTimeoutMs_="+g)),g=d;const lt=o.g;if(lt){const to=lt.g?lt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(to){var x=g.h;x.g||-1==to.indexOf("spdy")&&-1==to.indexOf("quic")&&-1==to.indexOf("h2")||(x.j=x.l,x.g=new Set,x.h&&(ju(x,x.h),x.h=null))}if(g.D){const Ju=lt.g?lt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ju&&(g.ya=Ju,ye(g.I,g.D,Ju))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-o.F,d.j.info("Handshake RTT: "+d.R+"ms"));var K=o;if((g=d).qa=uf(g,g.J?g.ia:null,g.W),K.K){Md(g.h,K);var fe=K,Ke=g.L;Ke&&(fe.I=Ke),fe.B&&(Gu(fe),js(fe)),g.g=K}else nf(g);0<d.i.length&&Xs(d)}else"stop"!=ae[0]&&"close"!=ae[0]||Ln(d,7);else 3==d.G&&("stop"==ae[0]||"close"==ae[0]?"stop"==ae[0]?Ln(d,7):$u(d):"noop"!=ae[0]&&d.l&&d.l.ta(ae),d.v=0)}Ei()}catch{}}on.prototype.ca=function(o){o=o.target;const l=this.M;l&&3==Ft(o)?l.j():this.Y(o)},on.prototype.Y=function(o){try{if(o==this.g)e:{const Je=Ft(this.g);var l=this.g.Ba();if(this.g.Z(),!(3>Je)&&(3!=Je||this.g&&(this.h.h||this.g.oa()||Yd(this.g)))){this.J||4!=Je||7==l||Ei(),Gu(this);var d=this.g.Z();this.X=d;t:if(Cd(this)){var g=Yd(this.g);o="";var P=g.length,x=4==Ft(this.g);if(!this.h.i){if(typeof TextDecoder>"u"){Mn(this),wi(this);var K="";break t}this.h.i=new u.TextDecoder}for(l=0;l<P;l++)this.h.h=!0,o+=this.h.i.decode(g[l],{stream:!(x&&l==P-1)});g.length=0,this.h.g+=o,this.C=0,K=this.h.g}else K=this.g.oa();if(this.o=200==d,function w_(o,l,d,g,P,x,K){o.info(function(){return"XMLHTTP RESP ("+g+") [ attempt "+P+"]: "+l+"\n"+d+"\n"+x+" "+K})}(this.i,this.u,this.A,this.l,this.R,Je,d),this.o){if(this.T&&!this.K){t:{if(this.g){var fe,Ke=this.g;if((fe=Ke.g?Ke.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(fe)){var ae=fe;break t}}ae=null}if(!(d=ae)){this.o=!1,this.s=3,Ze(12),Mn(this),wi(this);break e}Er(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ku(this,d)}if(this.P){let lt;for(d=!0;!this.J&&this.C<K.length;){if(lt=V_(this,K),lt==qu){4==Je&&(this.s=4,Ze(14),d=!1),Er(this.i,this.l,null,"[Incomplete Response]");break}if(lt==bd){this.s=4,Ze(15),Er(this.i,this.l,K,"[Invalid Chunk]"),d=!1;break}Er(this.i,this.l,lt,null),Ku(this,lt)}if(Cd(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=Je||0!=K.length||this.h.h||(this.s=1,Ze(16),d=!1),this.o=this.o&&d,d){if(0<K.length&&!this.W){this.W=!0;var He=this.j;He.g==this&&He.ba&&!He.M&&(He.j.info("Great, no buffering proxy detected. Bytes received: "+K.length),Hu(He),He.M=!0,Ze(11))}}else Er(this.i,this.l,K,"[Invalid Chunked Response]"),Mn(this),wi(this)}else Er(this.i,this.l,K,null),Ku(this,K);4==Je&&Mn(this),this.o&&!this.J&&(4==Je?sf(this.j,this):(this.o=!1,js(this)))}else(function z_(o){const l={};o=(o.g&&2<=Ft(o)&&o.g.getAllResponseHeaders()||"").split("\r\n");for(let g=0;g<o.length;g++){if(H(o[g]))continue;var d=w(o[g]);const P=d[0];if("string"!=typeof(d=d[1]))continue;d=d.trim();const x=l[P]||[];l[P]=x,x.push(d)}!function v(o,l){for(const d in o)l.call(void 0,o[d],d,o)}(l,function(g){return g.join(", ")})})(this.g),400==d&&0<K.indexOf("Unknown SID")?(this.s=3,Ze(12)):(this.s=0,Ze(13)),Mn(this),wi(this)}}}catch{}},on.prototype.cancel=function(){this.J=!0,Mn(this)},on.prototype.ba=function(){this.B=null;const o=Date.now();0<=o-this.S?(function R_(o,l){o.info(function(){return"TIMEOUT: "+l})}(this.i,this.A),2!=this.L&&(Ei(),Ze(17)),Mn(this),this.s=2,wi(this)):Dd(this,this.S-o)};var S_=class{constructor(o,l){this.g=o,this.map=l}};function Nd(o){this.l=o||10,o=u.PerformanceNavigationTiming?0<(o=u.performance.getEntriesByType("navigation")).length&&("hq"==o[0].nextHopProtocol||"h2"==o[0].nextHopProtocol):!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function kd(o){return!!o.h||!!o.g&&o.g.size>=o.j}function Fd(o){return o.h?1:o.g?o.g.size:0}function zu(o,l){return o.h?o.h==l:!!o.g&&o.g.has(l)}function ju(o,l){o.g?o.g.add(l):o.h=l}function Md(o,l){o.h&&o.h==l?o.h=null:o.g&&o.g.has(l)&&o.g.delete(l)}function Od(o){if(null!=o.h)return o.i.concat(o.h.D);if(null!=o.g&&0!==o.g.size){let l=o.i;for(const d of o.g.values())l=l.concat(d.D);return l}return L(o.i)}function Ld(o,l){if(o.forEach&&"function"==typeof o.forEach)o.forEach(l,void 0);else if(c(o)||"string"==typeof o)Array.prototype.forEach.call(o,l,void 0);else for(var d=function x_(o){if(o.na&&"function"==typeof o.na)return o.na();if(!o.V||"function"!=typeof o.V){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(c(o)||"string"==typeof o){var l=[];o=o.length;for(var d=0;d<o;d++)l.push(d);return l}l=[],d=0;for(const g in o)l[d++]=g;return l}}}(o),g=function b_(o){if(o.V&&"function"==typeof o.V)return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if("string"==typeof o)return o.split("");if(c(o)){for(var l=[],d=o.length,g=0;g<d;g++)l.push(o[g]);return l}for(g in l=[],d=0,o)l[d++]=o[g];return l}(o),P=g.length,x=0;x<P;x++)l.call(void 0,g[x],d&&d[x],o)}Nd.prototype.cancel=function(){if(this.i=Od(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const o of this.g.values())o.cancel();this.g.clear()}};var Bd=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function On(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof On){this.h=o.h,Qs(this,o.j),this.o=o.o,this.g=o.g,$s(this,o.s),this.l=o.l;var l=o.i,d=new Vi;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),qd(this,d),this.m=o.m}else o&&(l=String(o).match(Bd))?(this.h=!1,Qs(this,l[1]||"",!0),this.o=Ri(l[2]||""),this.g=Ri(l[3]||"",!0),$s(this,l[4]),this.l=Ri(l[5]||"",!0),qd(this,l[6]||"",!0),this.m=Ri(l[7]||"")):(this.h=!1,this.i=new Vi(null,this.h))}function kt(o){return new On(o)}function Qs(o,l,d){o.j=d?Ri(l,!0):l,o.j&&(o.j=o.j.replace(/:$/,""))}function $s(o,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);o.s=l}else o.s=null}function qd(o,l,d){l instanceof Vi?(o.i=l,function O_(o,l){l&&!o.j&&(an(o),o.i=null,o.g.forEach(function(d,g){var P=g.toLowerCase();g!=P&&(Gd(this,g),zd(this,P,d))},o)),o.j=l}(o.i,o.h)):(d||(l=Pi(l,F_)),o.i=new Vi(l,o.h))}function ye(o,l,d){o.i.set(l,d)}function Ws(o){return ye(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ri(o,l){return o?l?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Pi(o,l,d){return"string"==typeof o?(o=encodeURI(o).replace(l,D_),d&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function D_(o){return"%"+((o=o.charCodeAt(0))>>4&15).toString(16)+(15&o).toString(16)}On.prototype.toString=function(){var o=[],l=this.j;l&&o.push(Pi(l,Ud,!0),":");var d=this.g;return(d||"file"==l)&&(o.push("//"),(l=this.o)&&o.push(Pi(l,Ud,!0),"@"),o.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(d=this.s)&&o.push(":",String(d))),(d=this.l)&&(this.g&&"/"!=d.charAt(0)&&o.push("/"),o.push(Pi(d,"/"==d.charAt(0)?k_:N_,!0))),(d=this.i.toString())&&o.push("?",d),(d=this.m)&&o.push("#",Pi(d,M_)),o.join("")};var Ud=/[#\/\?@]/g,N_=/[#\?:]/g,k_=/[#\?]/g,F_=/[#\?@]/g,M_=/#/g;function Vi(o,l){this.h=this.g=null,this.i=o||null,this.j=!!l}function an(o){o.g||(o.g=new Map,o.h=0,o.i&&function C_(o,l){if(o){o=o.split("&");for(var d=0;d<o.length;d++){var g=o[d].indexOf("="),P=null;if(0<=g){var x=o[d].substring(0,g);P=o[d].substring(g+1)}else x=o[d];l(x,P?decodeURIComponent(P.replace(/\+/g," ")):"")}}}(o.i,function(l,d){o.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}function Gd(o,l){an(o),l=vr(o,l),o.g.has(l)&&(o.i=null,o.h-=o.g.get(l).length,o.g.delete(l))}function Kd(o,l){return an(o),l=vr(o,l),o.g.has(l)}function zd(o,l,d){Gd(o,l),0<d.length&&(o.i=null,o.g.set(vr(o,l),L(d)),o.h+=d.length)}function vr(o,l){return l=String(l),o.j&&(l=l.toLowerCase()),l}function un(o,l,d,g,P){try{P&&(P.onload=null,P.onerror=null,P.onabort=null,P.ontimeout=null),g(d)}catch{}}function q_(){this.g=new v_}function U_(o,l,d){const g=d||"";try{Ld(o,function(P,x){let K=P;h(P)&&(K=Fu(P)),l.push(g+x+"="+encodeURIComponent(K))})}catch(P){throw l.push(g+"type="+encodeURIComponent("_badmap")),P}}function Si(o){this.l=o.Ub||null,this.j=o.eb||!1}function Hs(o,l){We.call(this),this.D=o,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function jd(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}function bi(o){o.readyState=4,o.l=null,o.j=null,o.v=null,xi(o)}function xi(o){o.onreadystatechange&&o.onreadystatechange.call(o)}function Qd(o){let l="";return Z(o,function(d,g){l+=g,l+=":",l+=d,l+="\r\n"}),l}function Qu(o,l,d){e:{for(g in d){var g=!1;break e}g=!0}g||(d=Qd(d),"string"==typeof o?null!=d&&encodeURIComponent(String(d)):ye(o,l,d))}function Pe(o){We.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(r=Vi.prototype).add=function(o,l){an(this),this.i=null,o=vr(this,o);var d=this.g.get(o);return d||this.g.set(o,d=[]),d.push(l),this.h+=1,this},r.forEach=function(o,l){an(this),this.g.forEach(function(d,g){d.forEach(function(P){o.call(l,P,g,this)},this)},this)},r.na=function(){an(this);const o=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let g=0;g<l.length;g++){const P=o[g];for(let x=0;x<P.length;x++)d.push(l[g])}return d},r.V=function(o){an(this);let l=[];if("string"==typeof o)Kd(this,o)&&(l=l.concat(this.g.get(vr(this,o))));else{o=Array.from(this.g.values());for(let d=0;d<o.length;d++)l=l.concat(o[d])}return l},r.set=function(o,l){return an(this),this.i=null,Kd(this,o=vr(this,o))&&(this.h-=this.g.get(o).length),this.g.set(o,[l]),this.h+=1,this},r.get=function(o,l){return o&&0<(o=this.V(o)).length?String(o[0]):l},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var g=l[d];const x=encodeURIComponent(String(g)),K=this.V(g);for(g=0;g<K.length;g++){var P=x;""!==K[g]&&(P+="="+encodeURIComponent(String(K[g]))),o.push(P)}}return this.i=o.join("&")},N(Si,Mu),Si.prototype.g=function(){return new Hs(this.l,this.j)},Si.prototype.i=function(o){return function(){return o}}({}),N(Hs,We),(r=Hs.prototype).open=function(o,l){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=l,this.readyState=1,xi(this)},r.send=function(o){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(l.body=o),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bi(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,xi(this)),this.g&&(this.readyState=3,xi(this),this.g)))if("arraybuffer"===this.responseType)o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;jd(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))},r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var l=o.value?o.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!o.done}))&&(this.response=this.responseText+=l)}o.done?bi(this):xi(this),3==this.readyState&&jd(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,bi(this))},r.Qa=function(o){this.g&&(this.response=o,bi(this))},r.ga=function(){this.g&&bi(this)},r.setRequestHeader=function(o,l){this.u.append(o,l)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],l=this.h.entries();for(var d=l.next();!d.done;)o.push((d=d.value)[0]+": "+d[1]),d=l.next();return o.join("\r\n")},Object.defineProperty(Hs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(o){this.m=o?"include":"same-origin"}}),N(Pe,We);var G_=/^https?$/i,K_=["POST","PUT"];function $d(o,l){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=l,o.m=5,Wd(o),Js(o)}function Wd(o){o.A||(o.A=!0,Xe(o,"complete"),Xe(o,"error"))}function Hd(o){if(o.h&&typeof a<"u"&&(!o.v[1]||4!=Ft(o)||2!=o.Z()))if(o.u&&4==Ft(o))_d(o.Ea,0,o);else if(Xe(o,"readystatechange"),4==Ft(o)){o.h=!1;try{const K=o.Z();e:switch(K){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break e;default:l=!1}var d;if(!(d=l)){var g;if(g=0===K){var P=String(o.D).match(Bd)[1]||null;!P&&u.self&&u.self.location&&(P=u.self.location.protocol.slice(0,-1)),g=!G_.test(P?P.toLowerCase():"")}d=g}if(d)Xe(o,"complete"),Xe(o,"success");else{o.m=6;try{var x=2<Ft(o)?o.g.statusText:""}catch{x=""}o.l=x+" ["+o.Z()+"]",Wd(o)}}finally{Js(o)}}}function Js(o,l){if(o.g){Jd(o);const d=o.g,g=o.v[0]?()=>{}:null;o.g=null,o.v=null,l||Xe(o,"ready");try{d.onreadystatechange=g}catch{}}}function Jd(o){o.I&&(u.clearTimeout(o.I),o.I=null)}function Ft(o){return o.g?o.g.readyState:0}function Yd(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function Ci(o,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[o]||l}function Xd(o){this.Aa=0,this.i=[],this.j=new Ai,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ci("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ci("baseRetryDelayMs",5e3,o),this.cb=Ci("retryDelaySeedMs",1e4,o),this.Wa=Ci("forwardChannelMaxRetries",2,o),this.wa=Ci("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new Nd(o&&o.concurrentRequestLimit),this.Da=new q_,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function $u(o){if(Zd(o),3==o.G){var l=o.U++,d=kt(o.I);if(ye(d,"SID",o.K),ye(d,"RID",l),ye(d,"TYPE","terminate"),Di(o,d),(l=new on(o,o.j,l)).L=2,l.v=Ws(kt(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&((new Image).src=l.v,d=!0),d||(l.g=cf(l.j,null),l.g.ea(l.v)),l.F=Date.now(),js(l)}af(o)}function Ys(o){o.g&&(Hu(o),o.g.cancel(),o.g=null)}function Zd(o){Ys(o),o.u&&(u.clearTimeout(o.u),o.u=null),Zs(o),o.h.cancel(),o.s&&("number"==typeof o.s&&u.clearTimeout(o.s),o.s=null)}function Xs(o){if(!kd(o.h)&&!o.s){o.s=!0;var l=o.Ga;gi||hd(),pi||(gi(),pi=!0),Pu.add(l,o),o.B=0}}function ef(o,l){var d;d=l?l.l:o.U++;const g=kt(o.I);ye(g,"SID",o.K),ye(g,"RID",d),ye(g,"AID",o.T),Di(o,g),o.m&&o.o&&Qu(g,o.m,o.o),d=new on(o,o.j,d,o.B+1),null===o.m&&(d.H=o.o),l&&(o.i=l.D.concat(o.i)),l=tf(o,d,1e3),d.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),ju(o.h,d),Uu(d,g,l)}function Di(o,l){o.H&&Z(o.H,function(d,g){ye(l,g,d)}),o.l&&Ld({},function(d,g){ye(l,g,d)})}function tf(o,l,d){d=Math.min(o.i.length,d);var g=o.l?y(o.l.Na,o.l,o):null;e:{var P=o.i;let x=-1;for(;;){const K=["count="+d];-1==x?0<d?(x=P[0].g,K.push("ofs="+x)):x=0:K.push("ofs="+x);let fe=!0;for(let Ke=0;Ke<d;Ke++){let ae=P[Ke].g;const He=P[Ke].map;if(ae-=x,0>ae)x=Math.max(0,P[Ke].g-100),fe=!1;else try{U_(He,K,"req"+ae+"_")}catch{g&&g(He)}}if(fe){g=K.join("&");break e}}}return o=o.i.splice(0,d),l.D=o,g}function nf(o){if(!o.g&&!o.u){o.Y=1;var l=o.Fa;gi||hd(),pi||(gi(),pi=!0),Pu.add(l,o),o.v=0}}function Wu(o){return!(o.g||o.u||3<=o.v||(o.Y++,o.u=vi(y(o.Fa,o),of(o,o.v)),o.v++,0))}function Hu(o){null!=o.A&&(u.clearTimeout(o.A),o.A=null)}function rf(o){o.g=new on(o,o.j,"rpc",o.Y),null===o.m&&(o.g.H=o.o),o.g.O=0;var l=kt(o.qa);ye(l,"RID","rpc"),ye(l,"SID",o.K),ye(l,"AID",o.T),ye(l,"CI",o.F?"0":"1"),!o.F&&o.ja&&ye(l,"TO",o.ja),ye(l,"TYPE","xmlhttp"),Di(o,l),o.m&&o.o&&Qu(l,o.m,o.o),o.L&&(o.g.I=o.L);var d=o.g;o=o.ia,d.L=1,d.v=Ws(kt(l)),d.m=null,d.P=!0,xd(d,o)}function Zs(o){null!=o.C&&(u.clearTimeout(o.C),o.C=null)}function sf(o,l){var d=null;if(o.g==l){Zs(o),Hu(o),o.g=null;var g=2}else{if(!zu(o.h,l))return;d=l.D,Md(o.h,l),g=1}if(0!=o.G)if(l.o)if(1==g){d=l.m?l.m.length:0,l=Date.now()-l.F;var P=o.B;Xe(g=Gs(),new Pd(g,d)),Xs(o)}else nf(o);else if(3==(P=l.s)||0==P&&0<l.X||!(1==g&&function j_(o,l){return!(Fd(o.h)>=o.h.j-(o.s?1:0)||(o.s?(o.i=l.D.concat(o.i),0):1==o.G||2==o.G||o.B>=(o.Va?0:o.Wa)||(o.s=vi(y(o.Ga,o,l),of(o,o.B)),o.B++,0)))}(o,l)||2==g&&Wu(o)))switch(d&&0<d.length&&(l=o.h,l.i=l.i.concat(d)),P){case 1:Ln(o,5);break;case 4:Ln(o,10);break;case 3:Ln(o,6);break;default:Ln(o,2)}}function of(o,l){let d=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(d*=2),d*l}function Ln(o,l){if(o.j.info("Error code "+l),2==l){var d=y(o.fb,o),g=o.Xa;const P=!g;g=new On(g||"//www.google.com/images/cleardot.gif"),u.location&&"http"==u.location.protocol||Qs(g,"https"),Ws(g),P?function L_(o,l){const d=new Ai;if(u.Image){const g=new Image;g.onload=V(un,d,"TestLoadImage: loaded",!0,l,g),g.onerror=V(un,d,"TestLoadImage: error",!1,l,g),g.onabort=V(un,d,"TestLoadImage: abort",!1,l,g),g.ontimeout=V(un,d,"TestLoadImage: timeout",!1,l,g),u.setTimeout(function(){g.ontimeout&&g.ontimeout()},1e4),g.src=o}else l(!1)}(g.toString(),d):function B_(o,l){new Ai;const g=new AbortController,P=setTimeout(()=>{g.abort(),un(0,0,!1,l)},1e4);fetch(o,{signal:g.signal}).then(x=>{clearTimeout(P),un(0,0,!!x.ok,l)}).catch(()=>{clearTimeout(P),un(0,0,!1,l)})}(g.toString(),d)}else Ze(2);o.G=0,o.l&&o.l.sa(l),af(o),Zd(o)}function af(o){if(o.G=0,o.ka=[],o.l){const l=Od(o.h);(0!=l.length||0!=o.i.length)&&(M(o.ka,l),M(o.ka,o.i),o.h.i.length=0,L(o.i),o.i.length=0),o.l.ra()}}function uf(o,l,d){var g=d instanceof On?kt(d):new On(d);if(""!=g.g)l&&(g.g=l+"."+g.g),$s(g,g.s);else{var P=u.location;g=P.protocol,l=l?l+"."+P.hostname:P.hostname,P=+P.port;var x=new On(null);g&&Qs(x,g),l&&(x.g=l),P&&$s(x,P),d&&(x.l=d),g=x}return l=o.ya,(d=o.D)&&l&&ye(g,d,l),ye(g,"VER",o.la),Di(o,g),g}function cf(o,l,d){if(l&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return(l=new Pe(o.Ca&&!o.pa?new Si({eb:d}):o.pa)).Ha(o.J),l}function lf(){}function eo(){}function ot(o,l){We.call(this),this.g=new Xd(l),this.l=o,this.h=l&&l.messageUrlParams||null,o=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(o?o["X-WebChannel-Content-Type"]=l.messageContentType:o={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(o?o["X-WebChannel-Client-Profile"]=l.va:o={"X-WebChannel-Client-Profile":l.va}),this.g.S=o,(o=l&&l.Sb)&&!H(o)&&(this.g.m=o),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!H(l)&&(this.g.D=l,null!==(o=this.h)&&l in o&&l in(o=this.h)&&delete o[l]),this.j=new Ar(this)}function hf(o){Ou.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var l=o.__sm__;if(l){e:{for(const d in l){o=d;break e}o=void 0}(this.i=o)&&(o=this.i,l=null!==l&&o in l?l[o]:void 0),this.data=l}else this.data=o}function df(){Lu.call(this),this.status=1}function Ar(o){this.g=o}(r=Pe.prototype).Ha=function(o){this.J=o},r.ea=function(o,l,d,g){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);l=l?l.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Bu.g(),this.v=function Ed(o){return o.h||(o.h=o.i())}(this.o?this.o:Bu),this.g.onreadystatechange=y(this.Ea,this);try{this.B=!0,this.g.open(l,String(o),!0),this.B=!1}catch(x){return void $d(this,x)}if(o=d||"",d=new Map(this.headers),g)if(Object.getPrototypeOf(g)===Object.prototype)for(var P in g)d.set(P,g[P]);else{if("function"!=typeof g.keys||"function"!=typeof g.get)throw Error("Unknown input type for opt_headers: "+String(g));for(const x of g.keys())d.set(x,g.get(x))}g=Array.from(d.keys()).find(x=>"content-type"==x.toLowerCase()),P=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(K_,l,void 0))||g||P||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[x,K]of d)this.g.setRequestHeader(x,K);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Jd(this),this.u=!0,this.g.send(o),this.u=!1}catch(x){$d(this,x)}},r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,Xe(this,"complete"),Xe(this,"abort"),Js(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Js(this,!0)),Pe.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Hd(this):this.bb())},r.bb=function(){Hd(this)},r.isActive=function(){return!!this.g},r.Z=function(){try{return 2<Ft(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var l=this.g.responseText;return o&&0==l.indexOf(o)&&(l=l.substring(o.length)),E_(l)}},r.Ba=function(){return this.m},r.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(r=Xd.prototype).la=8,r.G=1,r.connect=function(o,l,d,g){Ze(0),this.W=o,this.H=l||{},d&&void 0!==g&&(this.H.OSID=d,this.H.OAID=g),this.F=this.X,this.I=uf(this,null,this.W),Xs(this)},r.Ga=function(o){if(this.s)if(this.s=null,1==this.G){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;const P=new on(this,this.j,o);let x=this.o;if(this.S&&(x?(x=_(x),A(x,this.S)):x=this.S),null!==this.m||this.O||(P.H=x,x=null),this.P)e:{for(var l=0,d=0;d<this.i.length;d++){var g=this.i[d];if(void 0===(g="__data__"in g.map&&"string"==typeof(g=g.map.__data__)?g.length:void 0))break;if(4096<(l+=g)){l=d;break e}if(4096===l||d===this.i.length-1){l=d+1;break e}}l=1e3}else l=1e3;l=tf(this,P,l),ye(d=kt(this.I),"RID",o),ye(d,"CVER",22),this.D&&ye(d,"X-HTTP-Session-Id",this.D),Di(this,d),x&&(this.O?l="headers="+encodeURIComponent(String(Qd(x)))+"&"+l:this.m&&Qu(d,this.m,x)),ju(this.h,P),this.Ua&&ye(d,"TYPE","init"),this.P?(ye(d,"$req",l),ye(d,"SID","null"),P.T=!0,Uu(P,d,null)):Uu(P,d,l),this.G=2}}else 3==this.G&&(o?ef(this,o):0==this.i.length||kd(this.h)||ef(this))},r.Fa=function(){if(this.u=null,rf(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=vi(y(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ze(10),Ys(this),rf(this))},r.Za=function(){null!=this.C&&(this.C=null,Ys(this),Wu(this),Ze(19))},r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Ze(2)):(this.j.info("Failed to ping google.com"),Ze(1))},r.isActive=function(){return!!this.l&&this.l.isActive(this)},(r=lf.prototype).ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){},eo.prototype.g=function(o,l){return new ot(o,l)},N(ot,We),ot.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},ot.prototype.close=function(){$u(this.g)},ot.prototype.o=function(o){var l=this.g;if("string"==typeof o){var d={};d.__data__=o,o=d}else this.u&&((d={}).__data__=Fu(o),o=d);l.i.push(new S_(l.Ya++,o)),3==l.G&&Xs(l)},ot.prototype.N=function(){this.g.l=null,delete this.j,$u(this.g),delete this.g,ot.aa.N.call(this)},N(hf,Ou),N(df,Lu),N(Ar,lf),Ar.prototype.ua=function(){Xe(this.g,"a")},Ar.prototype.ta=function(o){Xe(this.g,new hf(o))},Ar.prototype.sa=function(o){Xe(this.g,new df)},Ar.prototype.ra=function(){Xe(this.g,"b")},eo.prototype.createWebChannel=eo.prototype.g,ot.prototype.send=ot.prototype.o,ot.prototype.open=ot.prototype.m,ot.prototype.close=ot.prototype.close,Fi=rt.createWebChannelTransport=function(){return new eo},io=rt.getStatEventTarget=function(){return Gs()},Pr=rt.Event=Fn,Rr=rt.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ks.NO_ERROR=0,Ks.TIMEOUT=8,Ks.HTTP_ERROR=6,Ot=rt.ErrorCode=Ks,Vd.COMPLETE="complete",it=rt.EventType=Vd,vd.EventType=Ti,Ti.OPEN="a",Ti.CLOSE="b",Ti.ERROR="c",Ti.MESSAGE="d",We.prototype.listen=We.prototype.K,vt=rt.WebChannel=vd,rt.FetchXmlHttpFactory=Si,Pe.prototype.listenOnce=Pe.prototype.L,Pe.prototype.getLastError=Pe.prototype.Ka,Pe.prototype.getLastErrorCode=Pe.prototype.Ba,Pe.prototype.getStatus=Pe.prototype.Z,Pe.prototype.getResponseJson=Pe.prototype.Oa,Pe.prototype.getResponseText=Pe.prototype.oa,Pe.prototype.send=Pe.prototype.ea,Pe.prototype.setWithCredentials=Pe.prototype.Ha,ki=rt.XhrIo=Pe}).apply(typeof ln<"u"?ln:typeof self<"u"?self:typeof window<"u"?window:{});const B="@firebase/firestore";class Ve{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ve.UNAUTHENTICATED=new Ve(null),Ve.GOOGLE_CREDENTIALS=new Ve("google-credentials-uid"),Ve.FIRST_PARTY=new Ve("first-party-uid"),Ve.MOCK_USER=new Ve("mock-user");let Lt="10.14.0";const ht=new Ie.Vy("@firebase/firestore");function Bt(){return ht.logLevel}function Vr(r){ht.setLogLevel(r)}function F(r,...e){if(ht.logLevel<=Ie.$b.DEBUG){const t=e.map(hn);ht.debug(`Firestore (${Lt}): ${r}`,...t)}}function Te(r,...e){if(ht.logLevel<=Ie.$b.ERROR){const t=e.map(hn);ht.error(`Firestore (${Lt}): ${r}`,...t)}}function Ce(r,...e){if(ht.logLevel<=Ie.$b.WARN){const t=e.map(hn);ht.warn(`Firestore (${Lt}): ${r}`,...t)}}function hn(r){if("string"==typeof r)return r;try{return JSON.stringify(r)}catch{return r}}function z(r="Unexpected state"){const e=`FIRESTORE (${Lt}) INTERNAL ASSERTION FAILED: `+r;throw Te(e),new Error(e)}function j(r,e){r||z()}function Mi(r,e){r||z()}function q(r,e){return r}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class k extends re.g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Se{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class dt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class et{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ve.UNAUTHENTICATED))}shutdown(){}}class Oe{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Oi{constructor(e){this.t=e,this.currentUser=Ve.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var n=this;j(void 0===this.o);let i=this.i;const s=h=>this.i!==i?(i=this.i,t(h)):Promise.resolve();let a=new Se;this.o=()=>{this.i++,this.currentUser=this.u(),a.resolve(),a=new Se,e.enqueueRetryable(()=>s(this.currentUser))};const u=()=>{const h=a;e.enqueueRetryable((0,C.A)(function*(){yield h.promise,yield s(n.currentUser)}))},c=h=>{F("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(h=>c(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?c(h):(F("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new Se)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(n=>this.i!==e?(F("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(j("string"==typeof n.accessToken),new dt(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return j(null===e||"string"==typeof e),new Ve(e)}}class Li{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ve.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class dn{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new Li(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ve.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qt{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Le{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){j(void 0===this.o);const n=s=>{null!=s.error&&F("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,F("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>n(s))};const i=s=>{F("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):F("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(j("string"==typeof t.token),this.R=t.token,new qt(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Sr(r){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(r);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let n=0;n<r;n++)t[n]=Math.floor(256*Math.random());return t}class At{static newId(){const t=62*Math.floor(256/62);let n="";for(;n.length<20;){const i=Sr(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<t&&(n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(i[s]%62))}return n}}function J(r,e){return r<e?-1:r>e?1:0}function ft(r,e,t){return r.length===e.length&&r.every((n,i)=>t(n,e[i]))}function mt(r){return r+"\0"}class ge{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ge.fromMillis(Date.now())}static fromDate(e){return ge.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new ge(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?J(this.nanoseconds,e.nanoseconds):J(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ${constructor(e){this.timestamp=e}static fromTimestamp(e){return new $(e)}static min(){return new $(new ge(0,0))}static max(){return new $(new ge(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class fn{constructor(e,t,n){void 0===t?t=0:t>e.length&&z(),void 0===n?n=e.length-t:n>e.length-t&&z(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===fn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof fn?e.forEach(n=>{t.push(n)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class te extends fn{construct(e,t,n){return new te(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new k(b.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(i=>i.length>0))}return new te(t)}static emptyPath(){return new te([])}}const so=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class le extends fn{construct(e,t,n){return new le(e,t,n)}static isValidIdentifier(e){return so.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),le.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new le(["__name__"])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new k(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let a=!1;for(;i<e.length;){const u=e[i];if("\\"===u){if(i+1===e.length)throw new k(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new k(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=c,i+=2}else"`"===u?(a=!a,i++):"."!==u||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new k(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new le(t)}static emptyPath(){return new le([])}}class G{constructor(e){this.path=e}static fromPath(e){return new G(te.fromString(e))}static fromName(e){return new G(te.fromString(e).popFirst(5))}static empty(){return new G(te.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===te.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return te.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new G(new te(e.slice()))}}class gt{constructor(e,t,n,i){this.indexId=e,this.collectionGroup=t,this.fields=n,this.indexState=i}}function Bn(r){return r.fields.find(e=>2===e.kind)}function at(r){return r.fields.filter(e=>2!==e.kind)}gt.UNKNOWN_ID=-1;class wt{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ut{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ut(0,Ye.min())}}function xr(r,e){const t=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=$.fromTimestamp(1e9===n?new ge(t+1,0):new ge(t,n));return new Ye(i,G.empty(),e)}function Cr(r){return new Ye(r.readTime,r.key,-1)}class Ye{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new Ye($.min(),G.empty(),-1)}static max(){return new Ye($.max(),G.empty(),-1)}}function Dr(r,e){let t=r.readTime.compareTo(e.readTime);return 0!==t?t:(t=G.comparator(r.documentKey,e.documentKey),0!==t?t:J(r.largestBatchId,e.largestBatchId))}const qi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ui{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function pt(r){return qn.apply(this,arguments)}function qn(){return(qn=(0,C.A)(function*(r){if(r.code!==b.FAILED_PRECONDITION||r.message!==qi)throw r;F("LocalStore","Unexpectedly lost primary lease")})).apply(this,arguments)}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&z(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(n,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,n)=>{t(e)})}static reject(e){return new R((t,n)=>{n(e)})}static waitFor(e){return new R((t,n)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&t()},c=>n(c))}),a=!0,s===i&&t()})}static or(e){let t=R.resolve(!1);for(const n of e)t=t.next(i=>i?R.resolve(i):n());return t}static forEach(e,t){const n=[];return e.forEach((i,s)=>{n.push(t.call(this,i,s))}),this.waitFor(n)}static mapArray(e,t){return new R((n,i)=>{const s=e.length,a=new Array(s);let u=0;for(let c=0;c<s;c++){const h=c;t(e[h]).next(f=>{a[h]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(e,t){return new R((n,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):n()};s()})}}class Nr{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Se,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new D(e,t.error)):this.V.resolve()},this.transaction.onerror=n=>{const i=st(n.target.error);this.V.reject(new D(e,i))}}static open(e,t,n,i){try{return new Nr(t,e.transaction(i,n))}catch(s){throw new D(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(F("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new ie(t)}}class O{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===O.S((0,re.ZQ)())&&Te("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return F("SimpleDb","Removing database:",e),ke(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!(0,re.zW)())return!1;if(O.v())return!0;const e=(0,re.ZQ)(),t=O.S(e),n=0<t&&t<10,i=m(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static v(){var e;return typeof process<"u"&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.C)}static F(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(e){var t=this;return(0,C.A)(function*(){return t.db||(F("SimpleDb","Opening database:",t.name),t.db=yield new Promise((n,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=a=>{n(a.target.result)},s.onblocked=()=>{i(new D(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=a=>{const u=a.target.error;i("VersionError"===u.name?new k(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===u.name?new k(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+u):new D(e,u))},s.onupgradeneeded=a=>{F("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',a.oldVersion),t.p.O(a.target.result,s.transaction,a.oldVersion,t.version).next(()=>{F("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.N&&(t.db.onversionchange=n=>t.N(n)),t.db})()}L(e){this.N=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,n,i){var s=this;return(0,C.A)(function*(){const a="readonly"===t;let u=0;for(;;){++u;try{s.db=yield s.M(e);const c=Nr.open(s.db,e,a?"readonly":"readwrite",n),h=i(c).next(f=>(c.g(),f)).catch(f=>(c.abort(f),R.reject(f))).toPromise();return h.catch(()=>{}),yield c.m,h}catch(c){const h=c,f="FirebaseError"!==h.name&&u<3;if(F("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),s.close(),!f)return Promise.reject(h)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}function m(r){const e=r.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}class I{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return ke(this.B.delete())}}class D extends k{constructor(e,t){super(b.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function U(r){return"IndexedDbTransactionError"===r.name}class ie{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(F("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(F("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),ke(n)}add(e){return F("SimpleDb","ADD",this.store.name,e,e),ke(this.store.add(e))}get(e){return ke(this.store.get(e)).next(t=>(void 0===t&&(t=null),F("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return F("SimpleDb","DELETE",this.store.name,e),ke(this.store.delete(e))}count(){return F("SimpleDb","COUNT",this.store.name),ke(this.store.count())}U(e,t){const n=this.options(e,t),i=n.index?this.store.index(n.index):this.store;if("function"==typeof i.getAll){const s=i.getAll(n.range);return new R((a,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{a(c.target.result)}})}{const s=this.cursor(n),a=[];return this.W(s,(u,c)=>{a.push(c)}).next(()=>a)}}G(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new R((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(e,t){F("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.H=!1;const i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(e,t){let n;t?n=e:(n={},t=e);const i=this.cursor(n);return this.W(i,t)}Y(e){const t=this.cursor({});return new R((n,i)=>{t.onerror=s=>{const a=st(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(e,t){const n=[];return new R((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const c=new I(u),h=t(u.primaryKey,u.value,c);if(h instanceof R){const f=h.catch(p=>(c.done(),R.reject(p)));n.push(f)}c.isDone?i():null===c.K?u.continue():u.continue(c.K)}}).next(()=>R.waitFor(n))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.H?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ke(r){return new R((e,t)=>{r.onsuccess=n=>{e(n.target.result)},r.onerror=n=>{const i=st(n.target.error);t(i)}})}let Be=!1;function st(r){const e=O.S((0,re.ZQ)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(t)>=0){const n=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Be||(Be=!0,setTimeout(()=>{throw n},0)),n}}return r}class mn{constructor(e,t){this.asyncQueue=e,this.Z=t,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}X(e){var t=this;F("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,C.A)(function*(){t.task=null;try{F("IndexBackfiller",`Documents written: ${yield t.Z.ee()}`)}catch(n){U(n)?F("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):yield pt(n)}yield t.X(6e4)}))}}class Un{constructor(e,t){this.localStore=e,this.persistence=t}ee(e=50){var t=this;return(0,C.A)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>t.te(n,e))})()}te(e,t){const n=new Set;let i=t,s=!0;return R.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(null!==a&&!n.has(a))return F("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>t-i)}ne(e,t,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,n).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(F("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,t,u))).next(()=>a.size)}))}re(e,t){let n=e;return t.changes.forEach((i,s)=>{const a=Cr(s);Dr(a,n)>0&&(n=a)}),new Ye(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}let De=(()=>{class r{constructor(t,n){this.previousValue=t,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.se&&this.se(t),t}}return r.oe=-1,r})();function gn(r){return null==r}function pn(r){return 0===r&&1/r==-1/0}function Gi(r){return"number"==typeof r&&Number.isInteger(r)&&!pn(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function Fe(r){let e="";for(let t=0;t<r.length;t++)e.length>0&&(e=Ki(e)),e=oo(r.get(t),e);return Ki(e)}function oo(r,e){let t=e;const n=r.length;for(let i=0;i<n;i++){const s=r.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Ki(r){return r+"\x01\x01"}function ut(r){const e=r.length;if(j(e>=2),2===e)return j("\x01"===r.charAt(0)&&"\x01"===r.charAt(1)),te.emptyPath();const t=e-2,n=[];let i="";for(let s=0;s<e;){const a=r.indexOf("\x01",s);switch((a<0||a>t)&&z(),r.charAt(a+1)){case"\x01":const u=r.substring(s,a);let c;0===i.length?c=u:(i+=u,c=i,i=""),n.push(c);break;case"\x10":i+=r.substring(s,a),i+="\0";break;case"\x11":i+=r.substring(s,a+1);break;default:z()}s=a+2}return new te(n)}const ao=["userId","batchId"];function Rt(r,e){return[r,Fe(e)]}function Gn(r,e,t){return[r,Fe(e),t]}const _n={},uo=["prefixPath","collectionGroup","readTime","documentId"],co=["prefixPath","collectionGroup","documentId"],mf=["collectionGroup","readTime","prefixPath","documentId"],gf=["canonicalId","targetId"],pf=["targetId","path"],_f=["path","targetId"],yf=["collectionId","parent"],If=["indexId","uid"],Tf=["uid","sequenceNumber"],Ef=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vf=["indexId","uid","orderedDocumentKey"],Af=["userId","collectionPath","documentId"],wf=["userId","collectionPath","largestBatchId"],Rf=["userId","collectionGroup","largestBatchId"],Xu=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Pf=[...Xu,"documentOverlays"],Zu=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],ec=Zu,lo=[...ec,"indexConfiguration","indexState","indexEntries"],Vf=lo,Sf=[...lo,"globals"];class ho extends Ui{constructor(e,t){super(),this._e=e,this.currentSequenceNumber=t}}function Ne(r,e){const t=q(r);return O.F(t._e,e)}function tc(r){let e=0;for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e++;return e}function Gt(r,e){for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&e(t,r[t])}function rc(r){for(const e in r)if(Object.prototype.hasOwnProperty.call(r,e))return!1;return!0}class pe{constructor(e,t){this.comparator=e,this.root=t||qe.EMPTY}insert(e,t){return new pe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,qe.BLACK,null,null))}remove(e){return new pe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){const e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new zi(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new zi(this.root,e,this.comparator,!1)}getReverseIterator(){return new zi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new zi(this.root,e,this.comparator,!0)}}class zi{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class qe{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:qe.RED,this.left=null!=i?i:qe.EMPTY,this.right=null!=s?s:qe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new qe(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return qe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return qe.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,qe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,qe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw z();const e=this.left.check();if(e!==this.right.check())throw z();return e+(this.isRed()?0:1)}}qe.EMPTY=null,qe.RED=!0,qe.BLACK=!1,qe.EMPTY=new class{constructor(){this.size=0}get key(){throw z()}get value(){throw z()}get color(){throw z()}get left(){throw z()}get right(){throw z()}copy(e,t,n,i,s){return this}insert(e,t,n){return new qe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class he{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ic(this.data.getIterator())}getIteratorFrom(e){return new ic(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(n=>{t=t.add(n)}),t}isEqual(e){if(!(e instanceof he)||this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new he(this.comparator);return t.data=e,t}}class ic{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Kn(r){return r.hasNext()?r.getNext():void 0}class tt{constructor(e){this.fields=e,e.sort(le.comparator)}static empty(){return new tt([])}unionWith(e){let t=new he(le.comparator);for(const n of this.fields)t=t.add(n);for(const n of e)t=t.add(n);return new tt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ft(this.fields,e.fields,(t,n)=>t.isEqual(n))}}class sc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function bf(){return typeof atob<"u"}class we{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new sc("Invalid base64 string: "+s):s}}(e);return new we(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new we(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return J(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}we.EMPTY_BYTE_STRING=new we("");const xf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pt(r){if(j(!!r),"string"==typeof r){let e=0;const t=xf.exec(r);if(j(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:e}}return{seconds:Ee(r.seconds),nanos:Ee(r.nanos)}}function Ee(r){return"number"==typeof r?r:"string"==typeof r?Number(r):0}function Vt(r){return"string"==typeof r?we.fromBase64String(r):we.fromUint8Array(r)}function ji(r){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Qi(r){const e=r.mapValue.fields.__previous_value__;return ji(e)?Qi(e):e}function kr(r){const e=Pt(r.mapValue.fields.__local_write_time__.timestampValue);return new ge(e.seconds,e.nanos)}class Cf{constructor(e,t,n,i,s,a,u,c,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h}}class Kt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Kt("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof Kt&&e.projectId===this.projectId&&e.database===this.database}}const zt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},$i={nullValue:"NULL_VALUE"};function jt(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?ji(r)?4:lc(r)?9007199254740991:Ji(r)?10:11:z()}function _t(r,e){if(r===e)return!0;const t=jt(r);if(t!==jt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===e.booleanValue;case 4:return kr(r).isEqual(kr(e));case 3:return function(i,s){if("string"==typeof i.timestampValue&&"string"==typeof s.timestampValue&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Pt(i.timestampValue),u=Pt(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,e);case 5:return r.stringValue===e.stringValue;case 6:return s=e,Vt(r.bytesValue).isEqual(Vt(s.bytesValue));case 7:return r.referenceValue===e.referenceValue;case 8:return function(i,s){return Ee(i.geoPointValue.latitude)===Ee(s.geoPointValue.latitude)&&Ee(i.geoPointValue.longitude)===Ee(s.geoPointValue.longitude)}(r,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Ee(i.integerValue)===Ee(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Ee(i.doubleValue),u=Ee(s.doubleValue);return a===u?pn(a)===pn(u):isNaN(a)&&isNaN(u)}return!1}(r,e);case 9:return ft(r.arrayValue.values||[],e.arrayValue.values||[],_t);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(tc(a)!==tc(u))return!1;for(const c in a)if(a.hasOwnProperty(c)&&(void 0===u[c]||!_t(a[c],u[c])))return!1;return!0}(r,e);default:return z()}var s}function Fr(r,e){return void 0!==(r.values||[]).find(t=>_t(t,e))}function Qt(r,e){if(r===e)return 0;const t=jt(r),n=jt(e);if(t!==n)return J(t,n);switch(t){case 0:case 9007199254740991:return 0;case 1:return J(r.booleanValue,e.booleanValue);case 2:return function(s,a){const u=Ee(s.integerValue||s.doubleValue),c=Ee(a.integerValue||a.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1}(r,e);case 3:return oc(r.timestampValue,e.timestampValue);case 4:return oc(kr(r),kr(e));case 5:return J(r.stringValue,e.stringValue);case 6:return function(s,a){const u=Vt(s),c=Vt(a);return u.compareTo(c)}(r.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),c=a.split("/");for(let h=0;h<u.length&&h<c.length;h++){const f=J(u[h],c[h]);if(0!==f)return f}return J(u.length,c.length)}(r.referenceValue,e.referenceValue);case 8:return function(s,a){const u=J(Ee(s.latitude),Ee(a.latitude));return 0!==u?u:J(Ee(s.longitude),Ee(a.longitude))}(r.geoPointValue,e.geoPointValue);case 9:return ac(r.arrayValue,e.arrayValue);case 10:return function(s,a){var u,c,h,f;const V=null===(u=(s.fields||{}).value)||void 0===u?void 0:u.arrayValue,N=null===(c=(a.fields||{}).value)||void 0===c?void 0:c.arrayValue,L=J((null===(h=null==V?void 0:V.values)||void 0===h?void 0:h.length)||0,(null===(f=null==N?void 0:N.values)||void 0===f?void 0:f.length)||0);return 0!==L?L:ac(V,N)}(r.mapValue,e.mapValue);case 11:return function(s,a){if(s===zt.mapValue&&a===zt.mapValue)return 0;if(s===zt.mapValue)return 1;if(a===zt.mapValue)return-1;const u=s.fields||{},c=Object.keys(u),h=a.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let p=0;p<c.length&&p<f.length;++p){const y=J(c[p],f[p]);if(0!==y)return y;const V=Qt(u[c[p]],h[f[p]]);if(0!==V)return V}return J(c.length,f.length)}(r.mapValue,e.mapValue);default:throw z()}}function oc(r,e){if("string"==typeof r&&"string"==typeof e&&r.length===e.length)return J(r,e);const t=Pt(r),n=Pt(e),i=J(t.seconds,n.seconds);return 0!==i?i:J(t.nanos,n.nanos)}function ac(r,e){const t=r.values||[],n=e.values||[];for(let i=0;i<t.length&&i<n.length;++i){const s=Qt(t[i],n[i]);if(s)return s}return J(t.length,n.length)}function zn(r){return fo(r)}function fo(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(t){const n=Pt(t);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?Vt(r.bytesValue).toBase64():"referenceValue"in r?G.fromName(r.referenceValue).toString():"geoPointValue"in r?function(t){return`geo(${t.latitude},${t.longitude})`}(r.geoPointValue):"arrayValue"in r?function(t){let n="[",i=!0;for(const s of t.values||[])i?i=!1:n+=",",n+=fo(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(t){const n=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of n)s?s=!1:i+=",",i+=`${a}:${fo(t.fields[a])}`;return i+"}"}(r.mapValue):z()}function yn(r,e){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${e.path.canonicalString()}`}}function mo(r){return!!r&&"integerValue"in r}function Mr(r){return!!r&&"arrayValue"in r}function uc(r){return!!r&&"nullValue"in r}function cc(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function Hi(r){return!!r&&"mapValue"in r}function Ji(r){var e,t;return"__vector__"===(null===(t=((null===(e=null==r?void 0:r.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Or(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&"object"==typeof r.timestampValue)return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){const e={mapValue:{fields:{}}};return Gt(r.mapValue.fields,(t,n)=>e.mapValue.fields[t]=Or(n)),e}if(r.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(r.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Or(r.arrayValue.values[t]);return e}return Object.assign({},r)}function lc(r){return"__max__"===(((r.mapValue||{}).fields||{}).__type__||{}).stringValue}const hc={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function Df(r){return"nullValue"in r?$i:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?yn(Kt.empty(),G.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?Ji(r)?hc:{mapValue:{}}:z()}function Nf(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?yn(Kt.empty(),G.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?hc:"mapValue"in r?Ji(r)?{mapValue:{}}:zt:z()}function dc(r,e){const t=Qt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?-1:!r.inclusive&&e.inclusive?1:0}function fc(r,e){const t=Qt(r.value,e.value);return 0!==t?t:r.inclusive&&!e.inclusive?1:!r.inclusive&&e.inclusive?-1:0}class Ue{constructor(e){this.value=e}static empty(){return new Ue({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Hi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Or(t)}setAll(e){let t=le.emptyPath(),n={},i=[];e.forEach((a,u)=>{if(!t.isImmediateParentOf(u)){const c=this.getFieldsMap(t);this.applyChanges(c,n,i),n={},i=[],t=u.popLast()}a?n[u.lastSegment()]=Or(a):i.push(u.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Hi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _t(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Hi(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Gt(t,(i,s)=>e[i]=s);for(const i of n)delete e[i]}clone(){return new Ue(Or(this.value))}}function mc(r){const e=[];return Gt(r.fields,(t,n)=>{const i=new le([t]);if(Hi(n)){const s=mc(n.mapValue).fields;if(0===s.length)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new tt(e)}class _e{constructor(e,t,n,i,s,a,u){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new _e(e,0,$.min(),$.min(),$.min(),Ue.empty(),0)}static newFoundDocument(e,t,n,i){return new _e(e,1,t,$.min(),n,i,0)}static newNoDocument(e,t){return new _e(e,2,t,$.min(),$.min(),Ue.empty(),0)}static newUnknownDocument(e,t){return new _e(e,3,t,$.min(),$.min(),Ue.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ue.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof _e&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new _e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class $t{constructor(e,t){this.position=e,this.inclusive=t}}function gc(r,e,t){let n=0;for(let i=0;i<r.position.length;i++){const s=e[i],a=r.position[i];if(n=s.field.isKeyField()?G.comparator(G.fromName(a.referenceValue),t.key):Qt(a,t.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function pc(r,e){if(null===r)return null===e;if(null===e||r.inclusive!==e.inclusive||r.position.length!==e.position.length)return!1;for(let t=0;t<r.position.length;t++)if(!_t(r.position[t],e.position[t]))return!1;return!0}class Lr{constructor(e,t="asc"){this.field=e,this.dir=t}}function kf(r,e){return r.dir===e.dir&&r.field.isEqual(e.field)}class _c{}class ne extends _c{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ff(e,t,n):"array-contains"===t?new Lf(e,n):"in"===t?new Ac(e,n):"not-in"===t?new Bf(e,n):"array-contains-any"===t?new qf(e,n):new ne(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Mf(e,n):new Of(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(Qt(t,this.value)):null!==t&&jt(this.value)===jt(t)&&this.matchesComparison(Qt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return z()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ce extends _c{constructor(e,t){super(),this.filters=e,this.op=t,this.ae=null}static create(e,t){return new ce(e,t)}matches(e){return jn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ae||(this.ae=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function jn(r){return"and"===r.op}function go(r){return"or"===r.op}function po(r){return yc(r)&&jn(r)}function yc(r){for(const e of r.filters)if(e instanceof ce)return!1;return!0}function _o(r){if(r instanceof ne)return r.field.canonicalString()+r.op.toString()+zn(r.value);if(po(r))return r.filters.map(e=>_o(e)).join(",");{const e=r.filters.map(t=>_o(t)).join(",");return`${r.op}(${e})`}}function Ic(r,e){return r instanceof ne?(n=r,(i=e)instanceof ne&&n.op===i.op&&n.field.isEqual(i.field)&&_t(n.value,i.value)):r instanceof ce?function(n,i){return i instanceof ce&&n.op===i.op&&n.filters.length===i.filters.length&&n.filters.reduce((s,a,u)=>s&&Ic(a,i.filters[u]),!0)}(r,e):void z();var n,i}function Tc(r,e){const t=r.filters.concat(e);return ce.create(t,r.op)}function Ec(r){return r instanceof ne?`${(t=r).field.canonicalString()} ${t.op} ${zn(t.value)}`:r instanceof ce?function(t){return t.op.toString()+" {"+t.getFilters().map(Ec).join(" ,")+"}"}(r):"Filter";var t}class Ff extends ne{constructor(e,t,n){super(e,t,n),this.key=G.fromName(n.referenceValue)}matches(e){const t=G.comparator(e.key,this.key);return this.matchesComparison(t)}}class Mf extends ne{constructor(e,t){super(e,"in",t),this.keys=vc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Of extends ne{constructor(e,t){super(e,"not-in",t),this.keys=vc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function vc(r,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(n=>G.fromName(n.referenceValue))}class Lf extends ne{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Mr(t)&&Fr(t.arrayValue,this.value)}}class Ac extends ne{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Fr(this.value.arrayValue,t)}}class Bf extends ne{constructor(e,t){super(e,"not-in",t)}matches(e){if(Fr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Fr(this.value.arrayValue,t)}}class qf extends ne{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Mr(t)||!t.arrayValue.values)&&t.arrayValue.values.some(n=>Fr(this.value.arrayValue,n))}}class Uf{constructor(e,t=null,n=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function yo(r,e=null,t=[],n=[],i=null,s=null,a=null){return new Uf(r,e,t,n,i,s,a)}function In(r){const e=q(r);if(null===e.ue){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(n=>_o(n)).join(","),t+="|ob:",t+=e.orderBy.map(n=>{return(s=n).field.canonicalString()+s.dir;var s}).join(","),gn(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(n=>zn(n)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(n=>zn(n)).join(",")),e.ue=t}return e.ue}function Br(r,e){if(r.limit!==e.limit||r.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<r.orderBy.length;t++)if(!kf(r.orderBy[t],e.orderBy[t]))return!1;if(r.filters.length!==e.filters.length)return!1;for(let t=0;t<r.filters.length;t++)if(!Ic(r.filters[t],e.filters[t]))return!1;return r.collectionGroup===e.collectionGroup&&!!r.path.isEqual(e.path)&&!!pc(r.startAt,e.startAt)&&pc(r.endAt,e.endAt)}function Yi(r){return G.isDocumentKey(r.path)&&null===r.collectionGroup&&0===r.filters.length}function Xi(r,e){return r.filters.filter(t=>t instanceof ne&&t.field.isEqual(e))}function wc(r,e,t){let n=$i,i=!0;for(const s of Xi(r,e)){let a=$i,u=!0;switch(s.op){case"<":case"<=":a=Df(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=$i}dc({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];dc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}function Rc(r,e,t){let n=zt,i=!0;for(const s of Xi(r,e)){let a=zt,u=!0;switch(s.op){case">=":case">":a=Nf(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=zt}fc({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(null!==t)for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(e)){const a=t.position[s];fc({value:n,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(n=a,i=t.inclusive);break}return{value:n,inclusive:i}}class St{constructor(e,t=null,n=[],i=[],s=null,a="F",u=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=c,this.ce=null,this.le=null,this.he=null}}function Pc(r,e,t,n,i,s,a,u){return new St(r,e,t,n,i,s,a,u)}function Qn(r){return new St(r)}function Vc(r){return 0===r.filters.length&&null===r.limit&&null==r.startAt&&null==r.endAt&&(0===r.explicitOrderBy.length||1===r.explicitOrderBy.length&&r.explicitOrderBy[0].field.isKeyField())}function Io(r){return null!==r.collectionGroup}function $n(r){const e=q(r);if(null===e.ce){e.ce=[];const t=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),t.add(s.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new he(le.comparator);return a.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.ce.push(new Lr(s,n))}),t.has(le.keyField().canonicalString())||e.ce.push(new Lr(le.keyField(),n))}return e.ce}function ze(r){const e=q(r);return e.le||(e.le=function bc(r,e){if("F"===r.limitType)return yo(r.path,r.collectionGroup,e,r.filters,r.limit,r.startAt,r.endAt);{e=e.map(i=>new Lr(i.field,"desc"===i.dir?"asc":"desc"));const t=r.endAt?new $t(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new $t(r.startAt.position,r.startAt.inclusive):null;return yo(r.path,r.collectionGroup,e,r.filters,r.limit,t,n)}}(e,$n(r))),e.le}function To(r,e){const t=r.filters.concat([e]);return new St(r.path,r.collectionGroup,r.explicitOrderBy.slice(),t,r.limit,r.limitType,r.startAt,r.endAt)}function Zi(r,e,t){return new St(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),e,t,r.startAt,r.endAt)}function qr(r,e){return Br(ze(r),ze(e))&&r.limitType===e.limitType}function xc(r){return`${In(ze(r))}|lt:${r.limitType}`}function Wn(r){return`Query(target=${function(t){let n=t.path.canonicalString();return null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(i=>Ec(i)).join(", ")}]`),gn(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(i=>{return`${(a=i).field.canonicalString()} (${a.dir})`;var a}).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(i=>zn(i)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(i=>zn(i)).join(",")),`Target(${n})`}(ze(r))}; limitType=${r.limitType})`}function Ur(r,e){return e.isFoundDocument()&&function(n,i){const s=i.key.path;return null!==n.collectionGroup?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):G.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,e)&&function(n,i){for(const s of $n(n))if(!s.field.isKeyField()&&null===i.data.field(s.field))return!1;return!0}(r,e)&&function(n,i){for(const s of n.filters)if(!s.matches(i))return!1;return!0}(r,e)&&(i=e,!((n=r).startAt&&!function(a,u,c){const h=gc(a,u,c);return a.inclusive?h<=0:h<0}(n.startAt,$n(n),i)||n.endAt&&!function(a,u,c){const h=gc(a,u,c);return a.inclusive?h>=0:h>0}(n.endAt,$n(n),i)));var n,i}function Cc(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Dc(r){return(e,t)=>{let n=!1;for(const i of $n(r)){const s=Gf(i,e,t);if(0!==s)return s;n=n||i.field.isKeyField()}return 0}}function Gf(r,e,t){const n=r.field.isKeyField()?G.comparator(e.key,t.key):function(s,a,u){const c=a.data.field(s),h=u.data.field(s);return null!==c&&null!==h?Qt(c,h):z()}(r.field,e,t);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return z()}}class bt{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[i,s]of n)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Gt(this.inner,(t,n)=>{for(const[i,s]of n)e(i,s)})}isEmpty(){return rc(this.inner)}size(){return this.innerSize}}const Kf=new pe(G.comparator);function nt(){return Kf}const Nc=new pe(G.comparator);function Gr(...r){let e=Nc;for(const t of r)e=e.insert(t.key,t);return e}function kc(r){let e=Nc;return r.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function yt(){return Kr()}function Fc(){return Kr()}function Kr(){return new bt(r=>r.toString(),(r,e)=>r.isEqual(e))}const zf=new pe(G.comparator),jf=new he(G.comparator);function X(...r){let e=jf;for(const t of r)e=e.add(t);return e}const Qf=new he(J);function Eo(){return Qf}function vo(r,e){if(r.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pn(e)?"-0":e}}function Mc(r){return{integerValue:""+r}}function Oc(r,e){return Gi(e)?Mc(e):vo(r,e)}class es{constructor(){this._=void 0}}function $f(r,e,t){return r instanceof Hn?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ji(s)&&(s=Qi(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):r instanceof Tn?Bc(r,e):r instanceof En?qc(r,e):function(i,s){const a=Lc(i,s),u=Uc(a)+Uc(i.Pe);return mo(a)&&mo(i.Pe)?Mc(u):vo(i.serializer,u)}(r,e)}function Wf(r,e,t){return r instanceof Tn?Bc(r,e):r instanceof En?qc(r,e):t}function Lc(r,e){return r instanceof Jn?mo(n=e)||(s=n)&&"doubleValue"in s?e:{integerValue:0}:null;var n,s}class Hn extends es{}class Tn extends es{constructor(e){super(),this.elements=e}}function Bc(r,e){const t=Gc(e);for(const n of r.elements)t.some(i=>_t(i,n))||t.push(n);return{arrayValue:{values:t}}}class En extends es{constructor(e){super(),this.elements=e}}function qc(r,e){let t=Gc(e);for(const n of r.elements)t=t.filter(i=>!_t(i,n));return{arrayValue:{values:t}}}class Jn extends es{constructor(e,t){super(),this.serializer=e,this.Pe=t}}function Uc(r){return Ee(r.integerValue||r.doubleValue)}function Gc(r){return Mr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}class zr{constructor(e,t){this.field=e,this.transform=t}}class Jf{constructor(e,t){this.version=e,this.transformResults=t}}class ve{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ve}static exists(e){return new ve(void 0,e)}static updateTime(e){return new ve(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ts(r,e){return void 0!==r.updateTime?e.isFoundDocument()&&e.version.isEqual(r.updateTime):void 0===r.exists||r.exists===e.isFoundDocument()}class ns{}function Kc(r,e){if(!r.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return r.isNoDocument()?new Xn(r.key,ve.none()):new Yn(r.key,r.data,ve.none());{const t=r.data,n=Ue.empty();let i=new he(le.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);null===a&&s.length>1&&(s=s.popLast(),a=t.field(s)),null===a?n.delete(s):n.set(s,a),i=i.add(s)}return new xt(r.key,n,new tt(i.toArray()),ve.none())}}function Yf(r,e,t){r instanceof Yn?function(i,s,a){const u=i.value.clone(),c=Qc(i.fieldTransforms,s,a.transformResults);u.setAll(c),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,e,t):r instanceof xt?function(i,s,a){if(!ts(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=Qc(i.fieldTransforms,s,a.transformResults),c=s.data;c.setAll(jc(i)),c.setAll(u),s.convertToFoundDocument(a.version,c).setHasCommittedMutations()}(r,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function jr(r,e,t,n){return r instanceof Yn?function(s,a,u,c){if(!ts(s.precondition,a))return u;const h=s.value.clone(),f=$c(s.fieldTransforms,c,a);return h.setAll(f),a.convertToFoundDocument(a.version,h).setHasLocalMutations(),null}(r,e,t,n):r instanceof xt?function(s,a,u,c){if(!ts(s.precondition,a))return u;const h=$c(s.fieldTransforms,c,a),f=a.data;return f.setAll(jc(s)),f.setAll(h),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null===u?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(p=>p.field))}(r,e,t,n):(u=t,ts(r.precondition,a=e)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u);var a,u}function Xf(r,e){let t=null;for(const n of r.fieldTransforms){const i=e.data.field(n.field),s=Lc(n.transform,i||null);null!=s&&(null===t&&(t=Ue.empty()),t.set(n.field,s))}return t||null}function zc(r,e){return r.type===e.type&&!!r.key.isEqual(e.key)&&!!r.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(n=r.fieldTransforms)&&void 0===i||n&&i&&ft(n,i,(s,a)=>function Hf(r,e){return r.field.isEqual(e.field)&&(i=e.transform,(n=r.transform)instanceof Tn&&i instanceof Tn||n instanceof En&&i instanceof En?ft(n.elements,i.elements,_t):n instanceof Jn&&i instanceof Jn?_t(n.Pe,i.Pe):n instanceof Hn&&i instanceof Hn);var n,i}(s,a))))&&(0===r.type?r.value.isEqual(e.value):1!==r.type||r.data.isEqual(e.data)&&r.fieldMask.isEqual(e.fieldMask));var n,i}class Yn extends ns{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class xt extends ns{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function jc(r){const e=new Map;return r.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const n=r.data.field(t);e.set(t,n)}}),e}function Qc(r,e,t){const n=new Map;j(r.length===t.length);for(let i=0;i<t.length;i++){const s=r[i],a=s.transform,u=e.data.field(s.field);n.set(s.field,Wf(a,u,t[i]))}return n}function $c(r,e,t){const n=new Map;for(const i of r){const s=i.transform,a=t.data.field(i.field);n.set(i.field,$f(s,a,e))}return n}class Xn extends ns{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ao extends ns{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class wo{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&Yf(s,e,n[i])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=jr(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=jr(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Fc();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=t.has(i.key)?null:u;const c=Kc(a,u);null!==c&&n.set(i.key,c),a.isValidDocument()||a.convertToNoDocument($.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),X())}isEqual(e){return this.batchId===e.batchId&&ft(this.mutations,e.mutations,(t,n)=>zc(t,n))&&ft(this.baseMutations,e.baseMutations,(t,n)=>zc(t,n))}}class Ro{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){j(e.mutations.length===n.length);let i=function(){return zf}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new Ro(e,t,n,i)}}class Po{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Zf{constructor(e,t){this.count=e,this.unchangedNames=t}}var xe,se;function Hc(r){switch(r){default:return z();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function Jc(r){if(void 0===r)return Te("GRPC error has no .code"),b.UNKNOWN;switch(r){case xe.OK:return b.OK;case xe.CANCELLED:return b.CANCELLED;case xe.UNKNOWN:return b.UNKNOWN;case xe.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case xe.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case xe.INTERNAL:return b.INTERNAL;case xe.UNAVAILABLE:return b.UNAVAILABLE;case xe.UNAUTHENTICATED:return b.UNAUTHENTICATED;case xe.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case xe.NOT_FOUND:return b.NOT_FOUND;case xe.ALREADY_EXISTS:return b.ALREADY_EXISTS;case xe.PERMISSION_DENIED:return b.PERMISSION_DENIED;case xe.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case xe.ABORTED:return b.ABORTED;case xe.OUT_OF_RANGE:return b.OUT_OF_RANGE;case xe.UNIMPLEMENTED:return b.UNIMPLEMENTED;case xe.DATA_LOSS:return b.DATA_LOSS;default:return z()}}(se=xe||(xe={}))[se.OK=0]="OK",se[se.CANCELLED=1]="CANCELLED",se[se.UNKNOWN=2]="UNKNOWN",se[se.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",se[se.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",se[se.NOT_FOUND=5]="NOT_FOUND",se[se.ALREADY_EXISTS=6]="ALREADY_EXISTS",se[se.PERMISSION_DENIED=7]="PERMISSION_DENIED",se[se.UNAUTHENTICATED=16]="UNAUTHENTICATED",se[se.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",se[se.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",se[se.ABORTED=10]="ABORTED",se[se.OUT_OF_RANGE=11]="OUT_OF_RANGE",se[se.UNIMPLEMENTED=12]="UNIMPLEMENTED",se[se.INTERNAL=13]="INTERNAL",se[se.UNAVAILABLE=14]="UNAVAILABLE",se[se.DATA_LOSS=15]="DATA_LOSS";function Yc(){return new TextEncoder}const em=new Et([4294967295,4294967295],0);function Xc(r){const e=Yc().encode(r),t=new cn;return t.update(e),new Uint8Array(t.digest())}function Zc(r){const e=new DataView(r.buffer),t=e.getUint32(0,!0),n=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Et([t,n],0),new Et([i,s],0)]}class Vo{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Qr(`Invalid padding: ${t}`);if(n<0)throw new Qr(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Qr(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Qr(`Invalid padding when bitmap length is 0: ${t}`);this.Ie=8*e.length-t,this.Te=Et.fromNumber(this.Ie)}Ee(e,t,n){let i=e.add(t.multiply(Et.fromNumber(n)));return 1===i.compare(em)&&(i=new Et([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Ie)return!1;const t=Xc(e),[n,i]=Zc(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Vo(s,i,t);return n.forEach(u=>a.insert(u)),a}insert(e){if(0===this.Ie)return;const t=Xc(e),[n,i]=Zc(t);for(let s=0;s<this.hashCount;s++){const a=this.Ee(n,i,s);this.Ae(a)}}Ae(e){const t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class Qr extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class $r{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Wr.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new $r($.min(),i,new pe(J),nt(),X())}}class Wr{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Wr(n,t,X(),X(),X())}}class is{constructor(e,t,n,i){this.Re=e,this.removedTargetIds=t,this.key=n,this.Ve=i}}class el{constructor(e,t){this.targetId=e,this.me=t}}class tl{constructor(e,t,n=we.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class nl{constructor(){this.fe=0,this.ge=il(),this.pe=we.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return 0!==this.fe}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=X(),t=X(),n=X();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:z()}}),new Wr(this.pe,this.ye,e,t,n)}Ce(){this.we=!1,this.ge=il()}Fe(e,t){this.we=!0,this.ge=this.ge.insert(e,t)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,j(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class tm{constructor(e){this.Le=e,this.Be=new Map,this.ke=nt(),this.qe=rl(),this.Qe=new pe(J)}Ke(e){for(const t of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(t,e.Ve):this.Ue(t,e.key,e.Ve);for(const t of e.removedTargetIds)this.Ue(t,e.key,e.Ve)}We(e){this.forEachTarget(e,t=>{const n=this.Ge(t);switch(e.state){case 0:this.ze(t)&&n.De(e.resumeToken);break;case 1:n.Oe(),n.Se||n.Ce(),n.De(e.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(t);break;case 3:this.ze(t)&&(n.Ne(),n.De(e.resumeToken));break;case 4:this.ze(t)&&(this.je(t),n.De(e.resumeToken));break;default:z()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Be.forEach((n,i)=>{this.ze(i)&&t(i)})}He(e){const t=e.targetId,n=e.me.count,i=this.Je(t);if(i){const s=i.target;if(Yi(s))if(0===n){const a=new G(s.path);this.Ue(t,a,_e.newNoDocument(a,$.min()))}else j(1===n);else{const a=this.Ye(t);if(a!==n){const u=this.Ze(e),c=u?this.Xe(u,e,a):1;0!==c&&(this.je(t),this.Qe=this.Qe.insert(t,2===c?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}Ze(e){const t=e.me.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let a,u;try{a=Vt(n).toUint8Array()}catch(c){if(c instanceof sc)return Ce("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new Vo(a,i,s)}catch(c){return Ce(c instanceof Qr?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return 0===u.Ie?null:u}Xe(e,t,n){return t.me.count===n-this.nt(e,t.targetId)?0:2}nt(e,t){const n=this.Le.getRemoteKeysForTarget(t);let i=0;return n.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(t,s,null),i++)}),i}rt(e){const t=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Yi(u.target)){const c=new G(u.target.path);null!==this.ke.get(c)||this.it(a,c)||this.Ue(a,c,_e.newNoDocument(c,e))}s.be&&(t.set(a,s.ve()),s.Ce())}});let n=X();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(c=>{const h=this.Je(c);return!h||"TargetPurposeLimboResolution"===h.purpose||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new $r(e,t,this.Qe,this.ke,n);return this.ke=nt(),this.qe=rl(),this.Qe=new pe(J),i}$e(e,t){if(!this.ze(e))return;const n=this.it(e,t.key)?2:0;this.Ge(e).Fe(t.key,n),this.ke=this.ke.insert(t.key,t),this.qe=this.qe.insert(t.key,this.st(t.key).add(e))}Ue(e,t,n){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,t)?i.Fe(t,1):i.Me(t),this.qe=this.qe.insert(t,this.st(t).delete(e)),n&&(this.ke=this.ke.insert(t,n))}removeTarget(e){this.Be.delete(e)}Ye(e){const t=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let t=this.Be.get(e);return t||(t=new nl,this.Be.set(e,t)),t}st(e){let t=this.qe.get(e);return t||(t=new he(J),this.qe=this.qe.insert(e,t)),t}ze(e){const t=null!==this.Je(e);return t||F("WatchChangeAggregator","Detected inactive target",e),t}Je(e){const t=this.Be.get(e);return t&&t.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new nl),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.Ue(e,t,null)})}it(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function rl(){return new pe(G.comparator)}function il(){return new pe(G.comparator)}const nm={asc:"ASCENDING",desc:"DESCENDING"},rm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},im={and:"AND",or:"OR"};class sm{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function So(r,e){return r.useProto3Json||gn(e)?e:{value:e}}function Zn(r,e){return r.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function sl(r,e){return r.useProto3Json?e.toBase64():e.toUint8Array()}function om(r,e){return Zn(r,e.toTimestamp())}function be(r){return j(!!r),$.fromTimestamp(function(t){const n=Pt(t);return new ge(n.seconds,n.nanos)}(r))}function bo(r,e){return xo(r,e).canonicalString()}function xo(r,e){const t=(i=r,new te(["projects",i.projectId,"databases",i.database])).child("documents");var i;return void 0===e?t:t.child(e)}function ol(r){const e=te.fromString(r);return j(_l(e)),e}function Hr(r,e){return bo(r.databaseId,e.path)}function It(r,e){const t=ol(e);if(t.get(1)!==r.databaseId.projectId)throw new k(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+r.databaseId.projectId);if(t.get(3)!==r.databaseId.database)throw new k(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+r.databaseId.database);return new G(cl(t))}function al(r,e){return bo(r.databaseId,e)}function ul(r){const e=ol(r);return 4===e.length?te.emptyPath():cl(e)}function Co(r){return new te(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function cl(r){return j(r.length>4&&"documents"===r.get(4)),r.popFirst(5)}function ll(r,e,t){return{name:Hr(r,e),fields:t.value.mapValue.fields}}function hl(r,e,t){const n=It(r,e.name),i=be(e.updateTime),s=e.createTime?be(e.createTime):$.min(),a=new Ue({mapValue:{fields:e.fields}}),u=_e.newFoundDocument(n,i,s,a);return t&&u.setHasCommittedMutations(),t?u.setHasCommittedMutations():u}function Jr(r,e){let t;if(e instanceof Yn)t={update:ll(r,e.key,e.value)};else if(e instanceof Xn)t={delete:Hr(r,e.key)};else if(e instanceof xt)t={update:ll(r,e.key,e.data),updateMask:mm(e.fieldMask)};else{if(!(e instanceof Ao))return z();t={verify:Hr(r,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(n=>function(s,a){const u=a.transform;if(u instanceof Hn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Tn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof En)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Jn)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw z()}(0,n))),e.precondition.isNone||(t.currentDocument=void 0!==(s=e.precondition).updateTime?{updateTime:om(r,s.updateTime)}:void 0!==s.exists?{exists:s.exists}:z()),t;var s}function Do(r,e){const t=e.currentDocument?void 0!==(s=e.currentDocument).updateTime?ve.updateTime(be(s.updateTime)):void 0!==s.exists?ve.exists(s.exists):ve.none():ve.none(),n=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let c=null;"setToServerValue"in u?(j("REQUEST_TIME"===u.setToServerValue),c=new Hn):"appendMissingElements"in u?c=new Tn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?c=new En(u.removeAllFromArray.values||[]):"increment"in u?c=new Jn(a,u.increment):z();const h=le.fromServerFormat(u.fieldPath);return new zr(h,c)}(r,i)):[];var s;if(e.update){const i=It(r,e.update.name),s=new Ue({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=new tt((e.updateMask.fieldPaths||[]).map(f=>le.fromServerFormat(f)));return new xt(i,s,a,t,n)}return new Yn(i,s,t,n)}if(e.delete){const i=It(r,e.delete);return new Xn(i,t)}if(e.verify){const i=It(r,e.verify);return new Ao(i,t)}return z()}function dl(r,e){return{documents:[al(r,e.path)]}}function ss(r,e){const t={structuredQuery:{}},n=e.path;let i;null!==e.collectionGroup?(i=n,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=n.popLast(),t.structuredQuery.from=[{collectionId:n.lastSegment()}]),t.parent=al(r,i);const s=function(h){if(0!==h.length)return pl(ce.create(h,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const a=function(h){if(0!==h.length)return h.map(f=>{return{field:Wt((y=f).field),direction:hm(y.dir)};var y})}(e.orderBy);a&&(t.structuredQuery.orderBy=a);const u=So(r,e.limit);return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),{_t:t,parent:i};var h}function ml(r){let e=ul(r.parent);const t=r.structuredQuery,n=t.from?t.from.length:0;let i=null;if(n>0){j(1===n);const f=t.from[0];f.allDescendants?i=f.collectionId:e=e.child(f.collectionId)}let s=[];t.where&&(s=function(p){const y=gl(p);return y instanceof ce&&po(y)?y.getFilters():[y]}(t.where));let a=[];t.orderBy&&(a=t.orderBy.map(y=>{return new Lr(er((N=y).field),function(M){switch(M){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction));var N}));let u=null;t.limit&&(u=function(p){let y;return y="object"==typeof p?p.value:p,gn(y)?null:y}(t.limit));let c=null;var p;t.startAt&&(c=new $t((p=t.startAt).values||[],!!p.before));let h=null;return t.endAt&&(h=function(p){return new $t(p.values||[],!p.before)}(t.endAt)),Pc(e,i,a,s,u,"F",c,h)}function gl(r){return void 0!==r.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const n=er(t.unaryFilter.field);return ne.create(n,"==",{doubleValue:NaN});case"IS_NULL":const i=er(t.unaryFilter.field);return ne.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=er(t.unaryFilter.field);return ne.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=er(t.unaryFilter.field);return ne.create(a,"!=",{nullValue:"NULL_VALUE"});default:return z()}}(r):void 0!==r.fieldFilter?ne.create(er((t=r).fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return z()}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==r.compositeFilter?function(t){return ce.create(t.compositeFilter.filters.map(n=>gl(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return z()}}(t.compositeFilter.op))}(r):z();var t}function hm(r){return nm[r]}function dm(r){return rm[r]}function fm(r){return im[r]}function Wt(r){return{fieldPath:r.canonicalString()}}function er(r){return le.fromServerFormat(r.fieldPath)}function pl(r){return r instanceof ne?function(t){if("=="===t.op){if(cc(t.value))return{unaryFilter:{field:Wt(t.field),op:"IS_NAN"}};if(uc(t.value))return{unaryFilter:{field:Wt(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(cc(t.value))return{unaryFilter:{field:Wt(t.field),op:"IS_NOT_NAN"}};if(uc(t.value))return{unaryFilter:{field:Wt(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Wt(t.field),op:dm(t.op),value:t.value}}}(r):r instanceof ce?function(t){const n=t.getFilters().map(i=>pl(i));return 1===n.length?n[0]:{compositeFilter:{op:fm(t.op),filters:n}}}(r):z()}function mm(r){const e=[];return r.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _l(r){return r.length>=4&&"projects"===r.get(0)&&"databases"===r.get(2)}class Ct{constructor(e,t,n,i,s=$.min(),a=$.min(),u=we.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(e){return new Ct(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Ct(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Ct(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Ct(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class yl{constructor(e){this.ct=e}}function Il(r,e){const t=e.key,n={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:os(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())n.document={name:Hr(s=r.ct,(a=e).key),fields:a.data.value.mapValue.fields,updateTime:Zn(s,a.version.toTimestamp()),createTime:Zn(s,a.createTime.toTimestamp())};else if(e.isNoDocument())n.noDocument={path:t.path.toArray(),readTime:vn(e.version)};else{if(!e.isUnknownDocument())return z();n.unknownDocument={path:t.path.toArray(),version:vn(e.version)}}var s,a;return n}function os(r){const e=r.toTimestamp();return[e.seconds,e.nanoseconds]}function vn(r){const e=r.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function An(r){const e=new ge(r.seconds,r.nanoseconds);return $.fromTimestamp(e)}function wn(r,e){const t=(e.baseMutations||[]).map(s=>Do(r.ct,s));for(let s=0;s<e.mutations.length-1;++s)s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(e.mutations[s].updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s);const n=e.mutations.map(s=>Do(r.ct,s)),i=ge.fromMillis(e.localWriteTimeMs);return new wo(e.batchId,i,t,n)}function Yr(r){const e=An(r.readTime),t=void 0!==r.lastLimboFreeSnapshotVersion?An(r.lastLimboFreeSnapshotVersion):$.min();let n;return n=void 0!==r.query.documents?(j(1===(s=r.query).documents.length),ze(Qn(ul(s.documents[0])))):function(s){return ze(ml(s))}(r.query),new Ct(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,e,t,we.fromBase64String(r.resumeToken));var s}function Tl(r,e){const t=vn(e.snapshotVersion),n=vn(e.lastLimboFreeSnapshotVersion);let i;i=Yi(e.target)?dl(r.ct,e.target):ss(r.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:In(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function No(r){const e=ml({parent:r.parent,structuredQuery:r.structuredQuery});return"LAST"===r.limitType?Zi(e,e.limit,"L"):e}function ko(r,e){return new Po(e.largestBatchId,Do(r.ct,e.overlayMutation))}function El(r,e){const t=e.path.lastSegment();return[r,Fe(e.path.popLast()),t]}function vl(r,e,t,n){return{indexId:r,uid:e,sequenceNumber:t,readTime:vn(n.readTime),documentKey:Fe(n.documentKey.path),largestBatchId:n.largestBatchId}}class pm{getBundleMetadata(e,t){return Al(e).get(t).next(n=>{if(n)return{id:(s=n).bundleId,createTime:An(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Al(e).put({bundleId:(i=t).id,createTime:vn(be(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return wl(e).get(t).next(n=>{if(n)return{name:(s=n).name,query:No(s.bundledQuery),readTime:An(s.readTime)};var s})}saveNamedQuery(e,t){return wl(e).put({name:(i=t).name,readTime:vn(be(i.readTime)),bundledQuery:i.bundledQuery});var i}}function Al(r){return Ne(r,"bundles")}function wl(r){return Ne(r,"namedQueries")}class as{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){return new as(e,t.uid||"")}getOverlay(e,t){return Xr(e).get(El(this.userId,t)).next(n=>n?ko(this.serializer,n):null)}getOverlays(e,t){const n=yt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){const i=[];return n.forEach((s,a)=>{const u=new Po(t,a);i.push(this.ht(e,u))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,n){const i=new Set;t.forEach(a=>i.add(Fe(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Xr(e).j("collectionPathOverlayIndex",u))}),R.waitFor(s)}getOverlaysForCollection(e,t,n){const i=yt(),s=Fe(t),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Xr(e).U("collectionPathOverlayIndex",a).next(u=>{for(const c of u){const h=ko(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(e,t,n,i){const s=yt();let a;const u=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Xr(e).J({index:"collectionGroupOverlayIndex",range:u},(c,h,f)=>{const p=ko(this.serializer,h);s.size()<i||p.largestBatchId===a?(s.set(p.getKey(),p),a=p.largestBatchId):f.done()}).next(()=>s)}ht(e,t){return Xr(e).put(function(i,s,a){const[u,c,h]=El(s,a.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Jr(i.ct,a.mutation)}}(this.serializer,this.userId,t))}}function Xr(r){return Ne(r,"documentOverlays")}class _m{Pt(e){return Ne(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(t=>{const n=null==t?void 0:t.value;return n?we.fromUint8Array(n):we.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.Pt(e).put({name:"sessionToken",value:t.toUint8Array()})}}class Rn{constructor(){}It(e,t){this.Tt(e,t),t.Et()}Tt(e,t){if("nullValue"in e)this.dt(t,5);else if("booleanValue"in e)this.dt(t,10),t.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(t,15),t.At(Ee(e.integerValue));else if("doubleValue"in e){const n=Ee(e.doubleValue);isNaN(n)?this.dt(t,13):(this.dt(t,15),pn(n)?t.At(0):t.At(n))}else if("timestampValue"in e){let n=e.timestampValue;this.dt(t,20),"string"==typeof n&&(n=Pt(n)),t.Rt(`${n.seconds||""}`),t.At(n.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,t),this.ft(t);else if("bytesValue"in e)this.dt(t,30),t.gt(Vt(e.bytesValue)),this.ft(t);else if("referenceValue"in e)this.yt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.dt(t,45),t.At(n.latitude||0),t.At(n.longitude||0)}else"mapValue"in e?lc(e)?this.dt(t,Number.MAX_SAFE_INTEGER):Ji(e)?this.wt(e.mapValue,t):(this.St(e.mapValue,t),this.ft(t)):"arrayValue"in e?(this.bt(e.arrayValue,t),this.ft(t)):z()}Vt(e,t){this.dt(t,25),this.Dt(e,t)}Dt(e,t){t.Rt(e)}St(e,t){const n=e.fields||{};this.dt(t,55);for(const i of Object.keys(n))this.Vt(i,t),this.Tt(n[i],t)}wt(e,t){var n,i;const s=e.fields||{};this.dt(t,53);const a="value",u=(null===(i=null===(n=s[a].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.dt(t,15),t.At(Ee(u)),this.Vt(a,t),this.Tt(s[a],t)}bt(e,t){const n=e.values||[];this.dt(t,50);for(const i of n)this.Tt(i,t)}yt(e,t){this.dt(t,37),G.fromName(e).path.forEach(n=>{this.dt(t,60),this.Dt(n,t)})}dt(e,t){e.At(t)}ft(e){e.At(2)}}function ym(r){if(0===r)return 8;let e=0;return!(r>>4)&&(e+=4,r<<=4),!(r>>6)&&(e+=2,r<<=2),!(r>>7)&&(e+=1),e}function Rl(r){const e=64-function(n){let i=0;for(let s=0;s<8;++s){const a=ym(255&n[s]);if(i+=a,8!==a)break}return i}(r);return Math.ceil(e/8)}Rn.vt=new Rn;class Im{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ft(n.value),n=t.next();this.Mt()}xt(e){const t=e[Symbol.iterator]();let n=t.next();for(;!n.done;)this.Ot(n.value),n=t.next();this.Nt()}Lt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ft(n);else if(n<2048)this.Ft(960|n>>>6),this.Ft(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ft(480|n>>>12),this.Ft(128|63&n>>>6),this.Ft(128|63&n);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const t of e){const n=t.charCodeAt(0);if(n<128)this.Ot(n);else if(n<2048)this.Ot(960|n>>>6),this.Ot(128|63&n);else if(t<"\ud800"||"\udbff"<t)this.Ot(480|n>>>12),this.Ot(128|63&n>>>6),this.Ot(128|63&n);else{const i=t.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const t=this.qt(e),n=Rl(t);this.Qt(1+n),this.buffer[this.position++]=255&n;for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=255&t[i]}Kt(e){const t=this.qt(e),n=Rl(t);this.Qt(1+n),this.buffer[this.position++]=~(255&n);for(let i=t.length-n;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),n=!!(128&t[0]);t[0]^=n?255:128;for(let i=1;i<t.length;++i)t[i]^=n?255:0;return t}Ft(e){const t=255&e;0===t?(this.Ut(0),this.Ut(255)):255===t?(this.Ut(255),this.Ut(0)):this.Ut(t)}Ot(e){const t=255&e;0===t?(this.Gt(0),this.Gt(255)):255===t?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const t=e+this.position;if(t<=this.buffer.length)return;let n=2*this.buffer.length;n<t&&(n=t);const i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}}class Tm{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class Em{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class Zr{constructor(){this.jt=new Im,this.Ht=new Tm(this.jt),this.Jt=new Em(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return 0===e?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}class Pn{constructor(e,t,n,i){this.indexId=e,this.documentKey=t,this.arrayValue=n,this.directionalValue=i}Zt(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,n=new Uint8Array(t);return n.set(this.directionalValue,0),t!==e?n.set([0],this.directionalValue.length):++n[n.length-1],new Pn(this.indexId,this.documentKey,this.arrayValue,n)}}function Ht(r,e){let t=r.indexId-e.indexId;return 0!==t?t:(t=Pl(r.arrayValue,e.arrayValue),0!==t?t:(t=Pl(r.directionalValue,e.directionalValue),0!==t?t:G.comparator(r.documentKey,e.documentKey)))}function Pl(r,e){for(let t=0;t<r.length&&t<e.length;++t){const n=r[t]-e[t];if(0!==n)return n}return r.length-e.length}class Vl{constructor(e){this.Xt=new he((t,n)=>le.comparator(t.field,n.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const t of e.filters){const n=t;n.isInequality()?this.Xt=this.Xt.add(n):this.tn.push(n)}}get nn(){return this.Xt.size>1}rn(e){if(j(e.collectionGroup===this.collectionId),this.nn)return!1;const t=Bn(e);if(void 0!==t&&!this.sn(t))return!1;const n=at(e);let i=new Set,s=0,a=0;for(;s<n.length&&this.sn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Xt.size>0){const u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const c=n[s];if(!this.on(u,c)||!this._n(this.en[a++],c))return!1}++s}for(;s<n.length;++s)if(a>=this.en.length||!this._n(this.en[a++],n[s]))return!1;return!0}an(){if(this.nn)return null;let e=new he(le.comparator);const t=[];for(const n of this.tn)if(!n.field.isKeyField())if("array-contains"===n.op||"array-contains-any"===n.op)t.push(new wt(n.field,2));else{if(e.has(n.field))continue;e=e.add(n.field),t.push(new wt(n.field,0))}for(const n of this.en)n.field.isKeyField()||e.has(n.field)||(e=e.add(n.field),t.push(new wt(n.field,"asc"===n.dir?0:1)));return new gt(gt.UNKNOWN_ID,this.collectionId,t,Ut.empty())}sn(e){for(const t of this.tn)if(this.on(t,e))return!0;return!1}on(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}_n(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function Sl(r){var e,t;if(j(r instanceof ne||r instanceof ce),r instanceof ne){if(r instanceof Ac){const i=(null===(t=null===(e=r.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>ne.create(r.field,"==",s)))||[];return ce.create(i,"or")}return r}const n=r.filters.map(i=>Sl(i));return ce.create(n,r.op)}function vm(r){if(0===r.getFilters().length)return[];const e=Oo(Sl(r));return j(bl(e)),Fo(e)||Mo(e)?[e]:e.getFilters()}function Fo(r){return r instanceof ne}function Mo(r){return r instanceof ce&&po(r)}function bl(r){return Fo(r)||Mo(r)||function(t){if(t instanceof ce&&go(t)){for(const n of t.getFilters())if(!Fo(n)&&!Mo(n))return!1;return!0}return!1}(r)}function Oo(r){if(j(r instanceof ne||r instanceof ce),r instanceof ne)return r;if(1===r.filters.length)return Oo(r.filters[0]);const e=r.filters.map(n=>Oo(n));let t=ce.create(e,r.op);return t=us(t),bl(t)?t:(j(t instanceof ce),j(jn(t)),j(t.filters.length>1),t.filters.reduce((n,i)=>Lo(n,i)))}function Lo(r,e){let t;return j(r instanceof ne||r instanceof ce),j(e instanceof ne||e instanceof ce),t=r instanceof ne?e instanceof ne?ce.create([r,e],"and"):xl(r,e):e instanceof ne?xl(e,r):function(i,s){if(j(i.filters.length>0&&s.filters.length>0),jn(i)&&jn(s))return Tc(i,s.getFilters());const a=go(i)?i:s,u=go(i)?s:i,c=a.filters.map(h=>Lo(h,u));return ce.create(c,"or")}(r,e),us(t)}function xl(r,e){if(jn(e))return Tc(e,r.getFilters());{const t=e.filters.map(n=>Lo(r,n));return ce.create(t,"or")}}function us(r){if(j(r instanceof ne||r instanceof ce),r instanceof ne)return r;const e=r.getFilters();if(1===e.length)return us(e[0]);if(yc(r))return r;const t=e.map(i=>us(i)),n=[];return t.forEach(i=>{i instanceof ne?n.push(i):i instanceof ce&&(i.op===r.op?n.push(...i.filters):n.push(i))}),1===n.length?n[0]:ce.create(n,r.op)}class Am{constructor(){this.un=new Bo}addToCollectionParentIndex(e,t){return this.un.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.un.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(Ye.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(Ye.min())}updateCollectionGroup(e,t,n){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class Bo{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new he(te.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new he(te.comparator)).toArray()}}const cs=new Uint8Array(0);class wm{constructor(e,t){this.databaseId=t,this.cn=new Bo,this.ln=new bt(n=>In(n),(n,i)=>Br(n,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.cn.has(t)){const n=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.cn.add(t)});const s={collectionId:n,parent:Fe(i)};return Cl(e).put(s)}return R.resolve()}getCollectionParents(e,t){const n=[],i=IDBKeyRange.bound([t,""],[mt(t),""],!1,!0);return Cl(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;n.push(ut(a.parent))}return n})}addFieldIndex(e,t){const n=ei(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])};var u;delete i.indexId;const s=n.add(i);if(t.indexState){const a=nr(e);return s.next(u=>{a.put(vl(u,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const n=ei(e),i=nr(e),s=tr(e);return n.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ei(e),n=tr(e),i=nr(e);return t.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(e,t){return R.forEach(this.hn(t),n=>this.getIndexType(e,n).next(i=>{if(0===i||1===i){const s=new Vl(n).an();if(null!=s)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const n=tr(e);let i=!0;const s=new Map;return R.forEach(this.hn(t),a=>this.Pn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=X();const u=[];return R.forEach(s,(c,h)=>{var W;F("IndexedDbIndexManager",`Using index ${W=c,`id=${W.indexId}|cg=${W.collectionGroup}|f=${W.fields.map(Y=>`${Y.fieldPath}:${Y.kind}`).join(",")}`} to execute ${In(t)}`);const f=function(W,Y){const oe=Bn(Y);if(void 0===oe)return null;for(const Z of Xi(W,oe.fieldPath))switch(Z.op){case"array-contains-any":return Z.value.arrayValue.values||[];case"array-contains":return[Z.value]}return null}(h,c),p=function(W,Y){const oe=new Map;for(const Z of at(Y))for(const v of Xi(W,Z.fieldPath))switch(v.op){case"==":case"in":oe.set(Z.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return oe.set(Z.fieldPath.canonicalString(),v.value),Array.from(oe.values())}return null}(h,c),y=function(W,Y){const oe=[];let Z=!0;for(const v of at(Y)){const _=0===v.kind?wc(W,v.fieldPath,W.startAt):Rc(W,v.fieldPath,W.startAt);oe.push(_.value),Z&&(Z=_.inclusive)}return new $t(oe,Z)}(h,c),V=function(W,Y){const oe=[];let Z=!0;for(const v of at(Y)){const _=0===v.kind?Rc(W,v.fieldPath,W.endAt):wc(W,v.fieldPath,W.endAt);oe.push(_.value),Z&&(Z=_.inclusive)}return new $t(oe,Z)}(h,c),N=this.In(c,h,y),L=this.In(c,h,V),M=this.Tn(c,h,p),Q=this.En(c.indexId,f,N,y.inclusive,L,V.inclusive,M);return R.forEach(Q,H=>n.G(H,t.limit).next(W=>{W.forEach(Y=>{const oe=G.fromSegments(Y.documentKey);a.has(oe)||(a=a.add(oe),u.push(oe))})}))}).next(()=>u)}return R.resolve(null)})}hn(e){let t=this.ln.get(e);return t||(t=0===e.filters.length?[e]:vm(ce.create(e.filters,"and")).map(n=>yo(e.path,e.collectionGroup,e.orderBy,n.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,t),t)}En(e,t,n,i,s,a,u){const c=(null!=t?t.length:1)*Math.max(n.length,s.length),h=c/(null!=t?t.length:1),f=[];for(let p=0;p<c;++p){const y=t?this.dn(t[p/h]):cs,V=this.An(e,y,n[p%h],i),N=this.Rn(e,y,s[p%h],a),L=u.map(M=>this.An(e,y,M,!0));f.push(...this.createRange(V,N,L))}return f}An(e,t,n,i){const s=new Pn(e,G.empty(),t,n);return i?s:s.Zt()}Rn(e,t,n,i){const s=new Pn(e,G.empty(),t,n);return i?s.Zt():s}Pn(e,t){const n=new Vl(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)n.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,t){let n=2;const i=this.hn(t);return R.forEach(i,s=>this.Pn(e,s).next(a=>{a?0!==n&&a.fields.length<function(c){let h=new he(le.comparator),f=!1;for(const p of c.filters)for(const y of p.getFlattenedFilters())y.field.isKeyField()||("array-contains"===y.op||"array-contains-any"===y.op?f=!0:h=h.add(y.field));for(const p of c.orderBy)p.field.isKeyField()||(h=h.add(p.field));return h.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>null!==t.limit&&i.length>1&&2===n?1:n)}Vn(e,t){const n=new Zr;for(const i of at(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const a=n.Yt(i.kind);Rn.vt.It(s,a)}return n.zt()}dn(e){const t=new Zr;return Rn.vt.It(e,t.Yt(0)),t.zt()}mn(e,t){const n=new Zr;return Rn.vt.It(yn(this.databaseId,t),n.Yt(function(s){const a=at(s);return 0===a.length?0:a[a.length-1].kind}(e))),n.zt()}Tn(e,t,n){if(null===n)return[];let i=[];i.push(new Zr);let s=0;for(const a of at(e)){const u=n[s++];for(const c of i)if(this.fn(t,a.fieldPath)&&Mr(u))i=this.gn(i,a,u);else{const h=c.Yt(a.kind);Rn.vt.It(u,h)}}return this.pn(i)}In(e,t,n){return this.Tn(e,t,n.position)}pn(e){const t=[];for(let n=0;n<e.length;++n)t[n]=e[n].zt();return t}gn(e,t,n){const i=[...e],s=[];for(const a of n.arrayValue.values||[])for(const u of i){const c=new Zr;c.seed(u.zt()),Rn.vt.It(a,c.Yt(t.kind)),s.push(c)}return s}fn(e,t){return!!e.filters.find(n=>n instanceof ne&&n.field.isEqual(t)&&("in"===n.op||"not-in"===n.op))}getFieldIndexes(e,t){const n=ei(e),i=nr(e);return(t?n.U("collectionGroupIndex",IDBKeyRange.bound(t,t)):n.U()).next(s=>{const a=[];return R.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{a.push(function(f,p){const y=p?new Ut(p.sequenceNumber,new Ye(An(p.readTime),new G(ut(p.documentKey)),p.largestBatchId)):Ut.empty(),V=f.fields.map(([N,L])=>new wt(le.fromServerFormat(N),L));return new gt(f.indexId,f.collectionGroup,V,y)}(u,c))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((n,i)=>{const s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:J(n.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,n){const i=ei(e),s=nr(e);return this.yn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(u=>R.forEach(u,c=>s.put(vl(c.indexId,this.uid,a,n)))))}updateIndexEntries(e,t){const n=new Map;return R.forEach(t,(i,s)=>{const a=n.get(i.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),R.forEach(u,c=>this.wn(e,i,c).next(h=>{const f=this.Sn(s,c);return h.isEqual(f)?R.resolve():this.bn(e,s,c,h,f)}))))})}Dn(e,t,n,i){return tr(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(n,t.key),documentKey:t.key.path.toArray()})}vn(e,t,n,i){return tr(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(n,t.key),t.key.path.toArray()])}wn(e,t,n){const i=tr(e);let s=new he(Ht);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.mn(n,t)])},(a,u)=>{s=s.add(new Pn(n.indexId,t,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,t){let n=new he(Ht);const i=this.Vn(t,e);if(null==i)return n;const s=Bn(t);if(null!=s){const a=e.data.field(s.fieldPath);if(Mr(a))for(const u of a.arrayValue.values||[])n=n.add(new Pn(t.indexId,e.key,this.dn(u),i))}else n=n.add(new Pn(t.indexId,e.key,cs,i));return n}bn(e,t,n,i,s){F("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(c,h,f,p,y){const V=c.getIterator(),N=h.getIterator();let L=Kn(V),M=Kn(N);for(;L||M;){let Q=!1,H=!1;if(L&&M){const W=f(L,M);W<0?H=!0:W>0&&(Q=!0)}else null!=L?H=!0:Q=!0;Q?(p(M),M=Kn(N)):H?(y(L),L=Kn(V)):(L=Kn(V),M=Kn(N))}}(i,s,Ht,u=>{a.push(this.Dn(e,t,n,u))},u=>{a.push(this.vn(e,t,n,u))}),R.waitFor(a)}yn(e){let t=1;return nr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,n){n=n.sort((a,u)=>Ht(a,u)).filter((a,u,c)=>!u||0!==Ht(a,c[u-1]));const i=[];i.push(e);for(const a of n){const u=Ht(a,e),c=Ht(a,t);if(0===u)i[0]=e.Zt();else if(u>0&&c<0)i.push(a),i.push(a.Zt());else if(c>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];s.push(IDBKeyRange.bound([i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,cs,[]],[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,cs,[]]))}return s}Cn(e,t){return Ht(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Dl)}getMinOffset(e,t){return R.mapArray(this.hn(t),n=>this.Pn(e,n).next(i=>i||z())).next(Dl)}}function Cl(r){return Ne(r,"collectionParents")}function tr(r){return Ne(r,"indexEntries")}function ei(r){return Ne(r,"indexConfiguration")}function nr(r){return Ne(r,"indexState")}function Dl(r){j(0!==r.length);let e=r[0].indexState.offset,t=e.largestBatchId;for(let n=1;n<r.length;n++){const i=r[n].indexState.offset;Dr(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Ye(e.readTime,e.documentKey,t)}const Nl={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class je{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new je(e,je.DEFAULT_COLLECTION_PERCENTILE,je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function kl(r,e,t){const n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let u=0;const c=n.J({range:a},(f,p,y)=>(u++,y.delete()));s.push(c.next(()=>{j(1===u)}));const h=[];for(const f of t.mutations){const p=Gn(e,f.key.path,t.batchId);s.push(i.delete(p)),h.push(f.key)}return R.waitFor(s).next(()=>h)}function ls(r){if(!r)return 0;let e;if(r.document)e=r.document;else if(r.unknownDocument)e=r.unknownDocument;else{if(!r.noDocument)throw z();e=r.noDocument}return JSON.stringify(e).length}je.DEFAULT_COLLECTION_PERCENTILE=10,je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,je.DEFAULT=new je(41943040,je.DEFAULT_COLLECTION_PERCENTILE,je.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),je.DISABLED=new je(-1,0,0);class hs{constructor(e,t,n,i){this.userId=e,this.serializer=t,this.indexManager=n,this.referenceDelegate=i,this.Fn={}}static lt(e,t,n,i){j(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new hs(s,t,n,i)}checkEmpty(e){let t=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Jt(e).J({index:"userMutationsIndex",range:n},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,n,i){const s=rr(e),a=Jt(e);return a.add({}).next(u=>{j("number"==typeof u);const c=new wo(u,t,n,i),h=function(V,N,L){const M=L.baseMutations.map(H=>Jr(V.ct,H)),Q=L.mutations.map(H=>Jr(V.ct,H));return{userId:N,batchId:L.batchId,localWriteTimeMs:L.localWriteTime.toMillis(),baseMutations:M,mutations:Q}}(this.serializer,this.userId,c),f=[];let p=new he((y,V)=>J(y.canonicalString(),V.canonicalString()));for(const y of i){const V=Gn(this.userId,y.key.path,u);p=p.add(y.key.path.popLast()),f.push(a.put(h)),f.push(s.put(V,_n))}return p.forEach(y=>{f.push(this.indexManager.addToCollectionParentIndex(e,y))}),e.addOnCommittedListener(()=>{this.Fn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(e,t){return Jt(e).get(t).next(n=>n?(j(n.userId===this.userId),wn(this.serializer,n)):null)}Mn(e,t){return this.Fn[t]?R.resolve(this.Fn[t]):this.lookupMutationBatch(e,t).next(n=>{if(n){const i=n.keys();return this.Fn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return Jt(e).J({index:"userMutationsIndex",range:i},(a,u,c)=>{u.userId===this.userId&&(j(u.batchId>=n),s=wn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Jt(e).J({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Jt(e).U("userMutationsIndex",t).next(n=>n.map(i=>wn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const n=Rt(this.userId,t.path),i=IDBKeyRange.lowerBound(n),s=[];return rr(e).J({range:i},(a,u,c)=>{const[h,f,p]=a,y=ut(f);if(h===this.userId&&t.path.isEqual(y))return Jt(e).get(p).next(V=>{if(!V)throw z();j(V.userId===this.userId),s.push(wn(this.serializer,V))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new he(J);const i=[];return t.forEach(s=>{const a=Rt(this.userId,s.path),u=IDBKeyRange.lowerBound(a),c=rr(e).J({range:u},(h,f,p)=>{const[y,V,N]=h,L=ut(V);y===this.userId&&s.path.isEqual(L)?n=n.add(N):p.done()});i.push(c)}),R.waitFor(i).next(()=>this.xn(e,n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1,s=Rt(this.userId,n),a=IDBKeyRange.lowerBound(s);let u=new he(J);return rr(e).J({range:a},(c,h,f)=>{const[p,y,V]=c,N=ut(y);p===this.userId&&n.isPrefixOf(N)?N.length===i&&(u=u.add(V)):f.done()}).next(()=>this.xn(e,u))}xn(e,t){const n=[],i=[];return t.forEach(s=>{i.push(Jt(e).get(s).next(a=>{if(null===a)throw z();j(a.userId===this.userId),n.push(wn(this.serializer,a))}))}),R.waitFor(i).next(()=>n)}removeMutationBatch(e,t){return kl(e._e,this.userId,t).next(n=>(e.addOnCommittedListener(()=>{this.On(t.batchId)}),R.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();const n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return rr(e).J({range:n},(s,a,u)=>{if(s[0]===this.userId){const c=ut(s[1]);i.push(c)}else u.done()}).next(()=>{j(0===i.length)})})}containsKey(e,t){return Fl(e,this.userId,t)}Nn(e){return Ml(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Fl(r,e,t){const n=Rt(e,t.path),i=n[1],s=IDBKeyRange.lowerBound(n);let a=!1;return rr(r).J({range:s,H:!0},(u,c,h)=>{const[f,p,y]=u;f===e&&p===i&&(a=!0),h.done()}).next(()=>a)}function Jt(r){return Ne(r,"mutations")}function rr(r){return Ne(r,"documentMutations")}function Ml(r){return Ne(r,"mutationQueues")}class Vn{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new Vn(0)}static kn(){return new Vn(-1)}}class Rm{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.qn(e).next(t=>{const n=new Vn(t.highestTargetId);return t.highestTargetId=n.next(),this.Qn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(t=>$.fromTimestamp(new ge(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,n){return this.qn(e).next(i=>(i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Qn(e,i)))}addTargetData(e,t){return this.Kn(e,t).next(()=>this.qn(e).next(n=>(n.targetCount+=1,this.$n(t,n),this.Qn(e,n))))}updateTargetData(e,t){return this.Kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ir(e).delete(t.targetId)).next(()=>this.qn(e)).next(n=>(j(n.targetCount>0),n.targetCount-=1,this.Qn(e,n)))}removeTargets(e,t,n){let i=0;const s=[];return ir(e).J((a,u)=>{const c=Yr(u);c.sequenceNumber<=t&&null===n.get(c.targetId)&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ir(e).J((n,i)=>{const s=Yr(i);t(s)})}qn(e){return Ol(e).get("targetGlobalKey").next(t=>(j(null!==t),t))}Qn(e,t){return Ol(e).put("targetGlobalKey",t)}Kn(e,t){return ir(e).put(Tl(this.serializer,t))}$n(e,t){let n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}getTargetCount(e){return this.qn(e).next(t=>t.targetCount)}getTargetData(e,t){const n=In(t),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return ir(e).J({range:i,index:"queryTargetsIndex"},(a,u,c)=>{const h=Yr(u);Br(t,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(e,t,n){const i=[],s=Yt(e);return t.forEach(a=>{const u=Fe(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(e,n,a))}),R.waitFor(i)}removeMatchingKeys(e,t,n){const i=Yt(e);return R.forEach(t,s=>{const a=Fe(s.path);return R.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(e,n,s)])})}removeMatchingKeysForTargetId(e,t){const n=Yt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(e,t){const n=IDBKeyRange.bound([t],[t+1],!1,!0),i=Yt(e);let s=X();return i.J({range:n,H:!0},(a,u,c)=>{const h=ut(a[1]),f=new G(h);s=s.add(f)}).next(()=>s)}containsKey(e,t){const n=Fe(t.path),i=IDBKeyRange.bound([n],[mt(n)],!1,!0);let s=0;return Yt(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],c,h)=>{0!==a&&(s++,h.done())}).next(()=>s>0)}ot(e,t){return ir(e).get(t).next(n=>n?Yr(n):null)}}function ir(r){return Ne(r,"targets")}function Ol(r){return Ne(r,"targetGlobal")}function Yt(r){return Ne(r,"targetDocuments")}function Ll([r,e],[t,n]){const i=J(r,t);return 0===i?J(e,n):i}class Pm{constructor(e){this.Un=e,this.buffer=new he(Ll),this.Wn=0}Gn(){return++this.Wn}zn(e){const t=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(t);else{const n=this.buffer.last();Ll(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}get maxValue(){return this.buffer.last()[0]}}class Bl{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.jn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return null!==this.jn}Hn(e){var t=this;F("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,C.A)(function*(){t.jn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(n){U(n)?F("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):yield pt(n)}yield t.Hn(3e5)}))}}class Vm{constructor(e,t){this.Jn=e,this.params=t}calculateTargetCount(e,t){return this.Jn.Yn(e).next(n=>Math.floor(t/100*n))}nthSequenceNumber(e,t){if(0===t)return R.resolve(De.oe);const n=new Pm(t);return this.Jn.forEachTarget(e,i=>n.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>n.zn(i))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.Jn.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Jn.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Nl)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(F("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Nl):this.Xn(e,t))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,t){let n,i,s,a,u,c,h;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(p=>(p>this.params.maximumSequenceNumbersToCollect?(F("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${p}`),i=this.params.maximumSequenceNumbersToCollect):i=p,a=Date.now(),this.nthSequenceNumber(e,i))).next(p=>(n=p,u=Date.now(),this.removeTargets(e,n,t))).next(p=>(s=p,c=Date.now(),this.removeOrphanedDocuments(e,n))).next(p=>(h=Date.now(),Bt()<=Ie.$b.DEBUG&&F("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${a-f}ms\n\tDetermined least recently used ${i} in `+(u-a)+`ms\n\tRemoved ${s} targets in `+(c-u)+`ms\n\tRemoved ${p} documents in `+(h-c)+`ms\nTotal Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:p})))}}class Sm{constructor(e,t){this.db=e,this.garbageCollector=function ql(r,e){return new Vm(r,e)}(this,t)}Yn(e){const t=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(n=>t.next(i=>n+i))}er(e){let t=0;return this.Zn(e,n=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Zn(e,t){return this.tr(e,(n,i)=>t(i))}addReference(e,t,n){return ds(e,n)}removeReference(e,t,n){return ds(e,n)}removeTargets(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}markPotentiallyOrphaned(e,t){return ds(e,t)}nr(e,t){return function(i,s){let a=!1;return Ml(i).Y(u=>Fl(i,u,s).next(c=>(c&&(a=!0),R.resolve(!c)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(a,u)=>{if(u<=t){const c=this.nr(e,a).next(h=>{if(!h)return s++,n.getEntry(e,a).next(()=>(n.removeEntry(a,$.min()),Yt(e).delete([0,Fe(a.path)])))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>n.apply(e)).next(()=>s)}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}updateLimboDocument(e,t){return ds(e,t)}tr(e,t){const n=Yt(e);let i,s=De.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:c,sequenceNumber:h})=>{0===a?(s!==De.oe&&t(new G(ut(i)),s),s=h,i=c):s=De.oe}).next(()=>{s!==De.oe&&t(new G(ut(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ds(r,e){return Yt(r).put((i=r.currentSequenceNumber,{targetId:0,path:Fe(e.path),sequenceNumber:i}));var i}class Ul{constructor(){this.changes=new bt(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,_e.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?R.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class bm{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,n){return Sn(e).put(n)}removeEntry(e,t,n){return Sn(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],os(a),u[u.length-1]]}(t,n))}updateMetadata(e,t){return this.getMetadata(e).next(n=>(n.byteSize+=t,this.rr(e,n)))}getEntry(e,t){let n=_e.newInvalidDocument(t);return Sn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ti(t))},(i,s)=>{n=this.ir(t,s)}).next(()=>n)}sr(e,t){let n={size:0,document:_e.newInvalidDocument(t)};return Sn(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(ti(t))},(i,s)=>{n={document:this.ir(t,s),size:ls(s)}}).next(()=>n)}getEntries(e,t){let n=nt();return this._r(e,t,(i,s)=>{const a=this.ir(i,s);n=n.insert(i,a)}).next(()=>n)}ar(e,t){let n=nt(),i=new pe(G.comparator);return this._r(e,t,(s,a)=>{const u=this.ir(s,a);n=n.insert(s,u),i=i.insert(s,ls(a))}).next(()=>({documents:n,ur:i}))}_r(e,t,n){if(t.isEmpty())return R.resolve();let i=new he(jl);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(ti(i.first()),ti(i.last())),a=i.getIterator();let u=a.getNext();return Sn(e).J({index:"documentKeyIndex",range:s},(c,h,f)=>{const p=G.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&jl(u,p)<0;)n(u,null),u=a.getNext();u&&u.isEqual(p)&&(n(u,h),u=a.hasNext()?a.getNext():null),u?f.$(ti(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,n,i,s){const a=t.path,u=[a.popLast().toArray(),a.lastSegment(),os(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],c=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Sn(e).U(IDBKeyRange.bound(u,c,!0)).next(h=>{null==s||s.incrementDocumentReadCount(h.length);let f=nt();for(const p of h){const y=this.ir(G.fromSegments(p.prefixPath.concat(p.collectionGroup,p.documentId)),p);y.isFoundDocument()&&(Ur(t,y)||i.has(y.key))&&(f=f.insert(y.key,y))}return f})}getAllFromCollectionGroup(e,t,n,i){let s=nt();const a=zl(t,n),u=zl(t,Ye.max());return Sn(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(c,h,f)=>{const p=this.ir(G.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(p.key,p),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(e){return new xm(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Kl(e).get("remoteDocumentGlobalKey").next(t=>(j(!!t),t))}rr(e,t){return Kl(e).put("remoteDocumentGlobalKey",t)}ir(e,t){if(t){const n=function gm(r,e){let t;if(e.document)t=hl(r.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const n=G.fromSegments(e.noDocument.path),i=An(e.noDocument.readTime);t=_e.newNoDocument(n,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return z();{const n=G.fromSegments(e.unknownDocument.path),i=An(e.unknownDocument.version);t=_e.newUnknownDocument(n,i)}}return e.readTime&&t.setReadTime(function(i){const s=new ge(i[0],i[1]);return $.fromTimestamp(s)}(e.readTime)),t}(this.serializer,t);if(!n.isNoDocument()||!n.version.isEqual($.min()))return n}return _e.newInvalidDocument(e)}}function Gl(r){return new bm(r)}class xm extends Ul{constructor(e,t){super(),this.cr=e,this.trackRemovals=t,this.lr=new bt(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(e){const t=[];let n=0,i=new he((s,a)=>J(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.lr.get(s);if(t.push(this.cr.removeEntry(e,s,u.readTime)),a.isValidDocument()){const c=Il(this.cr.serializer,a);i=i.add(s.path.popLast());const h=ls(c);n+=h-u.size,t.push(this.cr.addEntry(e,s,c))}else if(n-=u.size,this.trackRemovals){const c=Il(this.cr.serializer,a.convertToNoDocument($.min()));t.push(this.cr.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.cr.updateMetadata(e,n)),R.waitFor(t)}getFromCache(e,t){return this.cr.sr(e,t).next(n=>(this.lr.set(t,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(e,t){return this.cr.ar(e,t).next(({documents:n,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:n.get(s).readTime})}),n))}}function Kl(r){return Ne(r,"remoteDocumentGlobal")}function Sn(r){return Ne(r,"remoteDocumentsV14")}function ti(r){const e=r.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function zl(r,e){const t=e.documentKey.path.toArray();return[r,os(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jl(r,e){const t=r.path.toArray(),n=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<n.length-2;++s)if(i=J(t[s],n[s]),i)return i;return i=J(t.length,n.length),i||(i=J(t[t.length-2],n[n.length-2]),i||J(t[t.length-1],n[n.length-1]))}class Cm{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ql{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(n=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==n&&jr(n.mutation,i,tt.empty(),ge.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.getLocalViewOfDocuments(e,n,X()).next(()=>n))}getLocalViewOfDocuments(e,t,n=X()){const i=yt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,n).next(s=>{let a=Gr();return s.forEach((u,c)=>{a=a.insert(u,c.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const n=yt();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,X()))}populateOverlays(e,t,n){const i=[];return n.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{t.set(a,u)})})}computeViews(e,t,n,i){let s=nt();const a=Kr(),u=Kr();return t.forEach((c,h)=>{const f=n.get(h.key);i.has(h.key)&&(void 0===f||f.mutation instanceof xt)?s=s.insert(h.key,h):void 0!==f?(a.set(h.key,f.mutation.getFieldMask()),jr(f.mutation,h,f.mutation.getFieldMask(),ge.now())):a.set(h.key,tt.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((h,f)=>a.set(h,f)),t.forEach((h,f)=>{var p;return u.set(h,new Cm(f,null!==(p=a.get(h))&&void 0!==p?p:null))}),u))}recalculateAndSaveOverlays(e,t){const n=Kr();let i=new pe((a,u)=>a-u),s=X();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const u of a)u.keys().forEach(c=>{const h=t.get(c);if(null===h)return;let f=n.get(c)||tt.empty();f=u.applyToLocalView(h,f),n.set(c,f);const p=(i.get(u.batchId)||X()).add(c);i=i.insert(u.batchId,p)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const c=u.getNext(),h=c.key,f=c.value,p=Fc();f.forEach(y=>{if(!s.has(y)){const V=Kc(t.get(y),n.get(y));null!==V&&p.set(y,V),s=s.add(y)}}),a.push(this.documentOverlayCache.saveOverlays(e,h,p))}return R.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(n=>this.recalculateAndSaveOverlays(e,n))}getDocumentsMatchingQuery(e,t,n,i){return G.isDocumentKey((a=t).path)&&null===a.collectionGroup&&0===a.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Io(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i);var a}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):R.resolve(yt());let u=-1,c=s;return a.next(h=>R.forEach(h,(f,p)=>(u<p.largestBatchId&&(u=p.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(e,f).next(y=>{c=c.insert(f,y)}))).next(()=>this.populateOverlays(e,h,s)).next(()=>this.computeViews(e,c,h,X())).next(f=>({batchId:u,changes:kc(f)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new G(t)).next(n=>{let i=Gr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let a=Gr();return this.indexManager.getCollectionParents(e,s).next(u=>R.forEach(u,c=>{const h=(p=t,y=c.child(s),new St(y,null,p.explicitOrderBy.slice(),p.filters.slice(),p.limit,p.limitType,p.startAt,p.endAt));var p,y;return this.getDocumentsMatchingCollectionQuery(e,h,n,i).next(f=>{f.forEach((p,y)=>{a=a.insert(p,y)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i))).next(a=>{s.forEach((c,h)=>{const f=h.getKey();null===a.get(f)&&(a=a.insert(f,_e.newInvalidDocument(f)))});let u=Gr();return a.forEach((c,h)=>{const f=s.get(c);void 0!==f&&jr(f.mutation,h,tt.empty(),ge.now()),Ur(t,h)&&(u=u.insert(c,h))}),u})}}class Dm{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,t){return R.resolve(this.hr.get(t))}saveBundleMetadata(e,t){return this.hr.set(t.id,{id:(i=t).id,version:i.version,createTime:be(i.createTime)}),R.resolve();var i}getNamedQuery(e,t){return R.resolve(this.Pr.get(t))}saveNamedQuery(e,t){return this.Pr.set(t.name,{name:(i=t).name,query:No(i.bundledQuery),readTime:be(i.readTime)}),R.resolve();var i}}class Nm{constructor(){this.overlays=new pe(G.comparator),this.Ir=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const n=yt();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&n.set(i,s)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((i,s)=>{this.ht(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.Ir.get(n);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(n)),R.resolve()}getOverlaysForCollection(e,t,n){const i=yt(),s=t.length+1,a=new G(t.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const c=u.getNext().value,h=c.getKey();if(!t.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>n&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new pe((h,f)=>h-f);const a=this.overlays.getIterator();for(;a.hasNext();){const h=a.getNext().value;if(h.getKey().getCollectionGroup()===t&&h.largestBatchId>n){let f=s.get(h.largestBatchId);null===f&&(f=yt(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}const u=yt(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return R.resolve(u)}ht(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const a=this.Ir.get(i.largestBatchId).delete(n.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Po(t,n));let s=this.Ir.get(t);void 0===s&&(s=X(),this.Ir.set(t,s)),this.Ir.set(t,s.add(n.key))}}class km{constructor(){this.sessionToken=we.EMPTY_BYTE_STRING}getSessionToken(e){return R.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,R.resolve()}}class qo{constructor(){this.Tr=new he(Me.Er),this.dr=new he(Me.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,t){const n=new Me(e,t);this.Tr=this.Tr.add(n),this.dr=this.dr.add(n)}Rr(e,t){e.forEach(n=>this.addReference(n,t))}removeReference(e,t){this.Vr(new Me(e,t))}mr(e,t){e.forEach(n=>this.removeReference(n,t))}gr(e){const t=new G(new te([])),n=new Me(t,e),i=new Me(t,e+1),s=[];return this.dr.forEachInRange([n,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const t=new G(new te([])),n=new Me(t,e),i=new Me(t,e+1);let s=X();return this.dr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new Me(e,0),n=this.Tr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Me{constructor(e,t){this.key=e,this.wr=t}static Er(e,t){return G.comparator(e.key,t.key)||J(e.wr,t.wr)}static Ar(e,t){return J(e.wr,t.wr)||G.comparator(e.key,t.key)}}class Fm{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Sr=1,this.br=new he(Me.Er)}checkEmpty(e){return R.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.Sr;this.Sr++;const a=new wo(s,t,n,i);this.mutationQueue.push(a);for(const u of i)this.br=this.br.add(new Me(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.Dr(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.vr(t+1),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(0===this.mutationQueue.length?-1:this.Sr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Me(t,0),i=new Me(t,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([n,i],a=>{const u=this.Dr(a.wr);s.push(u)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new he(J);return t.forEach(i=>{const s=new Me(i,0),a=new Me(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{n=n.add(u.wr)})}),R.resolve(this.Cr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;G.isDocumentKey(s)||(s=s.child(""));const a=new Me(new G(s),0);let u=new he(J);return this.br.forEachWhile(c=>{const h=c.key.path;return!!n.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.wr)),!0)},a),R.resolve(this.Cr(u))}Cr(e){const t=[];return e.forEach(n=>{const i=this.Dr(n);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){j(0===this.Fr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.br;return R.forEach(t.mutations,i=>{const s=new Me(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=n})}On(e){}containsKey(e,t){const n=new Me(t,0),i=this.br.firstAfterOrEqual(n);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return R.resolve()}Fr(e,t){return this.vr(e)}vr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Dr(e){const t=this.vr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Mm{constructor(e){this.Mr=e,this.docs=new pe(G.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,a=this.Mr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return R.resolve(n?n.document.mutableCopy():_e.newInvalidDocument(t))}getEntries(e,t){let n=nt();return t.forEach(i=>{const s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():_e.newInvalidDocument(i))}),R.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=nt();const a=t.path,u=new G(a.child("")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){const{key:h,value:{document:f}}=c.getNext();if(!a.isPrefixOf(h.path))break;h.path.length>a.length+1||Dr(Cr(f),n)<=0||(i.has(f.key)||Ur(t,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,n,i){z()}Or(e,t){return R.forEach(this.docs,n=>t(n))}newChangeBuffer(e){return new Om(this)}getSize(e){return R.resolve(this.size)}}class Om extends Ul{constructor(e){super(),this.cr=e}applyChanges(e){const t=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?t.push(this.cr.addEntry(e,i)):this.cr.removeEntry(n)}),R.waitFor(t)}getFromCache(e,t){return this.cr.getEntry(e,t)}getAllFromCache(e,t){return this.cr.getEntries(e,t)}}class Lm{constructor(e){this.persistence=e,this.Nr=new bt(t=>In(t),Br),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.Lr=0,this.Br=new qo,this.targetCount=0,this.kr=Vn.Bn()}forEachTarget(e,t){return this.Nr.forEach((n,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Lr&&(this.Lr=t),R.resolve()}Kn(e){this.Nr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.kr=new Vn(t),this.highestTargetId=t),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,t){return this.Kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.Kn(t),R.resolve()}removeTargetData(e,t){return this.Nr.delete(t.target),this.Br.gr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=t&&null===n.get(u.targetId)&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const n=this.Nr.get(t)||null;return R.resolve(n)}addMatchingKeys(e,t,n){return this.Br.Rr(t,n),R.resolve()}removeMatchingKeys(e,t,n){this.Br.mr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Br.gr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Br.yr(t);return R.resolve(n)}containsKey(e,t){return R.resolve(this.Br.containsKey(t))}}class Uo{constructor(e,t){this.qr={},this.overlays={},this.Qr=new De(0),this.Kr=!1,this.Kr=!0,this.$r=new km,this.referenceDelegate=e(this),this.Ur=new Lm(this),this.indexManager=new Am,this.remoteDocumentCache=new Mm(n=>this.referenceDelegate.Wr(n)),this.serializer=new yl(t),this.Gr=new Dm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Nm,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.qr[e.toKey()];return n||(n=new Fm(t,this.referenceDelegate),this.qr[e.toKey()]=n),n}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,t,n){F("MemoryPersistence","Starting transaction:",e);const i=new Bm(this.Qr.next());return this.referenceDelegate.zr(),n(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,t){return R.or(Object.values(this.qr).map(n=>()=>n.containsKey(e,t)))}}class Bm extends Ui{constructor(e){super(),this.currentSequenceNumber=e}}class fs{constructor(e){this.persistence=e,this.Jr=new qo,this.Yr=null}static Zr(e){return new fs(e)}get Xr(){if(this.Yr)return this.Yr;throw z()}addReference(e,t,n){return this.Jr.addReference(n,t),this.Xr.delete(n.toString()),R.resolve()}removeReference(e,t,n){return this.Jr.removeReference(n,t),this.Xr.add(n.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Xr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Jr.gr(t.targetId).forEach(i=>this.Xr.add(i.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>n.removeTargetData(e,t))}zr(){this.Yr=new Set}jr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Xr,n=>{const i=G.fromPath(n);return this.ei(e,i).next(s=>{s||t.removeEntry(i,$.min())})}).next(()=>(this.Yr=null,t.apply(e)))}updateLimboDocument(e,t){return this.ei(e,t).next(n=>{n?this.Xr.delete(t.toString()):this.Xr.add(t.toString())})}Wr(e){return 0}ei(e,t){return R.or([()=>R.resolve(this.Jr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Hr(e,t)])}}class qm{constructor(e){this.serializer=e}O(e,t,n,i){const s=new Nr("createOrUpgrade",t);var c;n<1&&i>=1&&(e.createObjectStore("owner"),(c=e).createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ao,{unique:!0}),c.createObjectStore("documentMutations"),$l(e),function(c){c.createObjectStore("remoteDocuments")}(e));let a=R.resolve();return n<3&&i>=3&&(0!==n&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),$l(e)),a=a.next(()=>function(c){const h=c.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return h.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(0!==n&&(a=a.next(()=>function(c,h){return h.store("mutations").U().next(f=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ao,{unique:!0});const p=h.store("mutations"),y=f.map(V=>p.put(V));return R.waitFor(y)})}(e,s))),a=a.next(()=>{!function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),n<5&&i>=5&&(a=a.next(()=>this.ni(s))),n<6&&i>=6&&(a=a.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),n<7&&i>=7&&(a=a.next(()=>this.ii(s))),n<8&&i>=8&&(a=a.next(()=>this.si(e,s))),n<9&&i>=9&&(a=a.next(()=>{!function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")}(e)})),n<10&&i>=10&&(a=a.next(()=>this.oi(s))),n<11&&i>=11&&(a=a.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),n<12&&i>=12&&(a=a.next(()=>{!function(c){const h=c.createObjectStore("documentOverlays",{keyPath:Af});h.createIndex("collectionPathOverlayIndex",wf,{unique:!1}),h.createIndex("collectionGroupOverlayIndex",Rf,{unique:!1})}(e)})),n<13&&i>=13&&(a=a.next(()=>function(c){const h=c.createObjectStore("remoteDocumentsV14",{keyPath:uo});h.createIndex("documentKeyIndex",co),h.createIndex("collectionGroupIndex",mf)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.ai(e,s))),n<15&&i>=15&&(a=a.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:If}).createIndex("sequenceNumberIndex",Tf,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:Ef}).createIndex("documentKeyIndex",vf,{unique:!1})}(e))),n<16&&i>=16&&(a=a.next(()=>{t.objectStore("indexState").clear()}).next(()=>{t.objectStore("indexEntries").clear()})),n<17&&i>=17&&(a=a.next(()=>{!function(c){c.createObjectStore("globals",{keyPath:"name"})}(e)})),a}ri(e){let t=0;return e.store("remoteDocuments").J((n,i)=>{t+=ls(i)}).next(()=>{const n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}ni(e){const t=e.store("mutationQueues"),n=e.store("mutations");return t.U().next(i=>R.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>R.forEach(u,c=>{j(c.userId===s.userId);const h=wn(this.serializer,c);return kl(e,s.userId,h).next(()=>{})}))}))}ii(e){const t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return n.J((a,u)=>{const c=new te(a),h=[0,Fe(c)];s.push(t.get(h).next(f=>f?R.resolve():t.put({targetId:0,path:Fe(c),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>R.waitFor(s))})}si(e,t){e.createObjectStore("collectionParents",{keyPath:yf});const n=t.store("collectionParents"),i=new Bo,s=a=>{if(i.add(a)){const u=a.lastSegment(),c=a.popLast();return n.put({collectionId:u,parent:Fe(c)})}};return t.store("remoteDocuments").J({H:!0},(a,u)=>{const c=new te(a);return s(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([a,u,c],h)=>{const f=ut(u);return s(f.popLast())}))}oi(e){const t=e.store("targets");return t.J((n,i)=>{const s=Yr(i),a=Tl(this.serializer,s);return t.put(a)})}_i(e,t){const n=t.store("remoteDocuments"),i=[];return n.J((s,a)=>{const u=t.store("remoteDocumentsV14"),c=(p=a,p.document?new G(te.fromString(p.document.name).popFirst(5)):p.noDocument?G.fromSegments(p.noDocument.path):p.unknownDocument?G.fromSegments(p.unknownDocument.path):z()).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};var p;i.push(u.put(h))}).next(()=>R.waitFor(i))}ai(e,t){const n=t.store("mutations"),i=Gl(this.serializer),s=new Uo(fs.Zr,this.serializer.ct);return n.U().next(a=>{const u=new Map;return a.forEach(c=>{var h;let f=null!==(h=u.get(c.userId))&&void 0!==h?h:X();wn(this.serializer,c).keys().forEach(p=>f=f.add(p)),u.set(c.userId,f)}),R.forEach(u,(c,h)=>{const f=new Ve(h),p=as.lt(this.serializer,f),y=s.getIndexManager(f),V=hs.lt(f,this.serializer,y,s.referenceDelegate);return new Ql(i,V,p,y).recalculateAndSaveOverlaysForDocumentKeys(new ho(t,De.oe),c).next()})})}}function $l(r){r.createObjectStore("targetDocuments",{keyPath:pf}).createIndex("documentTargetsIndex",_f,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",gf,{unique:!0}),r.createObjectStore("targetGlobal")}const Go="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Ko{constructor(e,t,n,i,s,a,u,c,h,f,p=17){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=n,this.ui=s,this.window=a,this.document=u,this.ci=h,this.li=f,this.hi=p,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=y=>Promise.resolve(),!Ko.D())throw new k(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Sm(this,i),this.Ai=t+"main",this.serializer=new yl(c),this.Ri=new O(this.Ai,this.hi,new qm(this.serializer)),this.$r=new _m,this.Ur=new Rm(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Gl(this.serializer),this.Gr=new pm,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,!1===f&&Te("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(b.FAILED_PRECONDITION,Go);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new De(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){var t=this;return this.di=function(){var n=(0,C.A)(function*(i){if(t.started)return e(i)});return function(i){return n.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(function(){var t=(0,C.A)(function*(n){null===n.newVersion&&(yield e())});return function(n){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget((0,C.A)(function*(){t.started&&(yield t.mi())})))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>gs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(t=>{t||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(t=>this.isPrimary&&!t?this.bi(e).next(()=>!1):!!t&&this.Di(e).next(()=>!0))).catch(e=>{if(U(e))return F("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return F("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return ni(e).get("owner").next(t=>R.resolve(this.vi(t)))}Ci(e){return gs(e).delete(this.clientId)}Fi(){var e=this;return(0,C.A)(function*(){if(e.isPrimary&&!e.Mi(e.Ei,18e5)){e.Ei=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const i=Ne(n,"clientMetadata");return i.U().next(s=>{const a=e.xi(s,18e5),u=s.filter(c=>-1===a.indexOf(c));return R.forEach(u,c=>i.delete(c.clientId)).next(()=>u)})}).catch(()=>[]);if(e.Vi)for(const n of t)e.Vi.removeItem(e.Oi(n.clientId))}})()}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?R.resolve(!0):ni(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)){if(this.vi(t)&&this.networkEnabled)return!0;if(!this.vi(t)){if(!t.allowTabSynchronization)throw new k(b.FAILED_PRECONDITION,Go);return!1}}return!(!this.networkEnabled||!this.inForeground)||gs(e).U().next(n=>void 0===this.xi(n,5e3).find(i=>!(this.clientId===i.clientId||!(!this.networkEnabled&&i.networkEnabled||!this.inForeground&&i.inForeground&&this.networkEnabled===i.networkEnabled))))}).next(t=>(this.isPrimary!==t&&F("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,C.A)(function*(){e.Kr=!1,e.Li(),e.Ti&&(e.Ti.cancel(),e.Ti=null),e.Bi(),e.ki(),yield e.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const n=new ho(t,De.oe);return e.bi(n).next(()=>e.Ci(n))}),e.Ri.close(),e.qi()})()}xi(e,t){return e.filter(n=>this.Mi(n.updateTimeMs,t)&&!this.Ni(n.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>gs(e).U().next(t=>this.xi(t,18e5).map(n=>n.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,t){return hs.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new wm(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return as.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,t,n){F("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=17===(c=this.hi)?Sf:16===c?Vf:15===c?lo:14===c?ec:13===c?Zu:12===c?Pf:11===c?Xu:void z();var c;let a;return this.Ri.runTransaction(e,i,s,u=>(a=new ho(u,this.Qr?this.Qr.next():De.oe),"readwrite-primary"===t?this.wi(a).next(c=>!!c||this.Si(a)).next(c=>{if(!c)throw Te(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new k(b.FAILED_PRECONDITION,qi);return n(a)}).next(c=>this.Di(a).next(()=>c)):this.Ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return ni(e).get("owner").next(t=>{if(null!==t&&this.Mi(t.leaseTimestampMs,5e3)&&!this.Ni(t.ownerId)&&!this.vi(t)&&!(this.li||this.allowTabSynchronization&&t.allowTabSynchronization))throw new k(b.FAILED_PRECONDITION,Go)})}Di(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ni(e).put("owner",t)}static D(){return O.D()}bi(e){const t=ni(e);return t.get("owner").next(n=>this.vi(n)?(F("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Mi(e,t){const n=Date.now();return!(e<n-t||e>n&&(Te(`Detected an update time that is in the future: ${e} > ${n}`),1))}fi(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground="visible"===this.document.visibilityState)}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Pi=()=>{this.Li();const t=/(?:Version|Mobile)\/1[456]/;(0,re.nr)()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var t;try{const n=null!==(null===(t=this.Vi)||void 0===t?void 0:t.getItem(this.Oi(e)));return F("IndexedDbPersistence",`Client '${e}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return Te("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Te("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ni(r){return Ne(r,"owner")}function gs(r){return Ne(r,"clientMetadata")}function zo(r,e){let t=r.projectId;return r.isDefaultDatabase||(t+="."+r.database),"firestore/"+e+"/"+t+"/"}class jo{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.$i=n,this.Ui=i}static Wi(e,t){let n=X(),i=X();for(const s of t.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new jo(e,t.fromCache,n,i)}}class Um{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Wl{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=(0,re.nr)()?8:m((0,re.ZQ)())>0?6:4}initialize(e,t){this.Ji=e,this.indexManager=t,this.Gi=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.Yi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,t,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new Um;return this.Xi(e,t,a).next(u=>{if(s.result=u,this.zi)return this.es(e,t,a,u.size)})}).next(()=>s.result)}es(e,t,n,i){return n.documentReadCount<this.ji?(Bt()<=Ie.$b.DEBUG&&F("QueryEngine","SDK will not create cache indexes for query:",Wn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),R.resolve()):(Bt()<=Ie.$b.DEBUG&&F("QueryEngine","Query:",Wn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Hi*i?(Bt()<=Ie.$b.DEBUG&&F("QueryEngine","The SDK decides to create cache indexes for query:",Wn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ze(t))):R.resolve())}Yi(e,t){if(Vc(t))return R.resolve(null);let n=ze(t);return this.indexManager.getIndexType(e,n).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Zi(t,null,"F"),n=ze(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next(s=>{const a=X(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,n).next(c=>{const h=this.ts(t,u);return this.ns(t,h,a,c.readTime)?this.Yi(e,Zi(t,null,"F")):this.rs(e,h,t,c)}))})))}Zi(e,t,n,i){return Vc(t)||i.isEqual($.min())?R.resolve(null):this.Ji.getDocuments(e,n).next(s=>{const a=this.ts(t,s);return this.ns(t,a,n,i)?R.resolve(null):(Bt()<=Ie.$b.DEBUG&&F("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Wn(t)),this.rs(e,a,t,xr(i,-1)).next(u=>u))})}ts(e,t){let n=new he(Dc(e));return t.forEach((i,s)=>{Ur(e,s)&&(n=n.add(s))}),n}ns(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,t,n){return Bt()<=Ie.$b.DEBUG&&F("QueryEngine","Using full collection scan to execute query:",Wn(t)),this.Ji.getDocumentsMatchingQuery(e,t,Ye.min(),n)}rs(e,t,n,i){return this.Ji.getDocumentsMatchingQuery(e,n,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class Gm{constructor(e,t,n,i){this.persistence=e,this.ss=t,this.serializer=i,this.os=new pe(J),this._s=new bt(s=>In(s),Br),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(n)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ql(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.os))}}function Hl(r,e,t,n){return new Gm(r,e,t,n)}function Jl(r,e){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,C.A)(function*(r,e){const t=q(r);return yield t.persistence.runTransaction("Handle user change","readonly",n=>{let i;return t.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,t.ls(e),t.mutationQueue.getAllMutationBatches(n))).next(s=>{const a=[],u=[];let c=X();for(const h of i){a.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}for(const h of s){u.push(h.batchId);for(const f of h.mutations)c=c.add(f.key)}return t.localDocuments.getDocuments(n,c).next(h=>({hs:h,removedBatchIds:a,addedBatchIds:u}))})})})).apply(this,arguments)}function Yl(r){const e=q(r);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ur.getLastRemoteSnapshotVersion(t))}function Xl(r,e,t){let n=X(),i=X();return t.forEach(s=>n=n.add(s)),e.getEntries(r,n).next(s=>{let a=nt();return t.forEach((u,c)=>{const h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual($.min())?(e.removeEntry(u,c.readTime),a=a.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||0===c.version.compareTo(h.version)&&h.hasPendingWrites?(e.addEntry(c),a=a.insert(u,c)):F("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ps:a,Is:i}})}function jm(r,e){const t=q(r);return t.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(n,e)))}function sr(r,e){const t=q(r);return t.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return t.Ur.getTargetData(n,e).next(s=>s?(i=s,R.resolve(i)):t.Ur.allocateTargetId(n).next(a=>(i=new Ct(e,a,"TargetPurposeListen",n.currentSequenceNumber),t.Ur.addTargetData(n,i).next(()=>i))))}).then(n=>{const i=t.os.get(n.targetId);return(null===i||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.os=t.os.insert(n.targetId,n),t._s.set(e,n.targetId)),n})}function or(r,e,t){return $o.apply(this,arguments)}function $o(){return($o=(0,C.A)(function*(r,e,t){const n=q(r),i=n.os.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!U(a))throw a;F("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}n.os=n.os.remove(e),n._s.delete(i.target)})).apply(this,arguments)}function ps(r,e,t){const n=q(r);let i=$.min(),s=X();return n.persistence.runTransaction("Execute query","readwrite",a=>function(c,h,f){const p=q(c),y=p._s.get(f);return void 0!==y?R.resolve(p.os.get(y)):p.Ur.getTargetData(h,f)}(n,a,ze(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Ur.getMatchingKeysForTargetId(a,u.targetId).next(c=>{s=c})}).next(()=>n.ss.getDocumentsMatchingQuery(a,e,t?i:$.min(),t?s:X())).next(u=>(th(n,Cc(e),u),{documents:u,Ts:s})))}function Zl(r,e){const t=q(r),n=q(t.Ur),i=t.os.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,e).next(a=>a?a.target:null))}function eh(r,e){const t=q(r),n=t.us.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.cs.getAllFromCollectionGroup(i,e,xr(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(th(t,e,i),i))}function th(r,e,t){let n=r.us.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.us.set(e,n)}function Wo(){return(Wo=(0,C.A)(function*(r,e,t,n){const i=q(r);let s=X(),a=nt();for(const h of t){const f=e.Es(h.metadata.name);h.document&&(s=s.add(f));const p=e.ds(h);p.setReadTime(e.As(h.metadata.readTime)),a=a.insert(f,p)}const u=i.cs.newChangeBuffer({trackRemovals:!0}),c=yield sr(i,(f=n,ze(Qn(te.fromString(`__bundle__/docs/${f}`)))));var f;return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Xl(h,u,a).next(f=>(u.apply(h),f)).next(f=>i.Ur.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.Ur.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ps,f.Is)).next(()=>f.Ps)))})).apply(this,arguments)}function $m(r,e){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,C.A)(function*(r,e,t=X()){const n=yield sr(r,ze(No(e.bundledQuery))),i=q(r);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=be(e.readTime);if(n.snapshotVersion.compareTo(a)>=0)return i.Gr.saveNamedQuery(s,e);const u=n.withResumeToken(we.EMPTY_BYTE_STRING,a);return i.os=i.os.insert(u.targetId,u),i.Ur.updateTargetData(s,u).next(()=>i.Ur.removeMatchingKeysForTargetId(s,n.targetId)).next(()=>i.Ur.addMatchingKeys(s,t,n.targetId)).next(()=>i.Gr.saveNamedQuery(s,e))})})).apply(this,arguments)}function nh(r,e){return`firestore_clients_${r}_${e}`}function rh(r,e,t){let n=`firestore_mutations_${r}_${t}`;return e.isAuthenticated()&&(n+=`_${e.uid}`),n}function Jo(r,e){return`firestore_targets_${r}_${e}`}class _s{constructor(e,t,n,i){this.user=e,this.batchId=t,this.state=n,this.error=i}static Rs(e,t,n){const i=JSON.parse(n);let s,a="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&(a="string"==typeof i.error.message&&"string"==typeof i.error.code,a&&(s=new k(i.error.code,i.error.message))),a?new _s(e,t,i.state,s):(Te("SharedClientState",`Failed to parse mutation state for ID '${t}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ri{constructor(e,t,n){this.targetId=e,this.state=t,this.error=n}static Rs(e,t){const n=JSON.parse(t);let i,s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return s&&n.error&&(s="string"==typeof n.error.message&&"string"==typeof n.error.code,s&&(i=new k(n.error.code,n.error.message))),s?new ri(e,n.state,i):(Te("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ys{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Rs(e,t){const n=JSON.parse(t);let i="object"==typeof n&&n.activeTargetIds instanceof Array,s=Eo();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=Gi(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new ys(e,s):(Te("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Yo{constructor(e,t){this.clientId=e,this.onlineState=t}static Rs(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Yo(t.clientId,t.onlineState):(Te("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Xo{constructor(){this.activeTargetIds=Eo()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Zo{constructor(e,t,n,i,s){this.window=e,this.ui=t,this.persistenceKey=n,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new pe(J),this.started=!1,this.bs=[];const a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=nh(this.persistenceKey,this.ps),this.vs=`firestore_sequence_number_${this.persistenceKey}`,this.Ss=this.Ss.insert(this.ps,new Xo),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=`firestore_online_state_${this.persistenceKey}`,this.Os=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,C.A)(function*(){const t=yield e.syncEngine.Qi();for(const i of t){if(i===e.ps)continue;const s=e.getItem(nh(e.persistenceKey,i));if(s){const a=ys.Rs(i,s);a&&(e.Ss=e.Ss.insert(a.clientId,a))}}e.Ns();const n=e.storage.getItem(e.xs);if(n){const i=e.Ls(n);i&&e.Bs(i)}for(const i of e.bs)e.ws(i);e.bs=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let t=!1;return this.Ss.forEach((n,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,t,n){this.qs(e,t,n),this.Qs(e)}addLocalQueryTarget(e,t=!0){let n="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(Jo(this.persistenceKey,e));if(i){const s=ri.Rs(e,i);s&&(n=s.state)}}return t&&this.Ks.fs(e),this.Ns(),n}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Jo(this.persistenceKey,e))}updateQueryState(e,t,n){this.$s(e,t,n)}handleUserChange(e,t,n){t.forEach(i=>{this.Qs(i)}),this.currentUser=e,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return F("SharedClientState","READ",e,t),t}setItem(e,t){F("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){F("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){var t=this;const n=e;if(n.storageArea===this.storage){if(F("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void Te("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable((0,C.A)(function*(){if(t.started){if(null!==n.key)if(t.Cs.test(n.key)){if(null==n.newValue){const i=t.Gs(n.key);return t.zs(i,null)}{const i=t.js(n.key,n.newValue);if(i)return t.zs(i.clientId,i)}}else if(t.Fs.test(n.key)){if(null!==n.newValue){const i=t.Hs(n.key,n.newValue);if(i)return t.Js(i)}}else if(t.Ms.test(n.key)){if(null!==n.newValue){const i=t.Ys(n.key,n.newValue);if(i)return t.Zs(i)}}else if(n.key===t.xs){if(null!==n.newValue){const i=t.Ls(n.newValue);if(i)return t.Bs(i)}}else if(n.key===t.vs){const i=function(a){let u=De.oe;if(null!=a)try{const c=JSON.parse(a);j("number"==typeof c),u=c}catch(c){Te("SharedClientState","Failed to read sequence number from WebStorage",c)}return u}(n.newValue);i!==De.oe&&t.sequenceNumberHandler(i)}else if(n.key===t.Os){const i=t.Xs(n.newValue);yield Promise.all(i.map(s=>t.syncEngine.eo(s)))}}else t.bs.push(n)}))}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,t,n){const i=new _s(this.currentUser,e,t,n),s=rh(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const t=rh(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Us(e){this.storage.setItem(this.xs,JSON.stringify({clientId:this.ps,onlineState:e}))}$s(e,t,n){const i=Jo(this.persistenceKey,e),s=new ri(e,t,n);this.setItem(i,s.Vs())}Ws(e){const t=JSON.stringify(Array.from(e));this.setItem(this.Os,t)}Gs(e){const t=this.Cs.exec(e);return t?t[1]:null}js(e,t){const n=this.Gs(e);return ys.Rs(n,t)}Hs(e,t){const n=this.Fs.exec(e),i=Number(n[1]);return _s.Rs(new Ve(void 0!==n[2]?n[2]:null),i,t)}Ys(e,t){const n=this.Ms.exec(e),i=Number(n[1]);return ri.Rs(i,t)}Ls(e){return Yo.Rs(e)}Xs(e){return JSON.parse(e)}Js(e){var t=this;return(0,C.A)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.no(e.batchId,e.state,e.error);F("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,t){const n=t?this.Ss.insert(e,t):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(n),a=[],u=[];return s.forEach(c=>{i.has(c)||a.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.io(a,u).then(()=>{this.Ss=n})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let t=Eo();return e.forEach((n,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class ih{constructor(){this.so=new Xo,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,t,n){this.oo[e]=t}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new Xo,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Wm{_o(e){}shutdown(){}}class sh{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){F("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){F("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Is=null;function ea(){return null===Is?Is=268435456+Math.round(2147483648*Math.random()):Is++,"0x"+Is.toString(16)}const Hm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Jm{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}const Qe="WebChannelConnection";class Ym extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const n=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=n+"://"+t.host,this.vo=`projects/${i}/databases/${s}`,this.Co="(default)"===this.databaseId.database?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(t,n,i,s,a){const u=ea(),c=this.xo(t,n.toUriEncodedString());F("RestConnection",`Sending RPC '${t}' ${u}:`,c,i);const h={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(h,s,a),this.No(t,c,h,i).then(f=>(F("RestConnection",`Received RPC '${t}' ${u}: `,f),f),f=>{throw Ce("RestConnection",`RPC '${t}' ${u} failed with error: `,f,"url: ",c,"request:",i),f})}Lo(t,n,i,s,a,u){return this.Mo(t,n,i,s,a)}Oo(t,n,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+Lt,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}xo(t,n){return`${this.Do}/v1/${n}:${Hm[t]}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,t,n,i){const s=ea();return new Promise((a,u)=>{const c=new ki;c.setWithCredentials(!0),c.listenOnce(it.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ot.NO_ERROR:const f=c.getResponseJson();F(Qe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(f)),a(f);break;case Ot.TIMEOUT:F(Qe,`RPC '${e}' ${s} timed out`),u(new k(b.DEADLINE_EXCEEDED,"Request time out"));break;case Ot.HTTP_ERROR:const p=c.getStatus();if(F(Qe,`RPC '${e}' ${s} failed with status:`,p,"response text:",c.getResponseText()),p>0){let y=c.getResponseJson();Array.isArray(y)&&(y=y[0]);const V=null==y?void 0:y.error;if(V&&V.status&&V.message){const N=function(M){const Q=M.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(Q)>=0?Q:b.UNKNOWN}(V.status);u(new k(N,V.message))}else u(new k(b.UNKNOWN,"Server responded with status "+c.getStatus()))}else u(new k(b.UNAVAILABLE,"Connection failed."));break;default:z()}}finally{F(Qe,`RPC '${e}' ${s} completed.`)}});const h=JSON.stringify(i);F(Qe,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",h,n,15)})}Bo(e,t,n){const i=ea(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Fi(),u=io(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.Oo(c.initMessageHeaders,t,n),c.encodeInitMessageHeaders=!0;const f=s.join("");F(Qe,`Creating RPC '${e}' stream ${i}: ${f}`,c);const p=a.createWebChannel(f,c);let y=!1,V=!1;const N=new Jm({Io:M=>{V?F(Qe,`Not sending because RPC '${e}' stream ${i} is closed:`,M):(y||(F(Qe,`Opening RPC '${e}' stream ${i} transport.`),p.open(),y=!0),F(Qe,`RPC '${e}' stream ${i} sending:`,M),p.send(M))},To:()=>p.close()}),L=(M,Q,H)=>{M.listen(Q,W=>{try{H(W)}catch(Y){setTimeout(()=>{throw Y},0)}})};return L(p,vt.EventType.OPEN,()=>{V||(F(Qe,`RPC '${e}' stream ${i} transport opened.`),N.yo())}),L(p,vt.EventType.CLOSE,()=>{V||(V=!0,F(Qe,`RPC '${e}' stream ${i} transport closed`),N.So())}),L(p,vt.EventType.ERROR,M=>{V||(V=!0,Ce(Qe,`RPC '${e}' stream ${i} transport errored:`,M),N.So(new k(b.UNAVAILABLE,"The operation could not be completed")))}),L(p,vt.EventType.MESSAGE,M=>{var Q;if(!V){const H=M.data[0];j(!!H);const Y=H.error||(null===(Q=H[0])||void 0===Q?void 0:Q.error);if(Y){F(Qe,`RPC '${e}' stream ${i} received error:`,Y);const oe=Y.status;let Z=function(E){const A=xe[E];if(void 0!==A)return Jc(A)}(oe),v=Y.message;void 0===Z&&(Z=b.INTERNAL,v="Unknown error status: "+oe+" with message "+Y.message),V=!0,N.So(new k(Z,v)),p.close()}else F(Qe,`RPC '${e}' stream ${i} received:`,H),N.bo(H)}}),L(u,Pr.STAT_EVENT,M=>{M.stat===Rr.PROXY?F(Qe,`RPC '${e}' stream ${i} detected buffering proxy`):M.stat===Rr.NOPROXY&&F(Qe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.wo()},0),N}}function oh(){return typeof window<"u"?window:null}function Ts(){return typeof document<"u"?document:null}function ii(r){return new sm(r,!0)}class ta{constructor(e,t,n=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=t,this.ko=n,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const t=Math.floor(this.Ko+this.zo()),n=Math.max(0,Date.now()-this.Uo),i=Math.max(0,t-n);i>0&&F("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){null!==this.$o&&(this.$o.skipDelay(),this.$o=null)}cancel(){null!==this.$o&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}class ah{constructor(e,t,n,i,s,a,u,c){this.ui=e,this.Ho=n,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new ta(e,t)}n_(){return 1===this.state||5===this.state||this.r_()}r_(){return 2===this.state||3===this.state}start(){this.e_=0,4!==this.state?this.auth():this.i_()}stop(){var e=this;return(0,C.A)(function*(){e.n_()&&(yield e.close(0))})()}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&null===this.Zo&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}__(){var e=this;return(0,C.A)(function*(){if(e.r_())return e.close(0)})()}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}close(e,t){var n=this;return(0,C.A)(function*(){n.u_(),n.c_(),n.t_.cancel(),n.Yo++,4!==e?n.t_.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(Te(t.toString()),Te("Using maximum backoff delay to prevent overloading the backend."),n.t_.Wo()):t&&t.code===b.UNAUTHENTICATED&&3!==n.state&&(n.authCredentialsProvider.invalidateToken(),n.appCheckCredentialsProvider.invalidateToken()),null!==n.stream&&(n.l_(),n.stream.close(),n.stream=null),n.state=e,yield n.listener.mo(t)})()}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),t=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.Yo===t&&this.P_(n,i)},n=>{e(()=>{const i=new k(b.UNKNOWN,"Fetching auth token failed: "+n.message);return this.I_(i)})})}P_(e,t){const n=this.h_(this.Yo);this.stream=this.T_(e,t),this.stream.Eo(()=>{n(()=>this.listener.Eo())}),this.stream.Ro(()=>{n(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{n(()=>this.I_(i))}),this.stream.onMessage(i=>{n(()=>1==++this.e_?this.E_(i):this.onNext(i))})}i_(){var e=this;this.state=5,this.t_.Go((0,C.A)(function*(){e.state=0,e.start()}))}I_(e){return F("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return t=>{this.ui.enqueueAndForget(()=>this.Yo===e?t():(F("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Xm extends ah{constructor(e,t,n,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}T_(e,t){return this.connection.Bo("Listen",e,t)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const t=function um(r,e){let t;if("targetChange"in e){const n="NO_CHANGE"===(h=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===h?1:"REMOVE"===h?2:"CURRENT"===h?3:"RESET"===h?4:z(),i=e.targetChange.targetIds||[],s=function(h,f){return h.useProto3Json?(j(void 0===f||"string"==typeof f),we.fromBase64String(f||"")):(j(void 0===f||f instanceof Buffer||f instanceof Uint8Array),we.fromUint8Array(f||new Uint8Array))}(r,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(h){const f=void 0===h.code?b.UNKNOWN:Jc(h.code);return new k(f,h.message||"")}(a);t=new tl(n,i,s,u||null)}else if("documentChange"in e){const n=e.documentChange,i=It(r,n.document.name),s=be(n.document.updateTime),a=n.document.createTime?be(n.document.createTime):$.min(),u=new Ue({mapValue:{fields:n.document.fields}}),c=_e.newFoundDocument(i,s,a,u);t=new is(n.targetIds||[],n.removedTargetIds||[],c.key,c)}else if("documentDelete"in e){const n=e.documentDelete,i=It(r,n.document),s=n.readTime?be(n.readTime):$.min(),a=_e.newNoDocument(i,s);t=new is([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in e){const n=e.documentRemove,i=It(r,n.document);t=new is([],n.removedTargetIds||[],i,null)}else{if(!("filter"in e))return z();{const n=e.filter,{count:i=0,unchangedNames:s}=n,a=new Zf(i,s);t=new el(n.targetId,a)}}var h;return t}(this.serializer,e),n=function(s){if(!("targetChange"in s))return $.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?$.min():a.readTime?be(a.readTime):$.min()}(e);return this.listener.d_(t,n)}A_(e){const t={};t.database=Co(this.serializer),t.addTarget=function(s,a){let u;const c=a.target;if(u=Yi(c)?{documents:dl(s,c)}:{query:ss(s,c)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=sl(s,a.resumeToken);const h=So(s,a.expectedCount);null!==h&&(u.expectedCount=h)}else if(a.snapshotVersion.compareTo($.min())>0){u.readTime=Zn(s,a.snapshotVersion.toTimestamp());const h=So(s,a.expectedCount);null!==h&&(u.expectedCount=h)}return u}(this.serializer,e);const n=function lm(r,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return z()}}(e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);n&&(t.labels=n),this.a_(t)}R_(e){const t={};t.database=Co(this.serializer),t.removeTarget=e,this.a_(t)}}class Zm extends ah{constructor(e,t,n,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,t){return this.connection.Bo("Write",e,t)}E_(e){return j(!!e.streamToken),this.lastStreamToken=e.streamToken,j(!e.writeResults||0===e.writeResults.length),this.listener.f_()}onNext(e){j(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const t=function cm(r,e){return r&&r.length>0?(j(void 0!==e),r.map(t=>function(i,s){let a=be(i.updateTime?i.updateTime:s);return a.isEqual($.min())&&(a=be(s)),new Jf(a,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),n=be(e.commitTime);return this.listener.g_(n,t)}p_(){const e={};e.database=Co(this.serializer),this.a_(e)}m_(e){const t={streamToken:this.lastStreamToken,writes:e.map(n=>Jr(this.serializer,n))};this.a_(t)}}class eg extends class{}{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new k(b.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,t,n,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,xo(t,n),i,s,a)).catch(s=>{throw"FirebaseError"===s.name?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(b.UNKNOWN,s.toString())})}Lo(e,t,n,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,xo(t,n),i,a,u,s)).catch(a=>{throw"FirebaseError"===a.name?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new k(b.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class tg{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){0===this.S_&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){"Online"===this.state?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,"Online"===e&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Te(t),this.D_=!1):F("OnlineStateTracker",t)}x_(){null!==this.b_&&(this.b_.cancel(),this.b_=null)}}class ng{constructor(e,t,n,i,s){var a=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(u=>{n.enqueueAndForget((0,C.A)(function*(){var c;Xt(a)&&(F("RemoteStore","Restarting streams for network reachability change."),yield(c=(0,C.A)(function*(f){const p=q(f);p.L_.add(4),yield ar(p),p.q_.set("Unknown"),p.L_.delete(4),yield si(p)}),function h(f){return c.apply(this,arguments)})(a))}))}),this.q_=new tg(n,i)}}function si(r){return na.apply(this,arguments)}function na(){return(na=(0,C.A)(function*(r){if(Xt(r))for(const e of r.B_)yield e(!0)})).apply(this,arguments)}function ar(r){return ra.apply(this,arguments)}function ra(){return(ra=(0,C.A)(function*(r){for(const e of r.B_)yield e(!1)})).apply(this,arguments)}function Es(r,e){const t=q(r);t.N_.has(e.targetId)||(t.N_.set(e.targetId,e),oa(t)?sa(t):lr(t).r_()&&ia(t,e))}function ur(r,e){const t=q(r),n=lr(t);t.N_.delete(e),n.r_()&&uh(t,e),0===t.N_.size&&(n.r_()?n.o_():Xt(t)&&t.q_.set("Unknown"))}function ia(r,e){if(r.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo($.min())>0){const t=r.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}lr(r).A_(e)}function uh(r,e){r.Q_.xe(e),lr(r).R_(e)}function sa(r){r.Q_=new tm({getRemoteKeysForTarget:e=>r.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>r.N_.get(e)||null,tt:()=>r.datastore.serializer.databaseId}),lr(r).start(),r.q_.v_()}function oa(r){return Xt(r)&&!lr(r).n_()&&r.N_.size>0}function Xt(r){return 0===q(r).L_.size}function ch(r){r.Q_=void 0}function rg(r){return aa.apply(this,arguments)}function aa(){return(aa=(0,C.A)(function*(r){r.q_.set("Online")})).apply(this,arguments)}function ig(r){return ua.apply(this,arguments)}function ua(){return(ua=(0,C.A)(function*(r){r.N_.forEach((e,t)=>{ia(r,e)})})).apply(this,arguments)}function sg(r,e){return ca.apply(this,arguments)}function ca(){return(ca=(0,C.A)(function*(r,e){ch(r),oa(r)?(r.q_.M_(e),sa(r)):r.q_.set("Unknown")})).apply(this,arguments)}function og(r,e,t){return la.apply(this,arguments)}function la(){return la=(0,C.A)(function*(r,e,t){if(r.q_.set("Online"),e instanceof tl&&2===e.state&&e.cause)try{yield(n=(0,C.A)(function*(s,a){const u=a.cause;for(const c of a.targetIds)s.N_.has(c)&&(yield s.remoteSyncer.rejectListen(c,u),s.N_.delete(c),s.Q_.removeTarget(c))}),function i(s,a){return n.apply(this,arguments)})(r,e)}catch(n){F("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),yield vs(r,n)}else if(e instanceof is?r.Q_.Ke(e):e instanceof el?r.Q_.He(e):r.Q_.We(e),!t.isEqual($.min()))try{const n=yield Yl(r.localStore);t.compareTo(n)>=0&&(yield function(s,a){const u=s.Q_.rt(a);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){const f=s.N_.get(h);f&&s.N_.set(h,f.withResumeToken(c.resumeToken,a))}}),u.targetMismatches.forEach((c,h)=>{const f=s.N_.get(c);if(!f)return;s.N_.set(c,f.withResumeToken(we.EMPTY_BYTE_STRING,f.snapshotVersion)),uh(s,c);const p=new Ct(f.target,c,h,f.sequenceNumber);ia(s,p)}),s.remoteSyncer.applyRemoteEvent(u)}(r,t))}catch(n){F("RemoteStore","Failed to raise snapshot:",n),yield vs(r,n)}var n}),la.apply(this,arguments)}function vs(r,e,t){return ha.apply(this,arguments)}function ha(){return(ha=(0,C.A)(function*(r,e,t){if(!U(e))throw e;r.L_.add(1),yield ar(r),r.q_.set("Offline"),t||(t=()=>Yl(r.localStore)),r.asyncQueue.enqueueRetryable((0,C.A)(function*(){F("RemoteStore","Retrying IndexedDB access"),yield t(),r.L_.delete(1),yield si(r)}))})).apply(this,arguments)}function lh(r,e){return e().catch(t=>vs(r,t,e))}function cr(r){return da.apply(this,arguments)}function da(){return(da=(0,C.A)(function*(r){const e=q(r),t=Zt(e);let n=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;ag(e);)try{const i=yield jm(e.localStore,n);if(null===i){0===e.O_.length&&t.o_();break}n=i.batchId,ug(e,i)}catch(i){yield vs(e,i)}hh(e)&&dh(e)})).apply(this,arguments)}function ag(r){return Xt(r)&&r.O_.length<10}function ug(r,e){r.O_.push(e);const t=Zt(r);t.r_()&&t.V_&&t.m_(e.mutations)}function hh(r){return Xt(r)&&!Zt(r).n_()&&r.O_.length>0}function dh(r){Zt(r).start()}function cg(r){return fa.apply(this,arguments)}function fa(){return(fa=(0,C.A)(function*(r){Zt(r).p_()})).apply(this,arguments)}function lg(r){return ma.apply(this,arguments)}function ma(){return(ma=(0,C.A)(function*(r){const e=Zt(r);for(const t of r.O_)e.m_(t.mutations)})).apply(this,arguments)}function hg(r,e,t){return ga.apply(this,arguments)}function ga(){return(ga=(0,C.A)(function*(r,e,t){const n=r.O_.shift(),i=Ro.from(n,e,t);yield lh(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield cr(r)})).apply(this,arguments)}function dg(r,e){return pa.apply(this,arguments)}function pa(){return pa=(0,C.A)(function*(r,e){var t;e&&Zt(r).V_&&(yield(t=(0,C.A)(function*(i,s){if(Hc(u=s.code)&&u!==b.ABORTED){const a=i.O_.shift();Zt(i).s_(),yield lh(i,()=>i.remoteSyncer.rejectFailedWrite(a.batchId,s)),yield cr(i)}var u}),function n(i,s){return t.apply(this,arguments)})(r,e)),hh(r)&&dh(r)}),pa.apply(this,arguments)}function fh(r,e){return _a.apply(this,arguments)}function _a(){return(_a=(0,C.A)(function*(r,e){const t=q(r);t.asyncQueue.verifyOperationInProgress(),F("RemoteStore","RemoteStore received new credentials");const n=Xt(t);t.L_.add(3),yield ar(t),n&&t.q_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.L_.delete(3),yield si(t)})).apply(this,arguments)}function ya(r,e){return Ia.apply(this,arguments)}function Ia(){return(Ia=(0,C.A)(function*(r,e){const t=q(r);e?(t.L_.delete(2),yield si(t)):e||(t.L_.add(2),yield ar(t),t.q_.set("Unknown"))})).apply(this,arguments)}function lr(r){return r.K_||(r.K_=function(t,n,i){const s=q(t);return s.w_(),new Xm(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:rg.bind(null,r),Ro:ig.bind(null,r),mo:sg.bind(null,r),d_:og.bind(null,r)}),r.B_.push(function(){var e=(0,C.A)(function*(t){t?(r.K_.s_(),oa(r)?sa(r):r.q_.set("Unknown")):(yield r.K_.stop(),ch(r))});return function(t){return e.apply(this,arguments)}}())),r.K_}function Zt(r){return r.U_||(r.U_=function(t,n,i){const s=q(t);return s.w_(),new Zm(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Eo:()=>Promise.resolve(),Ro:cg.bind(null,r),mo:dg.bind(null,r),f_:lg.bind(null,r),g_:hg.bind(null,r)}),r.B_.push(function(){var e=(0,C.A)(function*(t){t?(r.U_.s_(),yield cr(r)):(yield r.U_.stop(),r.O_.length>0&&(F("RemoteStore",`Stopping write stream with ${r.O_.length} pending writes`),r.O_=[]))});return function(t){return e.apply(this,arguments)}}())),r.U_}class Ta{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new Se,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const a=Date.now()+n,u=new Ta(e,t,a,i,s);return u.start(n),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new k(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hr(r,e){if(Te("AsyncQueue",`${e}: ${r}`),U(r))return new k(b.UNAVAILABLE,`${e}: ${r}`);throw r}class dr{constructor(e){this.comparator=e?(t,n)=>e(t,n)||G.comparator(t.key,n.key):(t,n)=>G.comparator(t.key,n.key),this.keyedMap=Gr(),this.sortedSet=new pe(this.comparator)}static emptySet(e){return new dr(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof dr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new dr;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class mh{constructor(){this.W_=new pe(G.comparator)}track(e){const t=e.doc.key,n=this.W_.get(t);n?0!==e.type&&3===n.type?this.W_=this.W_.insert(t,e):3===e.type&&1!==n.type?this.W_=this.W_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.W_=this.W_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.W_=this.W_.remove(t):1===e.type&&2===n.type?this.W_=this.W_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.W_=this.W_.insert(t,{type:2,doc:e.doc}):z():this.W_=this.W_.insert(t,e)}G_(){const e=[];return this.W_.inorderTraversal((t,n)=>{e.push(n)}),e}}class fr{constructor(e,t,n,i,s,a,u,c,h){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(e,t,n,i,s){const a=[];return t.forEach(u=>{a.push({type:0,doc:u})}),new fr(e,t,dr.emptySet(t),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==n[i].type||!t[i].doc.isEqual(n[i].doc))return!1;return!0}}class fg{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class mg{constructor(){this.queries=gh(),this.onlineState="Unknown",this.Y_=new Set}terminate(){!function(t,n){const i=q(t),s=i.queries;i.queries=gh(),s.forEach((a,u)=>{for(const c of u.j_)c.onError(n)})}(this,new k(b.ABORTED,"Firestore shutting down"))}}function gh(){return new bt(r=>xc(r),qr)}function Ea(r,e){return va.apply(this,arguments)}function va(){return(va=(0,C.A)(function*(r,e){const t=q(r);let n=3;const i=e.query;let s=t.queries.get(i);s?!s.H_()&&e.J_()&&(n=2):(s=new fg,n=e.J_()?0:1);try{switch(n){case 0:s.z_=yield t.onListen(i,!0);break;case 1:s.z_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(a){const u=hr(a,`Initialization of query '${Wn(e.query)}' failed`);return void e.onError(u)}t.queries.set(i,s),s.j_.push(e),e.Z_(t.onlineState),s.z_&&e.X_(s.z_)&&Ra(t)})).apply(this,arguments)}function Aa(r,e){return wa.apply(this,arguments)}function wa(){return(wa=(0,C.A)(function*(r,e){const t=q(r),n=e.query;let i=3;const s=t.queries.get(n);if(s){const a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),0===s.j_.length?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return t.queries.delete(n),t.onUnlisten(n,!0);case 1:return t.queries.delete(n),t.onUnlisten(n,!1);case 2:return t.onLastRemoteStoreUnlisten(n);default:return}})).apply(this,arguments)}function gg(r,e){const t=q(r);let n=!1;for(const i of e){const a=t.queries.get(i.query);if(a){for(const u of a.j_)u.X_(i)&&(n=!0);a.z_=i}}n&&Ra(t)}function pg(r,e,t){const n=q(r),i=n.queries.get(e);if(i)for(const s of i.j_)s.onError(t);n.queries.delete(e)}function Ra(r){r.Y_.forEach(e=>{e.next()})}var Pa,ph;(ph=Pa||(Pa={})).ea="default",ph.Cache="cache";class Va{constructor(e,t,n){this.query=e,this.ta=t,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=n||{}}X_(e){if(!this.options.includeMetadataChanges){const n=[];for(const i of e.docChanges)3!==i.type&&n.push(i);e=new fr(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.na?this.ia(e)&&(this.ta.next(e),t=!0):this.sa(e,this.onlineState)&&(this.oa(e),t=!0),this.ra=e,t}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let t=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),t=!0),t}sa(e,t){return!e.fromCache||!this.J_()||(!this.options._a||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}ia(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}oa(e){e=fr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==Pa.Cache}}class _g{constructor(e,t){this.aa=e,this.byteLength=t}ua(){return"metadata"in this.aa}}class _h{constructor(e){this.serializer=e}Es(e){return It(this.serializer,e)}ds(e){return e.metadata.exists?hl(this.serializer,e.document,!1):_e.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return be(e)}}class yg{constructor(e,t,n){this.ca=e,this.localStore=t,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=yh(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++t;const n=te.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ha(e){const t=new Map,n=new _h(this.serializer);for(const i of e)if(i.metadata.queries){const s=n.Es(i.metadata.name);for(const a of i.metadata.queries){const u=(t.get(a)||X()).add(s);t.set(a,u)}}return t}complete(){var e=this;return(0,C.A)(function*(){const t=yield function Qm(r,e,t,n){return Wo.apply(this,arguments)}(e.localStore,new _h(e.serializer),e.documents,e.ca.id),n=e.ha(e.documents);for(const i of e.queries)yield $m(e.localStore,i,n.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Pa:e.collectionGroups,Ia:t}})()}}function yh(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}class Ih{constructor(e){this.key=e}}class Th{constructor(e){this.key=e}}class Eh{constructor(e,t){this.query=e,this.Ta=t,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=X(),this.mutatedKeys=X(),this.Aa=Dc(e),this.Ra=new dr(this.Aa)}get Va(){return this.Ta}ma(e,t){const n=t?t.fa:new mh,i=t?t.Ra:this.Ra;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,u=!1;const c="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,h="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((f,p)=>{const y=i.get(f),V=Ur(this.query,p)?p:null,N=!!y&&this.mutatedKeys.has(y.key),L=!!V&&(V.hasLocalMutations||this.mutatedKeys.has(V.key)&&V.hasCommittedMutations);let M=!1;y&&V?y.data.isEqual(V.data)?N!==L&&(n.track({type:3,doc:V}),M=!0):this.ga(y,V)||(n.track({type:2,doc:V}),M=!0,(c&&this.Aa(V,c)>0||h&&this.Aa(V,h)<0)&&(u=!0)):!y&&V?(n.track({type:0,doc:V}),M=!0):y&&!V&&(n.track({type:1,doc:y}),M=!0,(c||h)&&(u=!0)),M&&(V?(a=a.add(V),s=L?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),null!==this.query.limit)for(;a.size>this.query.limit;){const f="F"===this.query.limitType?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ra:a,fa:n,ns:u,mutatedKeys:s}}ga(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((f,p)=>function(V,N){const L=M=>{switch(M){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return z()}};return L(V)-L(N)}(f.type,p.type)||this.Aa(f.doc,p.doc)),this.pa(n),i=null!=i&&i;const u=t&&!i?this.ya():[],c=0===this.da.size&&this.current&&!i?1:0,h=c!==this.Ea;return this.Ea=c,0!==a.length||h?{snapshot:new fr(this.query,e.Ra,s,a,e.mutatedKeys,0===c,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new mh,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(t=>this.Ta=this.Ta.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Ta=this.Ta.delete(t)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=X(),this.Ra.forEach(n=>{this.Sa(n.key)&&(this.da=this.da.add(n.key))});const t=[];return e.forEach(n=>{this.da.has(n)||t.push(new Th(n))}),this.da.forEach(n=>{e.has(n)||t.push(new Ih(n))}),t}ba(e){this.Ta=e.Ts,this.da=X();const t=this.ma(e.documents);return this.applyChanges(t,!0)}Da(){return fr.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,0===this.Ea,this.hasCachedResults)}}class Ig{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Tg{constructor(e){this.key=e,this.va=!1}}class Eg{constructor(e,t,n,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new bt(u=>xc(u),qr),this.Ma=new Map,this.xa=new Set,this.Oa=new pe(G.comparator),this.Na=new Map,this.La=new qo,this.Ba={},this.ka=new Map,this.qa=Vn.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return!0===this.Qa}}function vg(r,e){return Sa.apply(this,arguments)}function Sa(){return(Sa=(0,C.A)(function*(r,e,t=!0){const n=As(r);let i;const s=n.Fa.get(e);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=yield vh(n,e,t,!0),i})).apply(this,arguments)}function Ag(r,e){return ba.apply(this,arguments)}function ba(){return(ba=(0,C.A)(function*(r,e){const t=As(r);yield vh(t,e,!0,!1)})).apply(this,arguments)}function vh(r,e,t,n){return xa.apply(this,arguments)}function xa(){return(xa=(0,C.A)(function*(r,e,t,n){const i=yield sr(r.localStore,ze(e)),s=i.targetId,a=r.sharedClientState.addLocalQueryTarget(s,t);let u;return n&&(u=yield Ca(r,e,s,"current"===a,i.resumeToken)),r.isPrimaryClient&&t&&Es(r.remoteStore,i),u})).apply(this,arguments)}function Ca(r,e,t,n,i){return Da.apply(this,arguments)}function Da(){return Da=(0,C.A)(function*(r,e,t,n,i){r.Ka=(p,y,V)=>{return(N=(0,C.A)(function*(M,Q,H,W){let Y=Q.view.ma(H);Y.ns&&(Y=yield ps(M.localStore,Q.query,!1).then(({documents:_})=>Q.view.ma(_,Y)));const oe=W&&W.targetChanges.get(Q.targetId),Z=W&&null!=W.targetMismatches.get(Q.targetId),v=Q.view.applyChanges(Y,M.isPrimaryClient,oe,Z);return Ka(M,Q.targetId,v.wa),v.snapshot}),function L(M,Q,H,W){return N.apply(this,arguments)})(r,p,y,V);var N};const s=yield ps(r.localStore,e,!0),a=new Eh(e,s.Ts),u=a.ma(s.documents),c=Wr.createSynthesizedTargetChangeForCurrentChange(t,n&&"Offline"!==r.onlineState,i),h=a.applyChanges(u,r.isPrimaryClient,c);Ka(r,t,h.wa);const f=new Ig(e,t,a);return r.Fa.set(e,f),r.Ma.has(t)?r.Ma.get(t).push(e):r.Ma.set(t,[e]),h.snapshot}),Da.apply(this,arguments)}function wg(r,e,t){return Na.apply(this,arguments)}function Na(){return(Na=(0,C.A)(function*(r,e,t){const n=q(r),i=n.Fa.get(e),s=n.Ma.get(i.targetId);if(s.length>1)return n.Ma.set(i.targetId,s.filter(a=>!qr(a,e))),void n.Fa.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield or(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),t&&ur(n.remoteStore,i.targetId),mr(n,i.targetId)}).catch(pt))):(mr(n,i.targetId),yield or(n.localStore,i.targetId,!0))})).apply(this,arguments)}function Rg(r,e){return ka.apply(this,arguments)}function ka(){return(ka=(0,C.A)(function*(r,e){const t=q(r),n=t.Fa.get(e),i=t.Ma.get(n.targetId);t.isPrimaryClient&&1===i.length&&(t.sharedClientState.removeLocalQueryTarget(n.targetId),ur(t.remoteStore,n.targetId))})).apply(this,arguments)}function Fa(){return(Fa=(0,C.A)(function*(r,e,t){const n=eu(r);try{const i=yield function(a,u){const c=q(a),h=ge.now(),f=u.reduce((V,N)=>V.add(N.key),X());let p,y;return c.persistence.runTransaction("Locally write mutations","readwrite",V=>{let N=nt(),L=X();return c.cs.getEntries(V,f).next(M=>{N=M,N.forEach((Q,H)=>{H.isValidDocument()||(L=L.add(Q))})}).next(()=>c.localDocuments.getOverlayedDocuments(V,N)).next(M=>{p=M;const Q=[];for(const H of u){const W=Xf(H,p.get(H.key).overlayedDocument);null!=W&&Q.push(new xt(H.key,W,mc(W.value.mapValue),ve.exists(!0)))}return c.mutationQueue.addMutationBatch(V,h,Q,u)}).next(M=>{y=M;const Q=M.applyToLocalDocumentSet(p,L);return c.documentOverlayCache.saveOverlays(V,M.batchId,Q)})}).then(()=>({batchId:y.batchId,changes:kc(p)}))}(n.localStore,e);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,c){let h=a.Ba[a.currentUser.toKey()];h||(h=new pe(J)),h=h.insert(u,c),a.Ba[a.currentUser.toKey()]=h}(n,i.batchId,t),yield Dt(n,i.changes),yield cr(n.remoteStore)}catch(i){const s=hr(i,"Failed to persist write");t.reject(s)}})).apply(this,arguments)}function Ah(r,e){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,C.A)(function*(r,e){const t=q(r);try{const n=yield function zm(r,e){const t=q(r),n=e.snapshotVersion;let i=t.os;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.cs.newChangeBuffer({trackRemovals:!0});i=t.os;const u=[];e.targetChanges.forEach((f,p)=>{const y=i.get(p);if(!y)return;u.push(t.Ur.removeMatchingKeys(s,f.removedDocuments,p).next(()=>t.Ur.addMatchingKeys(s,f.addedDocuments,p)));let V=y.withSequenceNumber(s.currentSequenceNumber);var L,M,Q;null!==e.targetMismatches.get(p)?V=V.withResumeToken(we.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):f.resumeToken.approximateByteSize()>0&&(V=V.withResumeToken(f.resumeToken,n)),i=i.insert(p,V),M=V,Q=f,(0===(L=y).resumeToken.approximateByteSize()||M.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=3e8||Q.addedDocuments.size+Q.modifiedDocuments.size+Q.removedDocuments.size>0)&&u.push(t.Ur.updateTargetData(s,V))});let c=nt(),h=X();if(e.documentUpdates.forEach(f=>{e.resolvedLimboDocuments.has(f)&&u.push(t.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Xl(s,a,e.documentUpdates).next(f=>{c=f.Ps,h=f.Is})),!n.isEqual($.min())){const f=t.Ur.getLastRemoteSnapshotVersion(s).next(p=>t.Ur.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return R.waitFor(u).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(t.os=i,s))}(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.Na.get(s);a&&(j(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?j(a.va):i.removedDocuments.size>0&&(j(a.va),a.va=!1))}),yield Dt(t,n,e)}catch(n){yield pt(n)}})).apply(this,arguments)}function wh(r,e,t){const n=q(r);if(n.isPrimaryClient&&0===t||!n.isPrimaryClient&&1===t){const i=[];n.Fa.forEach((s,a)=>{const u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const c=q(a);c.onlineState=u;let h=!1;c.queries.forEach((f,p)=>{for(const y of p.j_)y.Z_(u)&&(h=!0)}),h&&Ra(c)}(n.eventManager,e),i.length&&n.Ca.d_(i),n.onlineState=e,n.isPrimaryClient&&n.sharedClientState.setOnlineState(e)}}function Vg(r,e,t){return Oa.apply(this,arguments)}function Oa(){return(Oa=(0,C.A)(function*(r,e,t){const n=q(r);n.sharedClientState.updateQueryState(e,"rejected",t);const i=n.Na.get(e),s=i&&i.key;if(s){let a=new pe(G.comparator);a=a.insert(s,_e.newNoDocument(s,$.min()));const u=X().add(s),c=new $r($.min(),new Map,new pe(J),a,u);yield Ah(n,c),n.Oa=n.Oa.remove(s),n.Na.delete(e),za(n)}else yield or(n.localStore,e,!1).then(()=>mr(n,e,t)).catch(pt)})).apply(this,arguments)}function Sg(r,e){return La.apply(this,arguments)}function La(){return(La=(0,C.A)(function*(r,e){const t=q(r),n=e.batch.batchId;try{const i=yield function Km(r,e){const t=q(r);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{const i=e.batch.keys(),s=t.cs.newChangeBuffer({trackRemovals:!0});return function(u,c,h,f){const p=h.batch,y=p.keys();let V=R.resolve();return y.forEach(N=>{V=V.next(()=>f.getEntry(c,N)).next(L=>{const M=h.docVersions.get(N);j(null!==M),L.version.compareTo(M)<0&&(p.applyToRemoteDocument(L,h),L.isValidDocument()&&(L.setReadTime(h.commitVersion),f.addEntry(L)))})}),V.next(()=>u.mutationQueue.removeMutationBatch(c,p))}(t,n,e,s).next(()=>s.apply(n)).next(()=>t.mutationQueue.performConsistencyCheck(n)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(n,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let c=X();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c}(e))).next(()=>t.localDocuments.getDocuments(n,i))})}(t.localStore,e);Ga(t,n,null),Ua(t,n),t.sharedClientState.updateMutationState(n,"acknowledged"),yield Dt(t,i)}catch(i){yield pt(i)}})).apply(this,arguments)}function bg(r,e,t){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,C.A)(function*(r,e,t){const n=q(r);try{const i=yield function(a,u){const c=q(a);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(p=>(j(null!==p),f=p.keys(),c.mutationQueue.removeMutationBatch(h,p))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})}(n.localStore,e);Ga(n,e,t),Ua(n,e),n.sharedClientState.updateMutationState(e,"rejected",t),yield Dt(n,i)}catch(i){yield pt(i)}})).apply(this,arguments)}function qa(){return(qa=(0,C.A)(function*(r,e){const t=q(r);Xt(t.remoteStore)||F("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const n=yield function(a){const u=q(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(-1===n)return void e.resolve();const i=t.ka.get(n)||[];i.push(e),t.ka.set(n,i)}catch(n){const i=hr(n,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})).apply(this,arguments)}function Ua(r,e){(r.ka.get(e)||[]).forEach(t=>{t.resolve()}),r.ka.delete(e)}function Ga(r,e,t){const n=q(r);let i=n.Ba[n.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),n.Ba[n.currentUser.toKey()]=i}}function mr(r,e,t=null){r.sharedClientState.removeLocalQueryTarget(e);for(const n of r.Ma.get(e))r.Fa.delete(n),t&&r.Ca.$a(n,t);r.Ma.delete(e),r.isPrimaryClient&&r.La.gr(e).forEach(n=>{r.La.containsKey(n)||Rh(r,n)})}function Rh(r,e){r.xa.delete(e.path.canonicalString());const t=r.Oa.get(e);null!==t&&(ur(r.remoteStore,t),r.Oa=r.Oa.remove(e),r.Na.delete(t),za(r))}function Ka(r,e,t){for(const n of t)n instanceof Ih?(r.La.addReference(n.key,e),Cg(r,n)):n instanceof Th?(F("SyncEngine","Document no longer in limbo: "+n.key),r.La.removeReference(n.key,e),r.La.containsKey(n.key)||Rh(r,n.key)):z()}function Cg(r,e){const t=e.key,n=t.path.canonicalString();r.Oa.get(t)||r.xa.has(n)||(F("SyncEngine","New document in limbo: "+t),r.xa.add(n),za(r))}function za(r){for(;r.xa.size>0&&r.Oa.size<r.maxConcurrentLimboResolutions;){const e=r.xa.values().next().value;r.xa.delete(e);const t=new G(te.fromString(e)),n=r.qa.next();r.Na.set(n,new Tg(t)),r.Oa=r.Oa.insert(t,n),Es(r.remoteStore,new Ct(ze(Qn(t.path)),n,"TargetPurposeLimboResolution",De.oe))}}function Dt(r,e,t){return ja.apply(this,arguments)}function ja(){return ja=(0,C.A)(function*(r,e,t){const n=q(r),i=[],s=[],a=[];var u;n.Fa.isEmpty()||(n.Fa.forEach((u,c)=>{a.push(n.Ka(c,e,t).then(h=>{var f;if((h||t)&&n.isPrimaryClient){const p=h?!h.fromCache:null===(f=null==t?void 0:t.targetChanges.get(c.targetId))||void 0===f?void 0:f.current;n.sharedClientState.updateQueryState(c.targetId,p?"current":"not-current")}if(h){i.push(h);const p=jo.Wi(c.targetId,h);s.push(p)}}))}),yield Promise.all(a),n.Ca.d_(i),yield(u=(0,C.A)(function*(h,f){const p=q(h);try{yield p.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>R.forEach(f,V=>R.forEach(V.$i,N=>p.persistence.referenceDelegate.addReference(y,V.targetId,N)).next(()=>R.forEach(V.Ui,N=>p.persistence.referenceDelegate.removeReference(y,V.targetId,N)))))}catch(y){if(!U(y))throw y;F("LocalStore","Failed to update sequence numbers: "+y)}for(const y of f){const V=y.targetId;if(!y.fromCache){const N=p.os.get(V),M=N.withLastLimboFreeSnapshotVersion(N.snapshotVersion);p.os=p.os.insert(V,M)}}}),function c(h,f){return u.apply(this,arguments)})(n.localStore,s))}),ja.apply(this,arguments)}function Dg(r,e){return Qa.apply(this,arguments)}function Qa(){return(Qa=(0,C.A)(function*(r,e){const t=q(r);if(!t.currentUser.isEqual(e)){F("SyncEngine","User change. New user:",e.toKey());const n=yield Jl(t.localStore,e);t.currentUser=e,(s=t).ka.forEach(u=>{u.forEach(c=>{c.reject(new k(b.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),s.ka.clear(),t.sharedClientState.handleUserChange(e,n.removedBatchIds,n.addedBatchIds),yield Dt(t,n.hs)}var s})).apply(this,arguments)}function Ng(r,e){const t=q(r),n=t.Na.get(e);if(n&&n.va)return X().add(n.key);{let i=X();const s=t.Ma.get(e);if(!s)return i;for(const a of s){const u=t.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}function kg(r,e){return $a.apply(this,arguments)}function $a(){return($a=(0,C.A)(function*(r,e){const t=q(r),n=yield ps(t.localStore,e.query,!0),i=e.view.ba(n);return t.isPrimaryClient&&Ka(t,e.targetId,i.wa),i})).apply(this,arguments)}function Fg(r,e){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,C.A)(function*(r,e){const t=q(r);return eh(t.localStore,e).then(n=>Dt(t,n))})).apply(this,arguments)}function Mg(r,e,t,n){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,C.A)(function*(r,e,t,n){const i=q(r),s=yield function(u,c){const h=q(u),f=q(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",p=>f.Mn(p,c).next(y=>y?h.localDocuments.getDocuments(p,y):R.resolve(null)))}(i.localStore,e);var c;null!==s?("pending"===t?yield cr(i.remoteStore):"acknowledged"===t||"rejected"===t?(Ga(i,e,n||null),Ua(i,e),c=e,q(q(i.localStore).mutationQueue).On(c)):z(),yield Dt(i,s)):F("SyncEngine","Cannot apply mutation batch with id: "+e)})).apply(this,arguments)}function Ja(){return(Ja=(0,C.A)(function*(r,e){const t=q(r);if(As(t),eu(t),!0===e&&!0!==t.Qa){const n=t.sharedClientState.getAllActiveQueryTargets(),i=yield Ph(t,n.toArray());t.Qa=!0,yield ya(t.remoteStore,!0);for(const s of i)Es(t.remoteStore,s)}else if(!1===e&&!1!==t.Qa){const n=[];let i=Promise.resolve();t.Ma.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(mr(t,a),or(t.localStore,a,!0))),ur(t.remoteStore,a)}),yield i,yield Ph(t,n),function(a){const u=q(a);u.Na.forEach((c,h)=>{ur(u.remoteStore,h)}),u.La.pr(),u.Na=new Map,u.Oa=new pe(G.comparator)}(t),t.Qa=!1,yield ya(t.remoteStore,!1)}})).apply(this,arguments)}function Ph(r,e,t){return Ya.apply(this,arguments)}function Ya(){return(Ya=(0,C.A)(function*(r,e,t){const n=q(r),i=[],s=[];for(const a of e){let u;const c=n.Ma.get(a);if(c&&0!==c.length){u=yield sr(n.localStore,ze(c[0]));for(const h of c){const f=n.Fa.get(h),p=yield kg(n,f);p.snapshot&&s.push(p.snapshot)}}else{const h=yield Zl(n.localStore,a);u=yield sr(n.localStore,h),yield Ca(n,Vh(h),a,!1,u.resumeToken)}i.push(u)}return n.Ca.d_(s),i})).apply(this,arguments)}function Vh(r){return Pc(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Lg(r){return t=q(r).localStore,q(q(t).persistence).Qi();var t}function Bg(r,e,t,n){return Xa.apply(this,arguments)}function Xa(){return(Xa=(0,C.A)(function*(r,e,t,n){const i=q(r);if(i.Qa)return void F("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=yield eh(i.localStore,Cc(s[0])),u=$r.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,we.EMPTY_BYTE_STRING);yield Dt(i,a,u);break}case"rejected":yield or(i.localStore,e,!0),mr(i,e,n);break;default:z()}})).apply(this,arguments)}function qg(r,e,t){return Za.apply(this,arguments)}function Za(){return(Za=(0,C.A)(function*(r,e,t){const n=As(r);if(n.Qa){for(const i of e){if(n.Ma.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){F("SyncEngine","Adding an already active target "+i);continue}const s=yield Zl(n.localStore,i),a=yield sr(n.localStore,s);yield Ca(n,Vh(s),a.targetId,!1,a.resumeToken),Es(n.remoteStore,a)}for(const i of t)n.Ma.has(i)&&(yield or(n.localStore,i,!1).then(()=>{ur(n.remoteStore,i),mr(n,i)}).catch(pt))}})).apply(this,arguments)}function As(r){const e=q(r);return e.remoteStore.remoteSyncer.applyRemoteEvent=Ah.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ng.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Vg.bind(null,e),e.Ca.d_=gg.bind(null,e.eventManager),e.Ca.$a=pg.bind(null,e.eventManager),e}function eu(r){const e=q(r);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Sg.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=bg.bind(null,e),e}let gr=(()=>{class r{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(t){var n=this;return(0,C.A)(function*(){n.serializer=ii(t.databaseInfo.databaseId),n.sharedClientState=n.Wa(t),n.persistence=n.Ga(t),yield n.persistence.start(),n.localStore=n.za(t),n.gcScheduler=n.ja(t,n.localStore),n.indexBackfillerScheduler=n.Ha(t,n.localStore)})()}ja(t,n){return null}Ha(t,n){return null}za(t){return Hl(this.persistence,new Wl,t.initialUser,this.serializer)}Ga(t){return new Uo(fs.Zr,this.serializer)}Wa(t){return new ih}terminate(){var t=this;return(0,C.A)(function*(){var n,i;null===(n=t.gcScheduler)||void 0===n||n.stop(),null===(i=t.indexBackfillerScheduler)||void 0===i||i.stop(),t.sharedClientState.shutdown(),yield t.persistence.shutdown()})()}}return r.provider={build:()=>new r},r})();class tu extends gr{constructor(e,t,n){super(),this.Ja=e,this.cacheSizeBytes=t,this.forceOwnership=n,this.kind="persistent",this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,n=this;return(0,C.A)(function*(){yield t().call(n,e),yield n.Ja.initialize(n,e),yield eu(n.Ja.syncEngine),yield cr(n.Ja.remoteStore),yield n.persistence.yi(()=>(n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(),n.indexBackfillerScheduler&&!n.indexBackfillerScheduler.started&&n.indexBackfillerScheduler.start(),Promise.resolve()))})()}za(e){return Hl(this.persistence,new Wl,e.initialUser,this.serializer)}ja(e,t){return new Bl(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ha(e,t){const n=new Un(t,this.persistence);return new mn(e.asyncQueue,n)}Ga(e){const t=zo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?je.withCacheSize(this.cacheSizeBytes):je.DEFAULT;return new Ko(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,oh(),Ts(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new ih}}class Sh extends tu{constructor(e,t){super(e,t,!1),this.Ja=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,n=this;return(0,C.A)(function*(){yield t().call(n,e);const i=n.Ja.syncEngine;n.sharedClientState instanceof Zo&&(n.sharedClientState.syncEngine={no:Mg.bind(null,i),ro:Bg.bind(null,i),io:qg.bind(null,i),Qi:Lg.bind(null,i),eo:Fg.bind(null,i)},yield n.sharedClientState.start()),yield n.persistence.yi(function(){var s=(0,C.A)(function*(a){yield function Og(r,e){return Ja.apply(this,arguments)}(n.Ja.syncEngine,a),n.gcScheduler&&(a&&!n.gcScheduler.started?n.gcScheduler.start():a||n.gcScheduler.stop()),n.indexBackfillerScheduler&&(a&&!n.indexBackfillerScheduler.started?n.indexBackfillerScheduler.start():a||n.indexBackfillerScheduler.stop())});return function(a){return s.apply(this,arguments)}}())})()}Wa(e){const t=oh();if(!Zo.D(t))throw new k(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=zo(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Zo(t,e.asyncQueue,n,e.clientId,e.initialUser)}}let pr=(()=>{class r{initialize(t,n){var i=this;return(0,C.A)(function*(){i.localStore||(i.localStore=t.localStore,i.sharedClientState=t.sharedClientState,i.datastore=i.createDatastore(n),i.remoteStore=i.createRemoteStore(n),i.eventManager=i.createEventManager(n),i.syncEngine=i.createSyncEngine(n,!t.synchronizeTabs),i.sharedClientState.onlineStateHandler=s=>wh(i.syncEngine,s,1),i.remoteStore.remoteSyncer.handleCredentialChange=Dg.bind(null,i.syncEngine),yield ya(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(t){return new mg}createDatastore(t){const n=ii(t.databaseInfo.databaseId),i=new Ym(t.databaseInfo);return new eg(t.authCredentials,t.appCheckCredentials,i,n)}createRemoteStore(t){return i=this.localStore,s=this.datastore,a=t.asyncQueue,u=n=>wh(this.syncEngine,n,0),c=sh.D()?new sh:new Wm,new ng(i,s,a,u,c);var i,s,a,u,c}createSyncEngine(t,n){return function(s,a,u,c,h,f,p){const y=new Eg(s,a,u,c,h,f);return p&&(y.Qa=!0),y}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)}terminate(){var t=this;return(0,C.A)(function*(){var n,i,s;yield(s=(0,C.A)(function*(u){const c=q(u);F("RemoteStore","RemoteStore shutting down."),c.L_.add(5),yield ar(c),c.k_.shutdown(),c.q_.set("Unknown")}),function a(u){return s.apply(this,arguments)})(t.remoteStore),null===(n=t.datastore)||void 0===n||n.terminate(),null===(i=t.eventManager)||void 0===i||i.terminate()})()}}return r.provider={build:()=>new r},r})();function bh(r,e=10240){let t=0;return{read:()=>(0,C.A)(function*(){if(t<r.byteLength){const n={value:r.slice(t,t+e),done:!1};return t+=e,n}return{done:!0}})(),cancel:()=>(0,C.A)(function*(){})(),releaseLock(){},closed:Promise.resolve()}}class ws{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Te("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class Kg{constructor(e,t){this.Xa=e,this.serializer=t,this.metadata=new Se,this.buffer=new Uint8Array,this.eu=new TextDecoder("utf-8"),this.tu().then(n=>{n&&n.ua()?this.metadata.resolve(n.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==n?void 0:n.aa)}`))},n=>this.metadata.reject(n))}close(){return this.Xa.cancel()}getMetadata(){var e=this;return(0,C.A)(function*(){return e.metadata.promise})()}Ua(){var e=this;return(0,C.A)(function*(){return yield e.getMetadata(),e.tu()})()}tu(){var e=this;return(0,C.A)(function*(){const t=yield e.nu();if(null===t)return null;const n=e.eu.decode(t),i=Number(n);isNaN(i)&&e.ru(`length string (${n}) is not valid number`);const s=yield e.iu(i);return new _g(JSON.parse(s),t.length+i)})()}su(){return this.buffer.findIndex(e=>123===e)}nu(){var e=this;return(0,C.A)(function*(){for(;e.su()<0&&!(yield e.ou()););if(0===e.buffer.length)return null;const t=e.su();t<0&&e.ru("Reached the end of bundle when a length string is expected.");const n=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),n})()}iu(e){var t=this;return(0,C.A)(function*(){for(;t.buffer.length<e;)(yield t.ou())&&t.ru("Reached the end of bundle when more is expected.");const n=t.eu.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),n})()}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}ou(){var e=this;return(0,C.A)(function*(){const t=yield e.Xa.read();if(!t.done){const n=new Uint8Array(e.buffer.length+t.value.length);n.set(e.buffer),n.set(t.value,e.buffer.length),e.buffer=n}return t.done})()}}class zg{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,C.A)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw t.lastTransactionError=new k(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),t.lastTransactionError;const n=yield(i=(0,C.A)(function*(a,u){const c=q(a),h={documents:u.map(V=>Hr(c.serializer,V))},f=yield c.Lo("BatchGetDocuments",c.serializer.databaseId,te.emptyPath(),h,u.length),p=new Map;f.forEach(V=>{const N=function am(r,e){return"found"in e?function(n,i){j(!!i.found);const s=It(n,i.found.name),a=be(i.found.updateTime),u=i.found.createTime?be(i.found.createTime):$.min(),c=new Ue({mapValue:{fields:i.found.fields}});return _e.newFoundDocument(s,a,u,c)}(r,e):"missing"in e?function(n,i){j(!!i.missing),j(!!i.readTime);const s=It(n,i.missing),a=be(i.readTime);return _e.newNoDocument(s,a)}(r,e):z()}(c.serializer,V);p.set(N.key.toString(),N)});const y=[];return u.forEach(V=>{const N=p.get(V.toString());j(!!N),y.push(N)}),y}),function s(a,u){return i.apply(this,arguments)})(t.datastore,e);var i;return n.forEach(i=>t.recordVersion(i)),n})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(e.toString())}delete(e){this.write(new Xn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,C.A)(function*(){if(e.ensureCommitNotCalled(),e.lastTransactionError)throw e.lastTransactionError;const t=e.readVersions;var n;e.mutations.forEach(n=>{t.delete(n.key.toString())}),t.forEach((n,i)=>{const s=G.fromPath(i);e.mutations.push(new Ao(s,e.precondition(s)))}),yield(n=(0,C.A)(function*(s,a){const u=q(s),c={writes:a.map(h=>Jr(u.serializer,h))};yield u.Mo("Commit",u.serializer.databaseId,te.emptyPath(),c)}),function i(s,a){return n.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw z();t=$.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new k(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?ve.exists(!1):ve.updateTime(t):ve.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new k(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ve.updateTime(t)}return ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class jg{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this._u=n.maxAttempts,this.t_=new ta(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){var e=this;this.t_.Go((0,C.A)(function*(){const t=new zg(e.datastore),n=e.cu(t);n&&n.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.lu(s)}))}).catch(i=>{e.lu(i)})}))}cu(e){try{const t=this.updateFunction(e);return!gn(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Hc(t)}return!1}}class Qg{constructor(e,t,n,i,s){var a=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=Ve.UNAUTHENTICATED,this.clientId=At.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,function(){var u=(0,C.A)(function*(c){F("FirestoreClient","Received user=",c.uid),yield a.authCredentialListener(c),a.user=c});return function(c){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(n,u=>(F("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Se;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,C.A)(function*(){try{e._onlineComponents&&(yield e._onlineComponents.terminate()),e._offlineComponents&&(yield e._offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(n){const i=hr(n,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function nu(r,e){return ru.apply(this,arguments)}function ru(){return ru=(0,C.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress(),F("FirestoreClient","Initializing OfflineComponentProvider");const t=r.configuration;yield e.initialize(t);let n=t.initialUser;r.setCredentialChangeListener(function(){var i=(0,C.A)(function*(s){n.isEqual(s)||(yield Jl(e.localStore,s),n=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=e}),ru.apply(this,arguments)}function xh(r,e){return iu.apply(this,arguments)}function iu(){return(iu=(0,C.A)(function*(r,e){r.asyncQueue.verifyOperationInProgress();const t=yield su(r);F("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,r.configuration),r.setCredentialChangeListener(n=>fh(e.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>fh(e.remoteStore,i)),r._onlineComponents=e})).apply(this,arguments)}function su(r){return ou.apply(this,arguments)}function ou(){return(ou=(0,C.A)(function*(r){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){F("FirestoreClient","Using user provided OfflineComponentProvider");try{yield nu(r,r._uninitializedComponentsProvider._offline)}catch(e){if(!("FirebaseError"===(i=e).name?i.code===b.FAILED_PRECONDITION||i.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||22===i.code||20===i.code||11===i.code))throw e;Ce("Error using user provided cache. Falling back to memory cache: "+e),yield nu(r,new gr)}}else F("FirestoreClient","Using default OfflineComponentProvider"),yield nu(r,new gr);var i;return r._offlineComponents})).apply(this,arguments)}function Rs(r){return au.apply(this,arguments)}function au(){return(au=(0,C.A)(function*(r){return r._onlineComponents||(r._uninitializedComponentsProvider?(F("FirestoreClient","Using user provided OnlineComponentProvider"),yield xh(r,r._uninitializedComponentsProvider._online)):(F("FirestoreClient","Using default OnlineComponentProvider"),yield xh(r,new pr))),r._onlineComponents})).apply(this,arguments)}function Ch(r){return su(r).then(e=>e.persistence)}function _r(r){return su(r).then(e=>e.localStore)}function Dh(r){return Rs(r).then(e=>e.remoteStore)}function uu(r){return Rs(r).then(e=>e.syncEngine)}function yr(r){return cu.apply(this,arguments)}function cu(){return(cu=(0,C.A)(function*(r){const e=yield Rs(r),t=e.eventManager;return t.onListen=vg.bind(null,e.syncEngine),t.onUnlisten=wg.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=Ag.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=Rg.bind(null,e.syncEngine),t})).apply(this,arguments)}function kh(r,e,t={}){const n=new Se;return r.asyncQueue.enqueueAndForget((0,C.A)(function*(){return function(s,a,u,c,h){const f=new ws({next:y=>{f.Za(),a.enqueueAndForget(()=>Aa(s,p));const V=y.docs.has(u);!V&&y.fromCache?h.reject(new k(b.UNAVAILABLE,"Failed to get document because the client is offline.")):V&&y.fromCache&&c&&"server"===c.source?h.reject(new k(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(y)},error:y=>h.reject(y)}),p=new Va(Qn(u.path),f,{includeMetadataChanges:!0,_a:!0});return Ea(s,p)}(yield yr(r),r.asyncQueue,e,t,n)})),n.promise}function Fh(r,e,t={}){const n=new Se;return r.asyncQueue.enqueueAndForget((0,C.A)(function*(){return function(s,a,u,c,h){const f=new ws({next:y=>{f.Za(),a.enqueueAndForget(()=>Aa(s,p)),y.fromCache&&"server"===c.source?h.reject(new k(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(y)},error:y=>h.reject(y)}),p=new Va(u,f,{includeMetadataChanges:!0,_a:!0});return Ea(s,p)}(yield yr(r),r.asyncQueue,e,t,n)})),n.promise}function Mh(r){const e={};return void 0!==r.timeoutSeconds&&(e.timeoutSeconds=r.timeoutSeconds),e}const Oh=new Map;function lu(r,e,t){if(!t)throw new k(b.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${e}.`)}function Lh(r,e,t,n){if(!0===e&&!0===n)throw new k(b.INVALID_ARGUMENT,`${r} and ${t} cannot be used together.`)}function Bh(r){if(!G.isDocumentKey(r))throw new k(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function qh(r){if(G.isDocumentKey(r))throw new k(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function Ps(r){if(void 0===r)return"undefined";if(null===r)return"null";if("string"==typeof r)return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if("number"==typeof r||"boolean"==typeof r)return""+r;if("object"==typeof r){if(r instanceof Array)return"an array";{const e=(n=r).constructor?n.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var n;return"function"==typeof r?"a function":z()}function ee(r,e){if("_delegate"in r&&(r=r._delegate),!(r instanceof e)){if(e.name===r.constructor.name)throw new k(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Ps(r);throw new k(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return r}function Uh(r,e){if(e<=0)throw new k(b.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${e}.`)}class Gh{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new k(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new k(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Lh("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!(this.experimentalForceLongPolling||void 0!==e.experimentalAutoDetectLongPolling&&!e.experimentalAutoDetectLongPolling),this.experimentalLongPollingOptions=Mh(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(s){if(void 0!==s.timeoutSeconds){if(isNaN(s.timeoutSeconds))throw new k(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new k(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new k(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.experimentalLongPollingOptions.timeoutSeconds===e.experimentalLongPollingOptions.timeoutSeconds&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class oi{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gh({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new k(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gh(e),void 0!==e.credentials&&(this._authCredentials=function(n){if(!n)return new et;switch(n.type){case"firstParty":return new dn(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new k(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){var e=this;return(0,C.A)(function*(){"notTerminated"===e._terminateTask?yield e._terminate():e._terminateTask="notTerminated"})()}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const n=Oh.get(t);n&&(F("ComponentProvider","Removing Datastore"),Oh.delete(t),n.terminate())}(this),Promise.resolve()}}function Kh(r,e,t,n={}){var i;const s=(r=ee(r,oi))._getSettings(),a=`${e}:${t}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&Ce("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,c;if("string"==typeof n.mockUserToken)u=n.mockUserToken,c=Ve.MOCK_USER;else{u=(0,re.Fy)(n.mockUserToken,null===(i=r._app)||void 0===i?void 0:i.options.projectId);const h=n.mockUserToken.sub||n.mockUserToken.user_id;if(!h)throw new k(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new Ve(h)}r._authCredentials=new Oe(new dt(u,c))}}class Ge{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Ge(this.firestore,e,this._query)}}class Re{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Re(this.firestore,e,this._key)}}class Tt extends Ge{constructor(e,t,n){super(e,t,Qn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Re(this.firestore,null,new G(e))}withConverter(e){return new Tt(this.firestore,e,this._path)}}function ip(r,e,...t){if(r=(0,re.Ku)(r),lu("collection","path",e),r instanceof oi){const n=te.fromString(e,...t);return qh(n),new Tt(r,null,n)}{if(!(r instanceof Re||r instanceof Tt))throw new k(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(te.fromString(e,...t));return qh(n),new Tt(r.firestore,null,n)}}function sp(r,e){if(r=ee(r,oi),lu("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(b.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ge(r,null,(n=e,new St(te.emptyPath(),n)));var n}function zh(r,e,...t){if(r=(0,re.Ku)(r),1===arguments.length&&(e=At.newId()),lu("doc","path",e),r instanceof oi){const n=te.fromString(e,...t);return Bh(n),new Re(r,null,new G(n))}{if(!(r instanceof Re||r instanceof Tt))throw new k(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=r._path.child(te.fromString(e,...t));return Bh(n),new Re(r.firestore,r instanceof Tt?r.converter:null,new G(n))}}function op(r,e){return r=(0,re.Ku)(r),e=(0,re.Ku)(e),(r instanceof Re||r instanceof Tt)&&(e instanceof Re||e instanceof Tt)&&r.firestore===e.firestore&&r.path===e.path&&r.converter===e.converter}function hu(r,e){return r=(0,re.Ku)(r),e=(0,re.Ku)(e),r instanceof Ge&&e instanceof Ge&&r.firestore===e.firestore&&qr(r._query,e._query)&&r.converter===e.converter}class jh{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new ta(this,"async_queue_retry"),this.Vu=()=>{const n=Ts();n&&F("AsyncQueue","Visibility state changed to "+n.visibilityState),this.t_.jo()},this.mu=e;const t=Ts();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const t=Ts();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const t=new Se;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}pu(){var e=this;return(0,C.A)(function*(){if(0!==e.Pu.length){try{yield e.Pu[0](),e.Pu.shift(),e.t_.reset()}catch(t){if(!U(t))throw t;F("AsyncQueue","Operation failed with retryable error: "+t)}e.Pu.length>0&&e.t_.Go(()=>e.pu())}})()}gu(e){const t=this.mu.then(()=>(this.du=!0,e().catch(n=>{throw this.Eu=n,this.du=!1,Te("INTERNAL UNHANDLED ERROR: ",function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+"\n"+a.stack),u}(n)),n}).then(n=>(this.du=!1,n))));return this.mu=t,t}enqueueAfterDelay(e,t,n){this.fu(),this.Ru.indexOf(e)>-1&&(t=0);const i=Ta.createAndSchedule(this,e,t,n,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&z()}verifyOperationInProgress(){}wu(){var e=this;return(0,C.A)(function*(){let t;do{t=e.mu,yield t}while(t!==e.mu)})()}Su(e){for(const t of this.Tu)if(t.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((t,n)=>t.targetTimeMs-n.targetTimeMs);for(const t of this.Tu)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const t=this.Tu.indexOf(e);this.Tu.splice(t,1)}}function du(r){return function(t){if("object"!=typeof t||null===t)return!1;const i=t;for(const s of["next","error","complete"])if(s in i&&"function"==typeof i[s])return!0;return!1}(r)}class ap{constructor(){this._progressObserver={},this._taskCompletionResolver=new Se,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,n){this._progressObserver={next:e,error:t,complete:n}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const up=-1;class de extends oi{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new jh,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){var e=this;return(0,C.A)(function*(){if(e._firestoreClient){const t=e._firestoreClient.terminate();e._queue=new jh(t),e._firestoreClient=void 0,yield t}})()}}function cp(r,e){const t="object"==typeof r?r:(0,Mt.getApp)(),n="string"==typeof r?r:e||"(default)",i=(0,Mt._getProvider)(t,"firestore").getImmediate({identifier:n});if(!i._initialized){const s=(0,re.yU)("firestore");s&&Kh(i,...s)}return i}function Ae(r){if(r._terminated)throw new k(b.FAILED_PRECONDITION,"The client has already been terminated.");return r._firestoreClient||Qh(r),r._firestoreClient}function Qh(r){var e,t,n;const i=r._freezeSettings(),s=(c=(null===(e=r._app)||void 0===e?void 0:e.options.appId)||"",new Cf(r._databaseId,c,r._persistenceKey,(f=i).host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Mh(f.experimentalLongPollingOptions),f.useFetchStreams));var c,f;r._componentsProvider||!(null===(t=i.localCache)||void 0===t)&&t._offlineComponentProvider&&!(null===(n=i.localCache)||void 0===n)&&n._onlineComponentProvider&&(r._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),r._firestoreClient=new Qg(r._authCredentials,r._appCheckCredentials,r._queue,s,r._componentsProvider&&function(u){const c=null==u?void 0:u._online.build();return{_offline:null==u?void 0:u._offline.build(c),_online:c}}(r._componentsProvider))}function lp(r,e){Ce("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=r._freezeSettings();return $h(r,pr.provider,{build:n=>new tu(n,t.cacheSizeBytes,null==e?void 0:e.forceOwnership)}),Promise.resolve()}function hp(r){return fu.apply(this,arguments)}function fu(){return(fu=(0,C.A)(function*(r){Ce("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=r._freezeSettings();$h(r,pr.provider,{build:t=>new Sh(t,e.cacheSizeBytes)})})).apply(this,arguments)}function $h(r,e,t){if((r=ee(r,de))._firestoreClient||r._terminated)throw new k(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(r._componentsProvider||r._getSettings().localCache)throw new k(b.FAILED_PRECONDITION,"SDK cache is already specified.");r._componentsProvider={_online:e,_offline:t},Qh(r)}function dp(r){if(r._initialized&&!r._terminated)throw new k(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Se;return r._queue.enqueueAndForgetEvenWhileRestricted((0,C.A)(function*(){try{yield(t=(0,C.A)(function*(i){if(!O.D())return Promise.resolve();const s=i+"main";yield O.delete(s)}),function n(i){return t.apply(this,arguments)})(zo(r._databaseId,r._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}function fp(r){return function(t){const n=new Se;return t.asyncQueue.enqueueAndForget((0,C.A)(function*(){return function xg(r,e){return qa.apply(this,arguments)}(yield uu(t),n)})),n.promise}(Ae(r=ee(r,de)))}function mp(r){return function $g(r){return r.asyncQueue.enqueue((0,C.A)(function*(){const e=yield Ch(r),t=yield Dh(r);return e.setNetworkEnabled(!0),function(i){const s=q(i);return s.L_.delete(0),si(s)}(t)}))}(Ae(r=ee(r,de)))}function gp(r){return function Wg(r){return r.asyncQueue.enqueue((0,C.A)(function*(){const e=yield Ch(r),t=yield Dh(r);return e.setNetworkEnabled(!1),(n=(0,C.A)(function*(s){const a=q(s);a.L_.add(0),yield ar(a),a.q_.set("Offline")}),function i(s){return n.apply(this,arguments)})(t);var n}))}(Ae(r=ee(r,de)))}function pp(r,e){const t=Ae(r=ee(r,de)),n=new ap;return function Zg(r,e,t,n){const i=function(a,u){let c;return c="string"==typeof a?Yc().encode(a):a,f=function(f,p){if(f instanceof Uint8Array)return bh(f,p);if(f instanceof ArrayBuffer)return bh(new Uint8Array(f),p);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),new Kg(f,u);var f}(t,ii(e));r.asyncQueue.enqueueAndForget((0,C.A)(function*(){!function Ug(r,e,t){const n=q(r);var i;(i=(0,C.A)(function*(a,u,c){try{const h=yield u.getMetadata();if(yield function(N,L){const M=q(N),Q=be(L.createTime);return M.persistence.runTransaction("hasNewerBundle","readonly",H=>M.Gr.getBundleMetadata(H,L.id)).then(H=>!!H&&H.createTime.compareTo(Q)>=0)}(a.localStore,h))return yield u.close(),c._completeWith({taskState:"Success",documentsLoaded:(N=h).totalDocuments,bytesLoaded:N.totalBytes,totalDocuments:N.totalDocuments,totalBytes:N.totalBytes}),Promise.resolve(new Set);c._updateProgress(yh(h));const f=new yg(h,a.localStore,u.serializer);let p=yield u.Ua();for(;p;){const V=yield f.la(p);V&&c._updateProgress(V),p=yield u.Ua()}const y=yield f.complete();return yield Dt(a,y.Ia,void 0),yield function(N,L){const M=q(N);return M.persistence.runTransaction("Save bundle","readwrite",Q=>M.Gr.saveBundleMetadata(Q,L))}(a.localStore,h),c._completeWith(y.progress),Promise.resolve(y.Pa)}catch(h){return Ce("SyncEngine",`Loading bundle failed with ${h}`),c._failWith(h),Promise.resolve(new Set)}var N}),function s(a,u,c){return i.apply(this,arguments)})(n,e,t).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}(yield uu(r),i,n)}))}(t,r._databaseId,e,n),n}function _p(r,e){return function ep(r,e){return r.asyncQueue.enqueue((0,C.A)(function*(){return function(n,i){const s=q(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(yield _r(r),e)}))}(Ae(r=ee(r,de)),e).then(t=>t?new Ge(r,null,t.query):null)}class en{constructor(e){this._byteString=e}static fromBase64String(e){try{return new en(we.fromBase64String(e))}catch(t){throw new k(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new en(we.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class tn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new k(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class bn{constructor(e){this._methodName=e}}class Vs{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return J(this._lat,e._lat)||J(this._long,e._long)}}class Ss{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(n,i){if(n.length!==i.length)return!1;for(let s=0;s<n.length;++s)if(n[s]!==i[s])return!1;return!0}(this._values,e._values)}}const Ip=/^__.*__$/;class Tp{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new xt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Yn(e,this.data,t,this.fieldTransforms)}}class Wh{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new xt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Hh(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw z()}}class bs{constructor(e,t,n,i,s,a){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new bs(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.Ou(e),i}Nu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Fu({path:n,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Ds(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(0===e.length)throw this.Bu("Document fields must not be empty");if(Hh(this.Cu)&&Ip.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class Ep{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||ii(e)}Qu(e,t,n,i=!1){return new bs({Cu:e,methodName:t,qu:n,path:le.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function xn(r){const e=r._freezeSettings(),t=ii(r._databaseId);return new Ep(r._databaseId,!!e.ignoreUndefinedProperties,t)}function xs(r,e,t,n,i,s={}){const a=r.Qu(s.merge||s.mergeFields?2:0,e,t,i);Tu("Data must be an object, but it was:",a,n);const u=Xh(n,a);let c,h;if(s.merge)c=new tt(a.fieldMask),h=a.fieldTransforms;else if(s.mergeFields){const f=[];for(const p of s.mergeFields){const y=ci(e,p,t);if(!a.contains(y))throw new k(b.INVALID_ARGUMENT,`Field '${y}' is specified in your field mask but missing from your input data.`);ed(f,y)||f.push(y)}c=new tt(f),h=a.fieldTransforms.filter(p=>c.covers(p.field))}else c=null,h=a.fieldTransforms;return new Tp(new Ue(u),c,h)}class ui extends bn{_toFieldTransform(e){if(2!==e.Cu)throw e.Bu(1===e.Cu?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ui}}function Jh(r,e,t){return new bs({Cu:3,qu:e.settings.qu,methodName:r._methodName,xu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class mu extends bn{_toFieldTransform(e){return new zr(e.path,new Hn)}isEqual(e){return e instanceof mu}}class gu extends bn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Jh(this,e,!0),n=this.Ku.map(s=>Cn(s,t)),i=new Tn(n);return new zr(e.path,i)}isEqual(e){return e instanceof gu&&(0,re.bD)(this.Ku,e.Ku)}}class pu extends bn{constructor(e,t){super(e),this.Ku=t}_toFieldTransform(e){const t=Jh(this,e,!0),n=this.Ku.map(s=>Cn(s,t)),i=new En(n);return new zr(e.path,i)}isEqual(e){return e instanceof pu&&(0,re.bD)(this.Ku,e.Ku)}}class _u extends bn{constructor(e,t){super(e),this.$u=t}_toFieldTransform(e){const t=new Jn(e.serializer,Oc(e.serializer,this.$u));return new zr(e.path,t)}isEqual(e){return e instanceof _u&&this.$u===e.$u}}function yu(r,e,t,n){const i=r.Qu(1,e,t);Tu("Data must be an object, but it was:",i,n);const s=[],a=Ue.empty();Gt(n,(c,h)=>{const f=Cs(e,c,t);h=(0,re.Ku)(h);const p=i.Nu(f);if(h instanceof ui)s.push(f);else{const y=Cn(h,p);null!=y&&(s.push(f),a.set(f,y))}});const u=new tt(s);return new Wh(a,u,i.fieldTransforms)}function Iu(r,e,t,n,i,s){const a=r.Qu(1,e,t),u=[ci(e,n,t)],c=[i];if(s.length%2!=0)throw new k(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let y=0;y<s.length;y+=2)u.push(ci(e,s[y])),c.push(s[y+1]);const h=[],f=Ue.empty();for(let y=u.length-1;y>=0;--y)if(!ed(h,u[y])){const V=u[y];let N=c[y];N=(0,re.Ku)(N);const L=a.Nu(V);if(N instanceof ui)h.push(V);else{const M=Cn(N,L);null!=M&&(h.push(V),f.set(V,M))}}const p=new tt(h);return new Wh(f,p,a.fieldTransforms)}function Yh(r,e,t,n=!1){return Cn(t,r.Qu(n?4:3,e))}function Cn(r,e){if(Zh(r=(0,re.Ku)(r)))return Tu("Unsupported field value:",e,r),Xh(r,e);if(r instanceof bn)return function(n,i){if(!Hh(i.Cu))throw i.Bu(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${n._methodName}() is not currently supported inside arrays`);const s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,e),null;if(void 0===r&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),r instanceof Array){if(e.settings.xu&&4!==e.Cu)throw e.Bu("Nested arrays are not supported");return function(n,i){const s=[];let a=0;for(const u of n){let c=Cn(u,i.Lu(a));null==c&&(c={nullValue:"NULL_VALUE"}),s.push(c),a++}return{arrayValue:{values:s}}}(r,e)}return function(n,i){if(null===(n=(0,re.Ku)(n)))return{nullValue:"NULL_VALUE"};if("number"==typeof n)return Oc(i.serializer,n);if("boolean"==typeof n)return{booleanValue:n};if("string"==typeof n)return{stringValue:n};if(n instanceof Date){const s=ge.fromDate(n);return{timestampValue:Zn(i.serializer,s)}}if(n instanceof ge){const s=new ge(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:Zn(i.serializer,s)}}if(n instanceof Vs)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof en)return{bytesValue:sl(i.serializer,n._byteString)};if(n instanceof Re){const s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:bo(n.firestore._databaseId||i.databaseId,n._key.path)}}if(n instanceof Ss)return u=i,{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:n.toArray().map(c=>{if("number"!=typeof c)throw u.Bu("VectorValues must only contain numeric values.");return vo(u.serializer,c)})}}}}};var u;throw i.Bu(`Unsupported field value: ${Ps(n)}`)}(r,e)}function Xh(r,e){const t={};return rc(r)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gt(r,(n,i)=>{const s=Cn(i,e.Mu(n));null!=s&&(t[n]=s)}),{mapValue:{fields:t}}}function Zh(r){return!("object"!=typeof r||null===r||r instanceof Array||r instanceof Date||r instanceof ge||r instanceof Vs||r instanceof en||r instanceof Re||r instanceof bn||r instanceof Ss)}function Tu(r,e,t){if(!Zh(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const n=Ps(t);throw e.Bu("an object"===n?r+" a custom object":r+" "+n)}var i}function ci(r,e,t){if((e=(0,re.Ku)(e))instanceof tn)return e._internalPath;if("string"==typeof e)return Cs(r,e);throw Ds("Field path arguments must be of type string or ",r,!1,void 0,t)}const vp=new RegExp("[~\\*/\\[\\]]");function Cs(r,e,t){if(e.search(vp)>=0)throw Ds(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,t);try{return new tn(...e.split("."))._internalPath}catch{throw Ds(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,t)}}function Ds(r,e,t,n,i){const s=n&&!n.isEmpty(),a=void 0!==i;let u=`Function ${e}() called with invalid data`;t&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||a)&&(c+=" (found",s&&(c+=` in field ${n}`),a&&(c+=` in document ${i}`),c+=")"),new k(b.INVALID_ARGUMENT,u+r+c)}function ed(r,e){return r.some(t=>t.isEqual(e))}class li{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Re(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Ap(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ns("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Ap extends li{data(){return super.data()}}function Ns(r,e){return"string"==typeof e?Cs(r,e):e instanceof tn?e._internalPath:e._delegate._internalPath}function td(r){if("L"===r.limitType&&0===r.explicitOrderBy.length)throw new k(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Eu{}class hi extends Eu{}function wp(r,e,...t){let n=[];e instanceof Eu&&n.push(e),n=n.concat(t),function(s){const a=s.filter(c=>c instanceof Ir).length,u=s.filter(c=>c instanceof di).length;if(a>1||a>0&&u>0)throw new k(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(const i of n)r=i._apply(r);return r}class di extends hi{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new di(e,t,n)}_apply(e){const t=this._parse(e);return sd(e._query,t),new Ge(e.firestore,e.converter,To(e._query,t))}_parse(e){const t=xn(e.firestore);return function(s,a,u,c,h,f,p){let y;if(h.isKeyField()){if("array-contains"===f||"array-contains-any"===f)throw new k(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if("in"===f||"not-in"===f){id(p,f);const V=[];for(const N of p)V.push(rd(c,s,N));y={arrayValue:{values:V}}}else y=rd(c,s,p)}else"in"!==f&&"not-in"!==f&&"array-contains-any"!==f||id(p,f),y=Yh(u,"where",p,"in"===f||"not-in"===f);return ne.create(h,f,y)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}function Rp(r,e,t){const n=e,i=Ns("where",r);return di._create(i,n,t)}class Ir extends Eu{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ir(e,t)}_parse(e){const t=this._queryConstraints.map(n=>n._parse(e)).filter(n=>n.getFilters().length>0);return 1===t.length?t[0]:ce.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const c of u)sd(a,c),a=To(a,c)}(e._query,t),new Ge(e.firestore,e.converter,To(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class vu extends hi{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new vu(e,t)}_apply(e){const t=function(i,s,a){if(null!==i.startAt)throw new k(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new k(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Lr(s,a)}(e._query,this._field,this._direction);return new Ge(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new St(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function Pp(r,e="asc"){const t=e,n=Ns("orderBy",r);return vu._create(n,t)}class ks extends hi{constructor(e,t,n){super(),this.type=e,this._limit=t,this._limitType=n}static _create(e,t,n){return new ks(e,t,n)}_apply(e){return new Ge(e.firestore,e.converter,Zi(e._query,this._limit,this._limitType))}}function Vp(r){return Uh("limit",r),ks._create("limit",r,"F")}function Sp(r){return Uh("limitToLast",r),ks._create("limitToLast",r,"L")}class Fs extends hi{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Fs(e,t,n)}_apply(e){const t=nd(e,this.type,this._docOrFields,this._inclusive);return new Ge(e.firestore,e.converter,(s=t,new St((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)));var i,s}}function bp(...r){return Fs._create("startAt",r,!0)}function xp(...r){return Fs._create("startAfter",r,!1)}class Ms extends hi{constructor(e,t,n){super(),this.type=e,this._docOrFields=t,this._inclusive=n}static _create(e,t,n){return new Ms(e,t,n)}_apply(e){const t=nd(e,this.type,this._docOrFields,this._inclusive);return new Ge(e.firestore,e.converter,(s=t,new St((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)));var i,s}}function Cp(...r){return Ms._create("endBefore",r,!1)}function Dp(...r){return Ms._create("endAt",r,!0)}function nd(r,e,t,n){if(t[0]=(0,re.Ku)(t[0]),t[0]instanceof li)return function(s,a,u,c,h){if(!c)throw new k(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const f=[];for(const p of $n(s))if(p.field.isKeyField())f.push(yn(a,c.key));else{const y=c.data.field(p.field);if(ji(y))throw new k(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===y){const V=p.field.canonicalString();throw new k(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${V}' (used as the orderBy) does not exist.`)}f.push(y)}return new $t(f,h)}(r._query,r.firestore._databaseId,e,t[0]._document,n);{const i=xn(r.firestore);return function(a,u,c,h,f,p){const y=a.explicitOrderBy;if(f.length>y.length)throw new k(b.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const V=[];for(let N=0;N<f.length;N++){const L=f[N];if(y[N].field.isKeyField()){if("string"!=typeof L)throw new k(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof L}`);if(!Io(a)&&-1!==L.indexOf("/"))throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${L}' contains a slash.`);const M=a.path.child(te.fromString(L));if(!G.isDocumentKey(M))throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const Q=new G(M);V.push(yn(u,Q))}else{const M=Yh(c,h,L);V.push(M)}}return new $t(V,p)}(r._query,r.firestore._databaseId,i,e,t,n)}}function rd(r,e,t){if("string"==typeof(t=(0,re.Ku)(t))){if(""===t)throw new k(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Io(e)&&-1!==t.indexOf("/"))throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const n=e.path.child(te.fromString(t));if(!G.isDocumentKey(n))throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return yn(r,new G(n))}if(t instanceof Re)return yn(r,t._key);throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Ps(t)}.`)}function id(r,e){if(!Array.isArray(r)||0===r.length)throw new k(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function sd(r,e){const t=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new k(b.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Au{convertValue(e,t="none"){switch(jt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Vt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw z()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Gt(e,(i,s)=>{n[i]=this.convertValue(s,t)}),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t.value.arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map(a=>Ee(a.doubleValue));return new Ss(s)}convertGeoPoint(e){return new Vs(Ee(e.latitude),Ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(n=>this.convertValue(n,t))}convertServerTimestamp(e,t){switch(t){case"previous":const n=Qi(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(kr(e));default:return null}}convertTimestamp(e){const t=Pt(e);return new ge(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=te.fromString(e);j(_l(n));const i=new Kt(n.get(1),n.get(3)),s=new G(n.popFirst(5));return i.isEqual(t)||Te(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Os(r,e,t){let n;return n=r?t&&(t.merge||t.mergeFields)?r.toFirestore(e,t):r.toFirestore(e):e,n}class Np extends Au{constructor(e){super(),this.firestore=e}convertBytes(e){return new en(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Re(this.firestore,null,t)}}class Dn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Nn extends li{constructor(e,t,n,i,s,a){super(e,t,n,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new fi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Ns("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class fi extends Nn{data(e={}){return super.data(e)}}class kn{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Dn(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new fi(this._firestore,this._userDataWriter,n.key,n,new Dn(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new fi(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Dn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:a++}))}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||3!==u.type).map(u=>{const c=new fi(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Dn(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let h=-1,f=-1;return 0!==u.type&&(h=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),1!==u.type&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:Fp(u.type),doc:c,oldIndex:h,newIndex:f}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Fp(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return z()}}function Mp(r,e){return r instanceof Nn&&e instanceof Nn?r._firestore===e._firestore&&r._key.isEqual(e._key)&&(null===r._document?null===e._document:r._document.isEqual(e._document))&&r._converter===e._converter:r instanceof kn&&e instanceof kn&&r._firestore===e._firestore&&hu(r.query,e.query)&&r.metadata.isEqual(e.metadata)&&r._snapshot.isEqual(e._snapshot)}function Op(r){r=ee(r,Re);const e=ee(r.firestore,de);return kh(Ae(e),r._key).then(t=>wu(e,r,t))}class nn extends Au{constructor(e){super(),this.firestore=e}convertBytes(e){return new en(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Re(this.firestore,null,t)}}function Lp(r){r=ee(r,Re);const e=ee(r.firestore,de),t=Ae(e),n=new nn(e);return function Hg(r,e){const t=new Se;return r.asyncQueue.enqueueAndForget((0,C.A)(function*(){return(n=(0,C.A)(function*(s,a,u){try{const c=yield function(f,p){const y=q(f);return y.persistence.runTransaction("read document","readonly",V=>y.localDocuments.getDocument(V,p))}(s,a);c.isFoundDocument()?u.resolve(c):c.isNoDocument()?u.resolve(null):u.reject(new k(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(c){const h=hr(c,`Failed to get document '${a} from cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield _r(r),e,t);var n})),t.promise}(t,r._key).then(i=>new Nn(e,n,r._key,i,new Dn(null!==i&&i.hasLocalMutations,!0),r.converter))}function Bp(r){r=ee(r,Re);const e=ee(r.firestore,de);return kh(Ae(e),r._key,{source:"server"}).then(t=>wu(e,r,t))}function qp(r){r=ee(r,Ge);const e=ee(r.firestore,de),t=Ae(e),n=new nn(e);return td(r._query),Fh(t,r._query).then(i=>new kn(e,n,r,i))}function Up(r){r=ee(r,Ge);const e=ee(r.firestore,de),t=Ae(e),n=new nn(e);return function Jg(r,e){const t=new Se;return r.asyncQueue.enqueueAndForget((0,C.A)(function*(){return(n=(0,C.A)(function*(s,a,u){try{const c=yield ps(s,a,!0),h=new Eh(a,c.Ts),f=h.ma(c.documents),p=h.applyChanges(f,!1);u.resolve(p.snapshot)}catch(c){const h=hr(c,`Failed to execute query '${a} against cache`);u.reject(h)}}),function i(s,a,u){return n.apply(this,arguments)})(yield _r(r),e,t);var n})),t.promise}(t,r._query).then(i=>new kn(e,n,r,i))}function Gp(r){r=ee(r,Ge);const e=ee(r.firestore,de),t=Ae(e),n=new nn(e);return Fh(t,r._query,{source:"server"}).then(i=>new kn(e,n,r,i))}function Kp(r,e,t){r=ee(r,Re);const n=ee(r.firestore,de),i=Os(r.converter,e,t);return Tr(n,[xs(xn(n),"setDoc",r._key,i,null!==r.converter,t).toMutation(r._key,ve.none())])}function zp(r,e,t,...n){r=ee(r,Re);const i=ee(r.firestore,de),s=xn(i);let a;return a="string"==typeof(e=(0,re.Ku)(e))||e instanceof tn?Iu(s,"updateDoc",r._key,e,t,n):yu(s,"updateDoc",r._key,e),Tr(i,[a.toMutation(r._key,ve.exists(!0))])}function jp(r){return Tr(ee(r.firestore,de),[new Xn(r._key,ve.none())])}function Qp(r,e){const t=ee(r.firestore,de),n=zh(r),i=Os(r.converter,e);return Tr(t,[xs(xn(r.firestore),"addDoc",n._key,i,null!==r.converter,{}).toMutation(n._key,ve.exists(!1))]).then(()=>n)}function $p(r,...e){var t,n,i;r=(0,re.Ku)(r);let s={includeMetadataChanges:!1,source:"default"},a=0;"object"!=typeof e[a]||du(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(du(e[a])){const p=e[a];e[a]=null===(t=p.next)||void 0===t?void 0:t.bind(p),e[a+1]=null===(n=p.error)||void 0===n?void 0:n.bind(p),e[a+2]=null===(i=p.complete)||void 0===i?void 0:i.bind(p)}let c,h,f;if(r instanceof Re)h=ee(r.firestore,de),f=Qn(r._key.path),c={next:p=>{e[a]&&e[a](wu(h,r,p))},error:e[a+1],complete:e[a+2]};else{const p=ee(r,Ge);h=ee(p.firestore,de),f=p._query;const y=new nn(h);c={next:V=>{e[a]&&e[a](new kn(h,y,p,V))},error:e[a+1],complete:e[a+2]},td(r._query)}return function(y,V,N,L){const M=new ws(L),Q=new Va(V,M,N);return y.asyncQueue.enqueueAndForget((0,C.A)(function*(){return Ea(yield yr(y),Q)})),()=>{M.Za(),y.asyncQueue.enqueueAndForget((0,C.A)(function*(){return Aa(yield yr(y),Q)}))}}(Ae(h),f,u,c)}function Wp(r,e){return function Xg(r,e){const t=new ws(e);return r.asyncQueue.enqueueAndForget((0,C.A)(function*(){return i=yield yr(r),s=t,q(i).Y_.add(s),void s.next();var i,s})),()=>{t.Za(),r.asyncQueue.enqueueAndForget((0,C.A)(function*(){return i=yield yr(r),s=t,void q(i).Y_.delete(s);var i,s}))}}(Ae(r=ee(r,de)),du(e)?e:{next:e})}function Tr(r,e){return function(n,i){const s=new Se;return n.asyncQueue.enqueueAndForget((0,C.A)(function*(){return function Pg(r,e,t){return Fa.apply(this,arguments)}(yield uu(n),i,s)})),s.promise}(Ae(r),e)}function wu(r,e,t){const n=t.docs.get(e._key),i=new nn(r);return new Nn(r,i,e._key,n,new Dn(t.hasPendingWrites,t.fromCache),e.converter)}const r_={maxAttempts:5};class ad{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=xn(e)}set(e,t,n){this._verifyNotCommitted();const i=rn(e,this._firestore),s=Os(i.converter,t,n),a=xs(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(a.toMutation(i._key,ve.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=rn(e,this._firestore);let a;return a="string"==typeof(t=(0,re.Ku)(t))||t instanceof tn?Iu(this._dataReader,"WriteBatch.update",s._key,t,n,i):yu(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,ve.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=rn(e,this._firestore);return this._mutations=this._mutations.concat(new Xn(t._key,ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function rn(r,e){if((r=(0,re.Ku)(r)).firestore!==e)throw new k(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}class i_ extends class{constructor(t,n){this._firestore=t,this._transaction=n,this._dataReader=xn(t)}get(t){const n=rn(t,this._firestore),i=new Np(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||1!==s.length)return z();const a=s[0];if(a.isFoundDocument())return new li(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new li(this._firestore,i,n._key,null,n.converter);throw z()})}set(t,n,i){const s=rn(t,this._firestore),a=Os(s.converter,n,i),u=xs(this._dataReader,"Transaction.set",s._key,a,null!==s.converter,i);return this._transaction.set(s._key,u),this}update(t,n,i,...s){const a=rn(t,this._firestore);let u;return u="string"==typeof(n=(0,re.Ku)(n))||n instanceof tn?Iu(this._dataReader,"Transaction.update",a._key,n,i,s):yu(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(t){const n=rn(t,this._firestore);return this._transaction.delete(n._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=rn(e,this._firestore),n=new nn(this._firestore);return super.get(e).then(i=>new Nn(this._firestore,n,t._key,i._document,new Dn(!1,!1),t.converter))}}function s_(r,e,t){r=ee(r,de);const n=Object.assign(Object.assign({},r_),t);return function(s){if(s.maxAttempts<1)throw new k(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){const c=new Se;return s.asyncQueue.enqueueAndForget((0,C.A)(function*(){const h=yield function Nh(r){return Rs(r).then(e=>e.datastore)}(s);new jg(s.asyncQueue,h,u,a,c).au()})),c.promise}(Ae(r),i=>e(new i_(r,i)),n)}function o_(){return new ui("deleteField")}function a_(){return new mu("serverTimestamp")}function u_(...r){return new gu("arrayUnion",r)}function c_(...r){return new pu("arrayRemove",r)}function l_(r){return new _u("increment",r)}!function(e,t=!0){Lt=Mt.SDK_VERSION,(0,Mt._registerComponent)(new me.uA("firestore",(n,{instanceIdentifier:i,options:s})=>{const a=n.getProvider("app").getImmediate(),u=new de(new Oi(n.getProvider("auth-internal")),new Le(n.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new k(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Kt(h.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),(0,Mt.registerVersion)(B,"4.7.3",e),(0,Mt.registerVersion)(B,"4.7.3","esm2017")}()},6340:(ff,no,ue)=>{ue.d(no,{Qe:()=>R});var C=ue(9842),Mt=ue(177),me=ue(4438),Ie=ue(5407),re=ue(9253),ct=ue(1977),Ni=ue(3236),Et=ue(1985),cn=ue(8455),ln=ue(7673),rt=ue(9172),ki=ue(9974),ro=ue(4360);function vt(){return(0,ki.N)((O,m)=>{let I,D=!1;O.subscribe((0,ro._)(m,U=>{const ie=I;I=U,D&&m.next([ie,U]),D=!0}))})}var it=ue(6354),Ot=ue(2816),Rr=ue(3294),Pr=ue(5964),Fi=(ue(2438),ue(3345)),B=ue(9583),Ve=ue(1076),Lt=ue(1362);function Vr(O,m){if(void 0===m)return{merge:!1};if(void 0!==m.mergeFields&&void 0!==m.merge)throw new B.W6("invalid-argument",`Invalid options passed to function ${O}(): You cannot specify both "merge" and "mergeFields".`);return m}function F(){if(typeof Uint8Array>"u")throw new B.W6("unimplemented","Uint8Arrays are not available in this environment.")}function Te(){if(!(0,B.qG)())throw new B.W6("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Ce{constructor(m){this._delegate=m}static fromBase64String(m){return Te(),new Ce(B.Ix.fromBase64String(m))}static fromUint8Array(m){return F(),new Ce(B.Ix.fromUint8Array(m))}toBase64(){return Te(),this._delegate.toBase64()}toUint8Array(){return F(),this._delegate.toUint8Array()}isEqual(m){return this._delegate.isEqual(m._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function hn(O){return function z(O,m){if("object"!=typeof O||null===O)return!1;const I=O;for(const D of m)if(D in I&&"function"==typeof I[D])return!0;return!1}(O,["next","error","complete"])}class j{enableIndexedDbPersistence(m,I){return(0,B.ol)(m._delegate,{forceOwnership:I})}enableMultiTabIndexedDbPersistence(m){return(0,B.Q5)(m._delegate)}clearIndexedDbPersistence(m){return(0,B.me)(m._delegate)}}class Mi{constructor(m,I,D){this._delegate=I,this._persistenceProvider=D,this.INTERNAL={delete:()=>this.terminate()},m instanceof B.cm||(this._appCompat=m)}get _databaseId(){return this._delegate._databaseId}settings(m){const I=this._delegate._getSettings();!m.merge&&I.host!==m.host&&(0,B.qi)("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),m.merge&&delete(m=Object.assign(Object.assign({},I),m)).merge,this._delegate._setSettings(m)}useEmulator(m,I,D={}){(0,B.vN)(this._delegate,m,I,D)}enableNetwork(){return(0,B.Os)(this._delegate)}disableNetwork(){return(0,B.LA)(this._delegate)}enablePersistence(m){let I=!1,D=!1;return m&&(I=!!m.synchronizeTabs,D=!!m.experimentalForceOwningTab,(0,B.c8)("synchronizeTabs",I,"experimentalForceOwningTab",D)),I?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,D)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return(0,B.iB)(this._delegate)}onSnapshotsInSync(m){return(0,B.FC)(this._delegate,m)}get app(){if(!this._appCompat)throw new B.W6("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(m){try{return new At(this,(0,B.rJ)(this._delegate,m))}catch(I){throw Oe(I,"collection()","Firestore.collection()")}}doc(m){try{return new et(this,(0,B.H9)(this._delegate,m))}catch(I){throw Oe(I,"doc()","Firestore.doc()")}}collectionGroup(m){try{return new Le(this,(0,B.Cs)(this._delegate,m))}catch(I){throw Oe(I,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(m){return(0,B.c4)(this._delegate,I=>m(new k(this,I)))}batch(){return(0,B.Ws)(this._delegate),new Se(new B.GA(this._delegate,m=>(0,B.z6)(this._delegate,m)))}loadBundle(m){return(0,B.po)(this._delegate,m)}namedQuery(m){return(0,B.St)(this._delegate,m).then(I=>I?new Le(this,I):null)}}class q extends B.fS{constructor(m){super(),this.firestore=m}convertBytes(m){return new Ce(new B.Ix(m))}convertReference(m){const I=this.convertDocumentKey(m,this.firestore._databaseId);return et.forKey(I,this.firestore,null)}}class k{constructor(m,I){this._firestore=m,this._delegate=I,this._userDataWriter=new q(m)}get(m){const I=J(m);return this._delegate.get(I).then(D=>new dn(this._firestore,new B.Wq(this._firestore._delegate,this._userDataWriter,D._key,D._document,D.metadata,I.converter)))}set(m,I,D){const U=J(m);return D?(Vr("Transaction.set",D),this._delegate.set(U,I,D)):this._delegate.set(U,I),this}update(m,I,D,...U){const ie=J(m);return 2===arguments.length?this._delegate.update(ie,I):this._delegate.update(ie,I,D,...U),this}delete(m){const I=J(m);return this._delegate.delete(I),this}}class Se{constructor(m){this._delegate=m}set(m,I,D){const U=J(m);return D?(Vr("WriteBatch.set",D),this._delegate.set(U,I,D)):this._delegate.set(U,I),this}update(m,I,D,...U){const ie=J(m);return 2===arguments.length?this._delegate.update(ie,I):this._delegate.update(ie,I,D,...U),this}delete(m){const I=J(m);return this._delegate.delete(I),this}commit(){return this._delegate.commit()}}class dt{constructor(m,I,D){this._firestore=m,this._userDataWriter=I,this._delegate=D}fromFirestore(m,I){const D=new B.YQ(this._firestore._delegate,this._userDataWriter,m._key,m._document,m.metadata,null);return this._delegate.fromFirestore(new qt(this._firestore,D),null!=I?I:{})}toFirestore(m,I){return I?this._delegate.toFirestore(m,I):this._delegate.toFirestore(m)}static getInstance(m,I){const D=dt.INSTANCES;let U=D.get(m);U||(U=new WeakMap,D.set(m,U));let ie=U.get(I);return ie||(ie=new dt(m,new q(m),I),U.set(I,ie)),ie}}dt.INSTANCES=new WeakMap;class et{constructor(m,I){this.firestore=m,this._delegate=I,this._userDataWriter=new q(m)}static forPath(m,I,D){if(m.length%2!=0)throw new B.W6("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${m.canonicalString()} has ${m.length}`);return new et(I,new B.T1(I._delegate,D,new B.K$(m)))}static forKey(m,I,D){return new et(I,new B.T1(I._delegate,D,m))}get id(){return this._delegate.id}get parent(){return new At(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(m){try{return new At(this.firestore,(0,B.rJ)(this._delegate,m))}catch(I){throw Oe(I,"collection()","DocumentReference.collection()")}}isEqual(m){return(m=(0,Ve.Ku)(m))instanceof B.T1&&(0,B.yx)(this._delegate,m)}set(m,I){I=Vr("DocumentReference.set",I);try{return I?(0,B.BN)(this._delegate,m,I):(0,B.BN)(this._delegate,m)}catch(D){throw Oe(D,"setDoc()","DocumentReference.set()")}}update(m,I,...D){try{return 1===arguments.length?(0,B.mZ)(this._delegate,m):(0,B.mZ)(this._delegate,m,I,...D)}catch(U){throw Oe(U,"updateDoc()","DocumentReference.update()")}}delete(){return(0,B.kd)(this._delegate)}onSnapshot(...m){const I=Oi(m),D=Li(m,U=>new dn(this.firestore,new B.Wq(this.firestore._delegate,this._userDataWriter,U._key,U._document,U.metadata,this._delegate.converter)));return(0,B.aQ)(this._delegate,I,D)}get(m){let I;return I="cache"===(null==m?void 0:m.source)?(0,B.nY)(this._delegate):"server"===(null==m?void 0:m.source)?(0,B._e)(this._delegate):(0,B.x7)(this._delegate),I.then(D=>new dn(this.firestore,new B.Wq(this.firestore._delegate,this._userDataWriter,D._key,D._document,D.metadata,this._delegate.converter)))}withConverter(m){return new et(this.firestore,this._delegate.withConverter(m?dt.getInstance(this.firestore,m):null))}}function Oe(O,m,I){return O.message=O.message.replace(m,I),O}function Oi(O){for(const m of O)if("object"==typeof m&&!hn(m))return m;return{}}function Li(O,m){var I,D;let U;return U=hn(O[0])?O[0]:hn(O[1])?O[1]:"function"==typeof O[0]?{next:O[0],error:O[1],complete:O[2]}:{next:O[1],error:O[2],complete:O[3]},{next:ie=>{U.next&&U.next(m(ie))},error:null===(I=U.error)||void 0===I?void 0:I.bind(U),complete:null===(D=U.complete)||void 0===D?void 0:D.bind(U)}}class dn{constructor(m,I){this._firestore=m,this._delegate=I}get ref(){return new et(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(m){return this._delegate.data(m)}get(m,I){return this._delegate.get(m,I)}isEqual(m){return(0,B.lN)(this._delegate,m._delegate)}}class qt extends dn{data(m){const I=this._delegate.data(m);return this._delegate._converter||(0,B.bI)(void 0!==I,"Document in a QueryDocumentSnapshot should exist"),I}}class Le{constructor(m,I){this.firestore=m,this._delegate=I,this._userDataWriter=new q(m)}where(m,I,D){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B._M)(m,I,D)))}catch(U){throw Oe(U,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(m,I){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.My)(m,I)))}catch(D){throw Oe(D,/(orderBy|where)\(\)/,"Query.$1()")}}limit(m){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.AB)(m)))}catch(I){throw Oe(I,"limit()","Query.limit()")}}limitToLast(m){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.$1)(m)))}catch(I){throw Oe(I,"limitToLast()","Query.limitToLast()")}}startAt(...m){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.EO)(...m)))}catch(I){throw Oe(I,"startAt()","Query.startAt()")}}startAfter(...m){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.HM)(...m)))}catch(I){throw Oe(I,"startAfter()","Query.startAfter()")}}endBefore(...m){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.rf)(...m)))}catch(I){throw Oe(I,"endBefore()","Query.endBefore()")}}endAt(...m){try{return new Le(this.firestore,(0,B.P)(this._delegate,(0,B.FD)(...m)))}catch(I){throw Oe(I,"endAt()","Query.endAt()")}}isEqual(m){return(0,B.B)(this._delegate,m._delegate)}get(m){let I;return I="cache"===(null==m?void 0:m.source)?(0,B.kU)(this._delegate):"server"===(null==m?void 0:m.source)?(0,B.Rr)(this._delegate):(0,B.GG)(this._delegate),I.then(D=>new Sr(this.firestore,new B.NJ(this.firestore._delegate,this._userDataWriter,this._delegate,D._snapshot)))}onSnapshot(...m){const I=Oi(m),D=Li(m,U=>new Sr(this.firestore,new B.NJ(this.firestore._delegate,this._userDataWriter,this._delegate,U._snapshot)));return(0,B.aQ)(this._delegate,I,D)}withConverter(m){return new Le(this.firestore,this._delegate.withConverter(m?dt.getInstance(this.firestore,m):null))}}class Yu{constructor(m,I){this._firestore=m,this._delegate=I}get type(){return this._delegate.type}get doc(){return new qt(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Sr{constructor(m,I){this._firestore=m,this._delegate=I}get query(){return new Le(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(m=>new qt(this._firestore,m))}docChanges(m){return this._delegate.docChanges(m).map(I=>new Yu(this._firestore,I))}forEach(m,I){this._delegate.forEach(D=>{m.call(I,new qt(this._firestore,D))})}isEqual(m){return(0,B.lN)(this._delegate,m._delegate)}}class At extends Le{constructor(m,I){super(m,I),this.firestore=m,this._delegate=I}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const m=this._delegate.parent;return m?new et(this.firestore,m):null}doc(m){try{return new et(this.firestore,void 0===m?(0,B.H9)(this._delegate):(0,B.H9)(this._delegate,m))}catch(I){throw Oe(I,"doc()","CollectionReference.doc()")}}add(m){return(0,B.gS)(this._delegate,m).then(I=>new et(this.firestore,I))}isEqual(m){return(0,B.yx)(this._delegate,m._delegate)}withConverter(m){return new At(this.firestore,this._delegate.withConverter(m?dt.getInstance(this.firestore,m):null))}}function J(O){return(0,B.lo)(O,B.T1)}class ft{constructor(...m){this._delegate=new B.uY(...m)}static documentId(){return new ft(B.FA.keyField().canonicalString())}isEqual(m){return(m=(0,Ve.Ku)(m))instanceof B.uY&&this._delegate._internalPath.isEqual(m._internalPath)}}class mt{constructor(m){this._delegate=m}static serverTimestamp(){const m=(0,B.O5)();return m._methodName="FieldValue.serverTimestamp",new mt(m)}static delete(){const m=(0,B.CL)();return m._methodName="FieldValue.delete",new mt(m)}static arrayUnion(...m){const I=(0,B.hq)(...m);return I._methodName="FieldValue.arrayUnion",new mt(I)}static arrayRemove(...m){const I=(0,B.C3)(...m);return I._methodName="FieldValue.arrayRemove",new mt(I)}static increment(m){const I=(0,B.GV)(m);return I._methodName="FieldValue.increment",new mt(I)}isEqual(m){return this._delegate.isEqual(m._delegate)}}const ge={Firestore:Mi,GeoPoint:B.Ci,Timestamp:B.Dc,Blob:Ce,Transaction:k,WriteBatch:Se,DocumentReference:et,DocumentSnapshot:dn,Query:Le,QueryDocumentSnapshot:qt,QuerySnapshot:Sr,CollectionReference:At,FieldPath:ft,FieldValue:mt,setLogLevel:function b(O){(0,B.He)(O)},CACHE_SIZE_UNLIMITED:B.H6};function le(O,m){return function so(O,m=Ni.E){return new Et.c(I=>{let D;return null!=m?m.schedule(()=>{D=O.onSnapshot({includeMetadataChanges:!0},I)}):D=O.onSnapshot({includeMetadataChanges:!0},I),()=>{null!=D&&D()}})}(O,m)}function gt(O,m){return le(O,m).pipe((0,it.T)(I=>({payload:I,type:"query"})))}!function fn(O){(function $(O,m){O.INTERNAL.registerComponent(new Lt.uA("firestore-compat",I=>{const D=I.getProvider("app-compat").getImmediate(),U=I.getProvider("firestore").getImmediate();return m(D,U)},"PUBLIC").setServiceProps(Object.assign({},ge)))})(O,(m,I)=>new Mi(m,I,new j)),O.registerVersion("@firebase/firestore-compat","0.3.38")}(Fi.A),ue(7935);class Bn{constructor(m,I){(0,C.A)(this,"ref",void 0),(0,C.A)(this,"afs",void 0),this.ref=m,this.afs=I}set(m,I){return this.ref.set(m,I)}update(m){return this.ref.update(m)}delete(){return this.ref.delete()}collection(m,I){const D=this.ref.collection(m),{ref:U,query:ie}=qn(D,I);return new Cr(U,ie,this.afs)}snapshotChanges(){return function G(O,m){return le(O,m).pipe((0,rt.Z)(void 0),vt(),(0,it.T)(I=>{const[D,U]=I;return U.exists?null!=D&&D.exists?{payload:U,type:"modified"}:{payload:U,type:"added"}:{payload:U,type:"removed"}}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ie.U0)}valueChanges(m={}){return this.snapshotChanges().pipe((0,it.T)(({payload:I})=>m.idField?{...I.data(),[m.idField]:I.id}:I.data()))}get(m){return(0,cn.H)(this.ref.get(m)).pipe(Ie.U0)}}function at(O,m){return gt(O,m).pipe((0,rt.Z)(void 0),vt(),(0,it.T)(I=>{const[D,U]=I,ie=U.payload.docChanges(),ke=ie.map(Be=>({type:Be.type,payload:Be}));return D&&JSON.stringify(D.payload.metadata)!==JSON.stringify(U.payload.metadata)&&U.payload.docs.forEach((Be,st)=>{const mn=ie.find(De=>De.doc.ref.isEqual(Be.ref)),Un=null==D?void 0:D.payload.docs.find(De=>De.ref.isEqual(Be.ref));mn&&JSON.stringify(mn.doc.metadata)===JSON.stringify(Be.metadata)||!mn&&Un&&JSON.stringify(Un.metadata)===JSON.stringify(Be.metadata)||ke.push({type:"modified",payload:{oldIndex:st,newIndex:st,type:"modified",doc:Be}})}),ke}))}function Bi(O,m,I){return at(O,I).pipe((0,Ot.S)((D,U)=>function wt(O,m,I){return m.forEach(D=>{I.indexOf(D.type)>-1&&(O=function Ut(O,m){switch(m.type){case"added":if(!O[m.newIndex]||!O[m.newIndex].doc.ref.isEqual(m.doc.ref))return br(O,m.newIndex,0,m);break;case"modified":if(null==O[m.oldIndex]||O[m.oldIndex].doc.ref.isEqual(m.doc.ref)){if(m.oldIndex!==m.newIndex){const I=O.slice();return I.splice(m.oldIndex,1),I.splice(m.newIndex,0,m),I}return br(O,m.newIndex,1,m)}break;case"removed":if(O[m.oldIndex]&&O[m.oldIndex].doc.ref.isEqual(m.doc.ref))return br(O,m.oldIndex,1)}return O}(O,D))}),O}(D,U.map(ie=>ie.payload),m),[]),(0,Rr.F)(),(0,it.T)(D=>D.map(U=>({type:U.type,payload:U}))))}function br(O,m,I,...D){const U=O.slice();return U.splice(m,I,...D),U}function xr(O){return(!O||0===O.length)&&(O=["added","removed","modified"]),O}class Cr{constructor(m,I,D){(0,C.A)(this,"ref",void 0),(0,C.A)(this,"query",void 0),(0,C.A)(this,"afs",void 0),this.ref=m,this.query=I,this.afs=D}stateChanges(m){let I=at(this.query,this.afs.schedulers.outsideAngular);return m&&m.length>0&&(I=I.pipe((0,it.T)(D=>D.filter(U=>m.indexOf(U.type)>-1)))),I.pipe((0,rt.Z)(void 0),vt(),(0,Pr.p)(([D,U])=>U.length>0||!D),(0,it.T)(([,D])=>D),Ie.U0)}auditTrail(m){return this.stateChanges(m).pipe((0,Ot.S)((I,D)=>[...I,...D],[]))}snapshotChanges(m){const I=xr(m);return Bi(this.query,I,this.afs.schedulers.outsideAngular).pipe(Ie.U0)}valueChanges(m={}){return gt(this.query,this.afs.schedulers.outsideAngular).pipe((0,it.T)(I=>I.payload.docs.map(D=>m.idField?{...D.data(),[m.idField]:D.id}:D.data())),Ie.U0)}get(m){return(0,cn.H)(this.query.get(m)).pipe(Ie.U0)}add(m){return this.ref.add(m)}doc(m){return new Bn(this.ref.doc(m),this.afs)}}class Ye{constructor(m,I){(0,C.A)(this,"query",void 0),(0,C.A)(this,"afs",void 0),this.query=m,this.afs=I}stateChanges(m){return m&&0!==m.length?at(this.query,this.afs.schedulers.outsideAngular).pipe((0,it.T)(I=>I.filter(D=>m.indexOf(D.type)>-1)),(0,Pr.p)(I=>I.length>0),Ie.U0):at(this.query,this.afs.schedulers.outsideAngular).pipe(Ie.U0)}auditTrail(m){return this.stateChanges(m).pipe((0,Ot.S)((I,D)=>[...I,...D],[]))}snapshotChanges(m){const I=xr(m);return Bi(this.query,I,this.afs.schedulers.outsideAngular).pipe(Ie.U0)}valueChanges(m={}){return gt(this.query,this.afs.schedulers.outsideAngular).pipe((0,it.T)(D=>D.payload.docs.map(U=>m.idField?{[m.idField]:U.id,...U.data()}:U.data())),Ie.U0)}get(m){return(0,cn.H)(this.query.get(m)).pipe(Ie.U0)}}const Dr=new me.nKC("angularfire2.enableFirestorePersistence"),qi=new me.nKC("angularfire2.firestore.persistenceSettings"),Ui=new me.nKC("angularfire2.firestore.settings"),pt=new me.nKC("angularfire2.firestore.use-emulator");function qn(O,m=I=>I){return{query:m(O),ref:O}}let R=(()=>{var O;class m{constructor(D,U,ie,ke,Be,st,mn,Un,De,gn,pn,Gi,Fe,oo,Ki,ut,ao){(0,C.A)(this,"schedulers",void 0),(0,C.A)(this,"firestore",void 0),(0,C.A)(this,"persistenceEnabled$",void 0),this.schedulers=mn;const Rt=(0,re.iB)(D,st,U),Gn=De;gn&&(0,ct.gF)(Rt,st,pn,Fe,oo,Ki,Gi,ut),[this.firestore,this.persistenceEnabled$]=(0,re.BM)(`${Rt.name}.firestore`,"AngularFirestore",Rt.name,()=>{const _n=st.runOutsideAngular(()=>Rt.firestore());if(ke&&_n.settings(ke),Gn&&_n.useEmulator(...Gn),ie&&!(0,Mt.Vy)(Be)){const uo=()=>{try{return(0,cn.H)(_n.enablePersistence(Un||void 0).then(()=>!0,()=>!1))}catch(co){return typeof console<"u"&&console.warn(co),(0,ln.of)(!1)}};return[_n,st.runOutsideAngular(uo)]}return[_n,(0,ln.of)(!1)]},[ke,Gn,ie])}collection(D,U){let ie;ie="string"==typeof D?this.firestore.collection(D):D;const{ref:ke,query:Be}=qn(ie,U),st=this.schedulers.ngZone.run(()=>ke);return new Cr(st,Be,this)}collectionGroup(D,U){const ie=U||(Be=>Be),ke=this.firestore.collectionGroup(D);return new Ye(ie(ke),this)}doc(D){let U;U="string"==typeof D?this.firestore.doc(D):D;const ie=this.schedulers.ngZone.run(()=>U);return new Bn(ie,this)}createId(){return this.firestore.collection("_").doc().id}}return O=m,(0,C.A)(m,"\u0275fac",function(D){return new(D||O)(me.KVO(re.rx),me.KVO(re.uP,8),me.KVO(Dr,8),me.KVO(Ui,8),me.KVO(me.Agw),me.KVO(me.SKi),me.KVO(Ie.u0),me.KVO(qi,8),me.KVO(pt,8),me.KVO(ct.DS,8),me.KVO(ct.CP,8),me.KVO(ct.yy,8),me.KVO(ct.ZP,8),me.KVO(ct.$z,8),me.KVO(ct.AU,8),me.KVO(ct.UB,8),me.KVO(Ie.Jv,8))}),(0,C.A)(m,"\u0275prov",me.jDH({token:O,factory:O.\u0275fac,providedIn:"any"})),m})()}}]);